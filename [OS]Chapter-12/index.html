<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.arui.dev","root":"/","images":"/images","scheme":"Gemini","darkmode":"ture","version":"8.14.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"flat"},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Notion 好讀版   ✏️ 泛指所有 secondary storage  Disk Structure 由磁盤組成，最小儲存單位是 sector，買來就切死的，所以用軟體的 block （多個 sector）來控制。Sector 會有 number，所以可以對特定資料作讀取。  Sectors per Track  Constant linear velocity ****(CLV)  De">
<meta property="og:type" content="article">
<meta property="og:title" content="[OS] Chapter 12 — Mass Storage System">
<meta property="og:url" content="https://blog.arui.dev/[OS]Chapter-12/">
<meta property="og:site_name" content="ARui&#39;s Blog">
<meta property="og:description" content="Notion 好讀版   ✏️ 泛指所有 secondary storage  Disk Structure 由磁盤組成，最小儲存單位是 sector，買來就切死的，所以用軟體的 block （多個 sector）來控制。Sector 會有 number，所以可以對特定資料作讀取。  Sectors per Track  Constant linear velocity ****(CLV)  De">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://blog.arui.dev/assets/%5BOS%5DChapter-12/Untitled.png">
<meta property="og:image" content="https://blog.arui.dev/assets/%5BOS%5DChapter-12/Untitled%201.png">
<meta property="og:image" content="https://blog.arui.dev/assets/%5BOS%5DChapter-12/Untitled%202.png">
<meta property="og:image" content="https://blog.arui.dev/assets/%5BOS%5DChapter-12/Untitled%203.png">
<meta property="og:image" content="https://blog.arui.dev/assets/%5BOS%5DChapter-12/Untitled%204.png">
<meta property="og:image" content="https://blog.arui.dev/assets/%5BOS%5DChapter-12/Untitled%205.png">
<meta property="og:image" content="https://blog.arui.dev/assets/%5BOS%5DChapter-12/Untitled%206.png">
<meta property="og:image" content="https://blog.arui.dev/assets/%5BOS%5DChapter-12/Untitled%207.png">
<meta property="og:image" content="https://blog.arui.dev/assets/%5BOS%5DChapter-12/Untitled%208.png">
<meta property="og:image" content="https://blog.arui.dev/assets/%5BOS%5DChapter-12/Untitled%209.png">
<meta property="og:image" content="https://blog.arui.dev/assets/%5BOS%5DChapter-12/Untitled%2010.png">
<meta property="og:image" content="https://blog.arui.dev/assets/%5BOS%5DChapter-12/Untitled%2011.png">
<meta property="og:image" content="https://blog.arui.dev/assets/%5BOS%5DChapter-12/Untitled%2012.png">
<meta property="og:image" content="https://blog.arui.dev/assets/%5BOS%5DChapter-12/Untitled%2013.png">
<meta property="og:image" content="https://blog.arui.dev/assets/%5BOS%5DChapter-12/Untitled%2014.png">
<meta property="og:image" content="https://blog.arui.dev/assets/%5BOS%5DChapter-12/Untitled%2015.png">
<meta property="og:image" content="https://blog.arui.dev/assets/%5BOS%5DChapter-12/Untitled%2016.png">
<meta property="og:image" content="https://blog.arui.dev/assets/%5BOS%5DChapter-12/Untitled%2017.png">
<meta property="og:image" content="https://blog.arui.dev/assets/%5BOS%5DChapter-12/Untitled%2018.png">
<meta property="og:image" content="https://blog.arui.dev/assets/%5BOS%5DChapter-12/Untitled%2019.png">
<meta property="og:image" content="https://blog.arui.dev/assets/%5BOS%5DChapter-12/Untitled%2020.png">
<meta property="og:image" content="https://blog.arui.dev/assets/%5BOS%5DChapter-12/Untitled%2021.png">
<meta property="og:image" content="https://blog.arui.dev/assets/%5BOS%5DChapter-12/Untitled%2022.png">
<meta property="article:published_time" content="2022-01-31T10:12:24.000Z">
<meta property="article:modified_time" content="2022-02-01T14:16:21.801Z">
<meta property="article:author" content="ARui">
<meta property="article:tag" content="Operating System">
<meta property="article:tag" content="Notes">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.arui.dev/assets/%5BOS%5DChapter-12/Untitled.png">


<link rel="canonical" href="https://blog.arui.dev/[OS]Chapter-12/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://blog.arui.dev/[OS]Chapter-12/","path":"[OS]Chapter-12/","title":"[OS] Chapter 12 — Mass Storage System"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>[OS] Chapter 12 — Mass Storage System | ARui's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">ARui's Blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#disk-structure"><span class="nav-number">1.</span> <span class="nav-text">Disk Structure</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#sectors-per-track"><span class="nav-number">1.1.</span> <span class="nav-text">Sectors per Track</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#disk-io"><span class="nav-number">1.2.</span> <span class="nav-text">Disk IO</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#disk-scheduling"><span class="nav-number">2.</span> <span class="nav-text">Disk Scheduling</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#fcfs-first-come-first-served"><span class="nav-number">2.1.</span> <span class="nav-text">FCFS
(First-Come-First-Served)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sstf-shortest-seek-time-first"><span class="nav-number">2.2.</span> <span class="nav-text">SSTF
(Shortest-Seek-Time-First)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#scan-scheduling"><span class="nav-number">2.3.</span> <span class="nav-text">SCAN Scheduling</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#c-scan-scheduling"><span class="nav-number">2.4.</span> <span class="nav-text">C-SCAN Scheduling</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#c-look-scheduling"><span class="nav-number">2.5.</span> <span class="nav-text">C-LOOK Scheduling</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#summary"><span class="nav-number">2.6.</span> <span class="nav-text">Summary</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#review-slides-i"><span class="nav-number">2.7.</span> <span class="nav-text">Review Slides (I)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#disk-swap-space-management"><span class="nav-number">3.</span> <span class="nav-text">Disk &amp; Swap-Space
Management</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#disk-formatting"><span class="nav-number">3.1.</span> <span class="nav-text">Disk Formatting</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#booting"><span class="nav-number">3.2.</span> <span class="nav-text">Booting</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#bad-block"><span class="nav-number">3.3.</span> <span class="nav-text">Bad block</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#swap-space"><span class="nav-number">3.4.</span> <span class="nav-text">Swap space</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#raid-structure"><span class="nav-number">4.</span> <span class="nav-text">RAID Structure</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#raid-0"><span class="nav-number">4.1.</span> <span class="nav-text">RAID 0</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#raid-1"><span class="nav-number">4.2.</span> <span class="nav-text">RAID 1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#raid-2-hamming-code"><span class="nav-number">4.3.</span> <span class="nav-text">RAID 2: Hamming code</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#raid-3-4-parity-bit"><span class="nav-number">4.4.</span> <span class="nav-text">RAID 3 &amp; 4: Parity Bit</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#raid-5-distributed-parity"><span class="nav-number">4.5.</span> <span class="nav-text">RAID 5: Distributed Parity</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#raid-6-pq-dual-parity-redundancy"><span class="nav-number">4.6.</span> <span class="nav-text">RAID 6: P+Q Dual Parity
Redundancy</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#hybrid-raid"><span class="nav-number">4.7.</span> <span class="nav-text">Hybrid RAID</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#review-slides-ii"><span class="nav-number">4.8.</span> <span class="nav-text">Review Slides (II)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#textbook-questions"><span class="nav-number">5.</span> <span class="nav-text">Textbook Questions</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">ARui</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">10</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/arui-tw" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;arui-tw" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:mail@arui.dev" title="E-Mail → mailto:mail@arui.dev" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.facebook.com/ARuiTW/" title="Facebook → https:&#x2F;&#x2F;www.facebook.com&#x2F;ARuiTW&#x2F;" rel="noopener me" target="_blank"><i class="fab fa-facebook fa-fw"></i>Facebook</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.linkedin.com/in/arui-tw/" title="LinkedIn → https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;arui-tw&#x2F;" rel="noopener me" target="_blank"><i class="fab fa-linkedin fa-fw"></i>LinkedIn</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://blog.arui.dev/[OS]Chapter-12/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ARui">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ARui's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="[OS] Chapter 12 — Mass Storage System | ARui's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          [OS] Chapter 12 — Mass Storage System
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-01-31 18:12:24" itemprop="dateCreated datePublished" datetime="2022-01-31T18:12:24+08:00">2022-01-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-02-01 22:16:21" itemprop="dateModified" datetime="2022-02-01T22:16:21+08:00">2022-02-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Operating-System-Notes/" itemprop="url" rel="index"><span itemprop="name">Operating System Notes</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>1.7k</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <div class="note default"><p><a
target="_blank" rel="noopener" href="https://arui-tw.notion.site/Chapter-12-Mass-Storage-System-0a7b775db2304a7c88922dc8457ade4a">Notion
好讀版</a></p>
</div>
<aside>
<p>✏️ 泛指所有 secondary storage</p>
</aside>
<h1 id="disk-structure">Disk Structure</h1>
<p>由磁盤組成，最小儲存單位是 sector，買來就切死的，所以用軟體的 block
（多個 sector）來控制。Sector 會有
number，所以可以對特定資料作讀取。</p>
<p><img src="/assets/%5BOS%5DChapter-12/Untitled.png" /></p>
<h2 id="sectors-per-track"><strong>Sectors per Track</strong></h2>
<ul>
<li>Constant linear velocity ****(CLV)
<ul>
<li><p>Density of bits per track 是固定的</p></li>
<li><p>這樣內圈的資料量就會小於外圈的</p></li>
<li><p>但是這樣讀取資料的速度會不固定</p>
<p>→ 讀內圈要轉比較快</p></li>
<li><p>applications: CD-ROM and DVD-ROM</p></li>
</ul></li>
<li>Constant angular velocity ****(CAV)
<ul>
<li>keep same rotation speed</li>
<li>內圈 density 比較高</li>
<li>這樣轉速就不用改</li>
<li>applications: hard disks</li>
</ul></li>
</ul>
<h2 id="disk-io">Disk IO</h2>
<p><img src="/assets/%5BOS%5DChapter-12/Untitled%201.png" /></p>
<ul>
<li>EIDE, ATA, SATA (Serial ATA), USB, SCSI, etc</li>
<li>效能會有差</li>
<li>I/O bus is controlled by controller</li>
</ul>
<span id="more"></span>
<h1 id="disk-scheduling">Disk Scheduling</h1>
<ul>
<li><p>Disk-access time has 3 major components</p>
<p><img src="/assets/%5BOS%5DChapter-12/Untitled%202.png" /></p>
<ul>
<li><p><strong>seek
time</strong>：去移動讀寫頭的位置花的時間（通常最慢）</p>
<p>→ 主要優化目標</p></li>
<li><p>rotational latency：轉動磁盤的時間（快到可以被 ignore）</p></li>
<li><p>read time：content transfer
time（取決於一次讀寫的資料量，也可能這邊最慢）</p></li>
</ul></li>
<li><p>Disk bandwidth — # of bytes transferred/(complete of last req –
start of first req)</p></li>
</ul>
<h2 id="fcfs-first-come-first-served">FCFS
(First-Come-First-Served)</h2>
<ul>
<li>問題的描述方式會是一串數字，代表著他是第幾圈的資料。</li>
</ul>
<p><img src="/assets/%5BOS%5DChapter-12/Untitled%203.png" /></p>
<h2 id="sstf-shortest-seek-time-first">SSTF
(Shortest-Seek-Time-First)</h2>
<ul>
<li>看哪一個離目前的磁頭最近的就去那個（Greedy）</li>
<li>有 starvation，因為 request
會不停地發生，所以很遠的可能一直被插隊</li>
<li>不是
Optimal，因為只能找現在離我最近的，可能等一下進來的會更近，但是他就跳走了，他應該要停一下等那個未來的傢伙。</li>
</ul>
<p><img src="/assets/%5BOS%5DChapter-12/Untitled%204.png" /></p>
<h2 id="scan-scheduling">SCAN Scheduling</h2>
<ul>
<li><p>通常的解</p></li>
<li><p>我就移動我的，有剛好可以做的我就做</p></li>
<li><p>disk head move from one end to the other end</p></li>
<li><p>轉到底會換方向</p>
<p>⇒ 檢查時間不 uniform</p></li>
<li><p>A.k.a elevator algorithm</p></li>
</ul>
<figure>
<img src="/assets/%5BOS%5DChapter-12/Untitled%205.png"
alt="注意他甚至會走到 0 的位置" />
<figcaption aria-hidden="true">注意他甚至會走到 0 的位置</figcaption>
</figure>
<h2 id="c-scan-scheduling">C-SCAN Scheduling</h2>
<ul>
<li><p>只轉一個方向，走到底就把磁頭拉回去另一端</p>
<p>⇒ 比較 Uniform</p></li>
<li><p>（Round robin）</p></li>
<li><p>基本上都用這個，不會用 SCAN</p></li>
</ul>
<p><img src="/assets/%5BOS%5DChapter-12/Untitled%206.png" /></p>
<h2 id="c-look-scheduling">C-LOOK Scheduling</h2>
<ul>
<li>一樣只轉一個方向，但是不會走到底</li>
<li>如果往右邊走，就會去看右邊的下一個是誰</li>
<li>其實跟 SSTF 很像，因為他在也會被剛進來的帶著走（但是不會
starvation）</li>
</ul>
<p><img src="/assets/%5BOS%5DChapter-12/Untitled%207.png" /></p>
<h2 id="summary">Summary</h2>
<ul>
<li>SSTF
<ul>
<li>common and has a natural appeal, but not optimal</li>
</ul></li>
<li>SCAN
<ul>
<li>perform better for disks with <strong>heavy load</strong></li>
<li><strong>No</strong> starvation problem</li>
</ul></li>
<li>C-SCAN
<ul>
<li>More uniform wait time</li>
</ul></li>
<li>Performance is also influenced by the file-allocation method
<ul>
<li><p>Contiguous: less head movement</p>
<p>→ 可能會因為有同時很多 process 在讀，所以還是不 contiguous
的</p></li>
<li><p>Indexed &amp; linked: greater head movement</p></li>
</ul></li>
</ul>
<h2 id="review-slides-i">Review Slides (I)</h2>
<ul>
<li>3 major components in disk-access time
<ul>
<li>Seek</li>
<li>Rotation</li>
<li>Read</li>
</ul></li>
<li>Goal of disk-scheduling algorithm</li>
<li>Disk-scheduling algorithms
<ul>
<li>FCFS</li>
<li>SSTF</li>
<li>SCAN</li>
<li>C-SCAN</li>
<li>C-LOOK</li>
</ul></li>
</ul>
<h1 id="disk-swap-space-management">Disk &amp; Swap-Space
Management</h1>
<h2 id="disk-formatting">Disk Formatting</h2>
<p>一般的格式化是 high level 的格式化，low level 的 disk 的
formatting（這是出廠前就做好的）是 dividing a disk (magnetic recording
material) into sectors that disk controller can read and write 。</p>
<ul>
<li>each sector = header + data area + trailer
<ul>
<li>Header — metadata，i.e. where the sector is, the ID of the
sector</li>
<li>trailer — error correction code, based on all bytes in data
area</li>
</ul></li>
<li>High-level: partition and 用 data block 的方式去存取</li>
</ul>
<h2 id="booting">Booting</h2>
<ul>
<li><p>Bootstrap program</p>
<ul>
<li><p>Initialize CPU, registers, device controllers, memory, and then
starts OS</p></li>
<li><p>First <strong>bootstrap code</strong> stored in ROM</p></li>
<li><p>Complete bootstrap in the boot block the boot disk (aka system
disk)</p></li>
</ul></li>
<li><p>Booting from a Disk in Windows 2000</p>
<p><img src="/assets/%5BOS%5DChapter-12/Untitled%208.png" /></p>
<ol type="1">
<li>Run bootstrap code in ROM</li>
<li>Read boot code in MBR(Master boot record)</li>
<li>Find boot partition from partition table</li>
<li>Read boot sector/block and continue booting</li>
</ol></li>
</ul>
<h2 id="bad-block">Bad block</h2>
<p>A.k.a 壞軌</p>
<ul>
<li>Disk controller 是第一個去處理的</li>
<li>IDE — 看 ECC 知道他壞掉就不會讀給上面的，而是 notify
他們說「欸，壞去啊！」</li>
<li>SCSI — 除了不會讓你用以外，還會把壞掉的地方的儲存空間 recreate
出來，有下面兩種方式
<ol type="1">
<li><p>Sector sparing (forwarding) —
像是有空白的撲克牌，有牌不見就拿空的補充。但是這樣連續的 sector #
會存在不連續的地方，所以壞太多效能就會變差。</p>
<p>→ Run time 在用的</p></li>
<li><p>Sector slipping — 從壞掉的地方開始全部往後移一格。超花時間。</p>
<p>→ Reboot 在做的</p></li>
</ol></li>
</ul>
<h2 id="swap-space">Swap space</h2>
<ul>
<li><a
target="_blank" rel="noopener" href="https://hackmd.io/@Pl-eQT9CQaS0jhExKqL8_w/BkhOSR4jW/https%3A%2F%2Fhackmd.io%2Fs%2FryDbZPA7f#Swap-space">See
this</a></li>
<li>之前是說由 Virtual Memory 或是 Memory Manager 。把他切成固定的
page，然後直接 map。</li>
<li>他也可以用 File system 來管。把每一個 page 設成 4kb 的
file。當要存取的時候就用 file name 當作 page ID。</li>
<li>通常是直接用 Memory Manager 來操作，不通過 file
system，比較快。</li>
<li>所以用 raw partition 一定比較快，但是這樣就會浪費 raw partition
的空間。且如果 VM 用得很兇，那 swap space
會不夠，那就效能大量下降。</li>
<li>所以通常都一起用。</li>
<li>Swap Space Allocation
<ul>
<li>1st version: disk 和 memory 都一份一樣的</li>
<li>2nd version:
<ul>
<li>Solaris 1:
<ul>
<li>Run time 產生的才存，像是 code 就不用存，反正需要再去 disk
拿就好</li>
<li>如果 declare 了但是還沒用，那就不用存在 swap space</li>
</ul></li>
<li>Solaris 2:
<ul>
<li>先不要再 swap space 存 copy，只有在 swap out 才 create</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<p><img src="/assets/%5BOS%5DChapter-12/Untitled%209.png" /></p>
<h1 id="raid-structure">RAID Structure</h1>
<p>現在儲存空間越來越便宜。</p>
<p>RAID = <strong>R</strong>edundant <strong>A</strong>rrays of
<strong>I</strong>nexpensive <strong>D</strong>isks</p>
<p>→ 想要用很多便宜的硬碟，產生一個 powerful 的 storage device</p>
<p>→ provide <strong>reliability</strong> via
<strong>redundancy</strong> (多 backup)</p>
<p>→ improve <strong>performance</strong> via
<strong>parallelism</strong> (平行化，一起讀寫)</p>
<ul>
<li>RAID is arranged into different levels
<ul>
<li>Striping → 資料分散</li>
<li>Mirror (Replication) → 資料 copy</li>
<li>Error-correcting code (ECC) &amp; Parity bit</li>
</ul></li>
</ul>
<h2 id="raid-0">RAID 0</h2>
<p><img src="/assets/%5BOS%5DChapter-12/Untitled%2010.png" /></p>
<p><img src="/assets/%5BOS%5DChapter-12/Untitled%2011.png" /></p>
<ul>
<li>Striping → 把檔案切割用 Round Robin 的方式擺到印碟上去</li>
<li>Improve <strong>performance</strong> via
<strong>parallelism</strong> → 大資料可以同時讀取</li>
</ul>
<h2 id="raid-1">RAID 1</h2>
<p><img src="/assets/%5BOS%5DChapter-12/Untitled%2012.png" /></p>
<ul>
<li>Mirror → 複製</li>
<li>Provide <strong>reliability</strong> via <strong>redundancy</strong>
→ 通常最多作三個 replica
<ul>
<li>讀取速度會變成 N 倍</li>
<li>寫入速度不變</li>
</ul></li>
</ul>
<h2 id="raid-2-hamming-code">RAID 2: Hamming code</h2>
<p><img src="/assets/%5BOS%5DChapter-12/Untitled%2013.png" /></p>
<ul>
<li><p><a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Hamming_code">Hamming
code</a> → 可以推出是誰遺失然後重建出來</p></li>
<li><p>E.g.: Hamming code(7,4)</p>
<p><img src="/assets/%5BOS%5DChapter-12/Untitled%2014.png" /></p>
<ul>
<li>4 data bits (on 4 disks) + 3 parity bits (on 3 disks)</li>
<li>只浪費的 75%（RAID 1 是 100%）</li>
</ul></li>
</ul>
<h2 id="raid-3-4-parity-bit">RAID 3 &amp; 4: Parity Bit</h2>
<p><img src="/assets/%5BOS%5DChapter-12/Untitled%2015.png" /></p>
<ul>
<li><p>硬碟壞掉，他本來就會自己說，所以應該是不用偵測的，我們只需要
recovery</p>
<p>→ a single parity bit is enough to correct error from a single disk
failure</p>
<p>→ 所以我們只需要浪費 <code>1/N</code></p></li>
<li><p>RAID3: Bit-level striping; RAID 4: Block-level striping</p>
<p>→ RAID 4 recover 的速度會略快（除非壞掉的只有一個
bit），因為讀取都是一個 block 在操作的，所以他就不用橫跨好幾的 disk
了</p></li>
<li><p>讀取速度是 <code>N - 1</code> 倍，寫入速度不變（因為要去寫存
Parity bit 的那顆）</p></li>
</ul>
<h2 id="raid-5-distributed-parity">RAID 5: Distributed Parity</h2>
<p><img src="/assets/%5BOS%5DChapter-12/Untitled%2016.png" /></p>
<ul>
<li>Load balancing → 把 parity bit 分散在各個 disk</li>
<li>最常見的</li>
<li>Read 可以是 <code>N</code> 倍了</li>
<li>Write
<ul>
<li><p>Method 1</p>
<p><img src="/assets/%5BOS%5DChapter-12/Untitled%2017.png" /></p>
<ol type="1">
<li>讀 N-2 筆 data</li>
<li>重算 pb</li>
<li>寫進去那兩個</li>
</ol>
<p>⇒ N / (N - 2 + 2) = 1</p></li>
<li><p>Method 2</p>
<p><img src="/assets/%5BOS%5DChapter-12/Untitled%2018.png" /></p>
<ol type="1">
<li>讀原本的值</li>
<li>算出修改的影響</li>
<li>寫入</li>
</ol>
<p>⇒ N / 4 times faster</p></li>
</ul></li>
</ul>
<h2 id="raid-6-pq-dual-parity-redundancy">RAID 6: P+Q Dual Parity
Redundancy</h2>
<p><img src="/assets/%5BOS%5DChapter-12/Untitled%2019.png" /></p>
<ul>
<li>你有不只一個 PB ⇒ 可以多個硬碟壞掉</li>
</ul>
<h2 id="hybrid-raid">Hybrid RAID</h2>
<p><img src="/assets/%5BOS%5DChapter-12/Untitled%2020.png" /></p>
<ul>
<li>RAID 0+1: Stripe then replicate → 保護能力比較弱</li>
<li>RAID 1+0: Replicate then stripe</li>
<li>先寫先做</li>
</ul>
<h2 id="review-slides-ii">Review Slides (II)</h2>
<ul>
<li>Swap space using FS? Raw partition?</li>
<li>How to reduce swap space usage?</li>
<li>RAID disks? Purpose?</li>
<li>RAID-0~6?</li>
<li>RAID 0+1, RAID 1+0</li>
</ul>
<h1 id="textbook-questions">Textbook Questions</h1>
<p><img src="/assets/%5BOS%5DChapter-12/Untitled%2021.png" /></p>
<p><img src="/assets/%5BOS%5DChapter-12/Untitled%2022.png" /></p>
<div class="note warning"><p>此筆記為清華大學周志遠教授作業系統之課堂筆記，所有內容及圖片皆取材於課堂內容。<br />
如內容有誤，歡迎來信 <a
href="mailto:mail@arui.dev">mail@arui.dev</a>。</p>
</div>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>ARui
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://blog.arui.dev/[OS]Chapter-12/" title="[OS] Chapter 12 — Mass Storage System">https://blog.arui.dev/[OS]Chapter-12/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/Operating-System/" rel="tag"># Operating System</a>
              <a href="/tags/Notes/" rel="tag"># Notes</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/%5BOS%5DChapter-13/" rel="prev" title="[OS] Chapter 13 — I/O System">
                  <i class="fa fa-chevron-left"></i> [OS] Chapter 13 — I/O System
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023FallCourses/" rel="next" title="陽明交大資工所碩一上（2023 Fall）修課心得">
                  陽明交大資工所碩一上（2023 Fall）修課心得 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2021 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-coffee"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ARui</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  




  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
