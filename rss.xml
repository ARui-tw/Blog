<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>ARui&#39;s Blog</title>
    <link>https://blog.arui.dev/</link>
    
    <atom:link href="https://blog.arui.dev/rss.xml" rel="self" type="application/rss+xml"/>
    
    <description></description>
    <pubDate>Tue, 05 Mar 2024 18:55:36 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>é™½æ˜äº¤å¤§è³‡å·¥æ‰€ç¢©ä¸€ä¸Šï¼ˆ2023 Fallï¼‰ä¿®èª²å¿ƒå¾—</title>
      <link>https://blog.arui.dev/2023FallCourses/</link>
      <guid>https://blog.arui.dev/2023FallCourses/</guid>
      <pubDate>Tue, 05 Mar 2024 18:55:00 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;ä½œæ¥­ç³»çµ±&quot;&gt;ä½œæ¥­ç³»çµ±&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;è‹±æ–‡èª²åï¼šOperating Systemï¼‰&lt;/li&gt;
&lt;li&gt;æ°¸ä¹…èª²è™Ÿï¼šCSIC30015&lt;/li&gt;
&lt;li&gt;æ•™å¸«ï¼šå³ä¿Šå³¯&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;èª²ç¨‹å…§å®¹&quot;&gt;èª²ç¨‹å…§å®¹&lt;/h2&gt;
&lt;p&gt;å› ç‚ºæ²’ä¸Šéäº¤å¤§é€™é‚Šæ•™çš„å¤§å­¸éƒ¨
OSï¼Œæ‰€ä»¥ä¸çŸ¥é“è·Ÿå¤§å­¸çš„å·®åˆ¥æœ‰å¤šå°‘ã€‚ä½†æ˜¯é«”æ„Ÿä¸Šè·Ÿæ¸…å¤§å·®ä¸å°‘ã€‚æ¸…å¤§å‘¨å¿—é æ•™æˆçš„
OS æ„Ÿè¦ºæ¯”è¼ƒæƒ³æ˜¯æ¯å€‹ component
éƒ½ç¢°ä¸€ä¸‹ï¼Œä½†æ˜¯é€™å ‚æ¯”è¼ƒåå‘æ¯å€‹éƒ½æœƒæ•™åˆ°æ¯”è¼ƒæ·±å±¤çš„ã€‚ä½†å¯èƒ½æ™‚é–“çš„é—œä¿‚ï¼Œæ‰€ä»¥ä¹Ÿæ²’æœ‰è¾¦æ³•æ•™å¾ˆå¤šå¾ˆæ·±ã€‚è€å¸«å¥½åƒæ˜¯ä½œè¨˜æ†¶é«”çš„ï¼ˆä»–ä¸‹å­¸æœŸé‚„æœ‰é–‹ä¸€é–€ã€ˆè¨˜æ†¶é«”èˆ‡å„²å­˜ç³»çµ±ã€‰ï¼‰ï¼Œæ‰€ä»¥é‚£æ®µè¬›çš„ç‰¹åˆ¥ç´°ç¯€å’Œæ¸…æ¥šã€‚&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="ä½œæ¥­ç³»çµ±">ä½œæ¥­ç³»çµ±</h1><ul><li>è‹±æ–‡èª²åï¼šOperating Systemï¼‰</li><li>æ°¸ä¹…èª²è™Ÿï¼šCSIC30015</li><li>æ•™å¸«ï¼šå³ä¿Šå³¯</li></ul><h2 id="èª²ç¨‹å…§å®¹">èª²ç¨‹å…§å®¹</h2><p>å› ç‚ºæ²’ä¸Šéäº¤å¤§é€™é‚Šæ•™çš„å¤§å­¸éƒ¨OSï¼Œæ‰€ä»¥ä¸çŸ¥é“è·Ÿå¤§å­¸çš„å·®åˆ¥æœ‰å¤šå°‘ã€‚ä½†æ˜¯é«”æ„Ÿä¸Šè·Ÿæ¸…å¤§å·®ä¸å°‘ã€‚æ¸…å¤§å‘¨å¿—é æ•™æˆçš„OS æ„Ÿè¦ºæ¯”è¼ƒæƒ³æ˜¯æ¯å€‹ componentéƒ½ç¢°ä¸€ä¸‹ï¼Œä½†æ˜¯é€™å ‚æ¯”è¼ƒåå‘æ¯å€‹éƒ½æœƒæ•™åˆ°æ¯”è¼ƒæ·±å±¤çš„ã€‚ä½†å¯èƒ½æ™‚é–“çš„é—œä¿‚ï¼Œæ‰€ä»¥ä¹Ÿæ²’æœ‰è¾¦æ³•æ•™å¾ˆå¤šå¾ˆæ·±ã€‚è€å¸«å¥½åƒæ˜¯ä½œè¨˜æ†¶é«”çš„ï¼ˆä»–ä¸‹å­¸æœŸé‚„æœ‰é–‹ä¸€é–€ã€ˆè¨˜æ†¶é«”èˆ‡å„²å­˜ç³»çµ±ã€‰ï¼‰ï¼Œæ‰€ä»¥é‚£æ®µè¬›çš„ç‰¹åˆ¥ç´°ç¯€å’Œæ¸…æ¥šã€‚</p><span id="more"></span><h2 id="ä¸Šèª²æ–¹å¼">ä¸Šèª²æ–¹å¼</h2><p>è‹±æ–‡æˆèª²ã€‚ç·šä¸Šå¯¦é«”ä¸¦è¡Œï¼Œæœƒæœ‰å½±ç‰‡å­˜æª”ã€‚èª²é–“çš„å­¸ç”Ÿæå•éƒ½æœƒè¢«éŒ„ä¸‹ä¾†ã€‚åŸºæœ¬ä¸Šæˆ‘é™¤äº†ç¬¬ä¸€å ‚å’ŒæœŸä¸­æœŸæœ«ä»¥å¤–éƒ½æ²’å»éäº†XDD</p><h2 id="è€ƒè©¦ä½œæ¥­">è€ƒè©¦ä½œæ¥­</h2><ul><li>20% Midterm Exam<ul><li>æœ‰äººåœ¨ nctuplus ä¸Šé¢ä¸Ÿè€ƒå¤äº†ï¼ŒDcardä¹Ÿæœ‰ä¸€å€‹ç¯‡åœ¨è¨è«–é€™å€‹ã€‚åŸºæœ¬ä¸Šè·Ÿå»å¹´è€ƒå¤ä¸€æ¨£ï¼Œå¤šäº†ä¸€å€‹ sectionçš„æ˜¯éé¡Œã€‚æ»¿åˆ†ä¾èˆŠç ´ç™¾ã€‚</li></ul></li><li>30% Final Exam<ul><li>æ²’æª¢è¨ï¼Œè€ƒå·æ²’ç™¼å›ä¾†ã€‚æœƒè€ƒåˆ°æœŸä¸­ç¯„åœï¼Œè¨˜å¾—è¤‡ç¿’ã€‚</li></ul></li><li>20% Paper Presentation<ul><li>é€™å¹´å› ç‚ºäººæ•¸çš„é—œä¿‚å…©å€‹äººä¸€çµ„ã€‚ä¸€çµ„ç´„ 12~15åˆ†é˜å ±ä¸€ç¯‡ã€‚è¦å¾è€å¸«æŒ‡å®šçš„ conferences ä¸­é¸ï¼ˆUSENIX OSDI, USENIX ATC,USENIX FAST, SOSP, ASPLOS, HPCA, ACM SC, ISCA, MICRO, EuroSysï¼‰ã€‚æˆ–æ˜¯Rank A ä¸”åé ä»¥ä¸Šçš„ã€‚</li><li>ç¬¬äºŒé€±å ±åŠ å…©åˆ†ï¼Œç¬¬ä¸‰å‘¨å ±åŠ ä¸€åˆ†ã€‚ç”¨è‹±æ–‡å ±åŠ å…©åˆ†ã€‚</li></ul></li><li>30% Homework<ul><li>ä½œæ¥­ä¸€<ul><li>è¦æ”¹ Linux çš„ unameï¼Œéœ€è¦ä¸€å°è™›æ“¬æ©Ÿã€‚ç„¶å¾Œå¯¦ä½œä¸€å€‹ç°¡å–®çš„ systemcallsã€‚</li></ul></li><li>ä½œæ¥­äºŒ<ul><li>ç”¨ pthread å»ä½œä¸åŒ policy çš„ schedulingã€‚</li></ul></li><li>ä½œæ¥­ä¸‰<ul><li>å¯«ä¸€å€‹ kernel module å»å°å‡ºç³»çµ±è³‡æ–™ã€‚</li></ul></li></ul></li><li>10% Class Participation (1 question 2pts)</li></ul><h2 id="å…¶ä»–">å…¶ä»–</h2><p>ä¸é»åã€‚ç·šä¸Šä¹Ÿå¯ä»¥ç™¼å•ã€‚</p><h2 id="æœ€å¾Œæƒ³èªªçš„è©±">æœ€å¾Œæƒ³èªªçš„è©±</h2><p>è€å¸«çš„è‹±æ–‡å¾ˆå¥½ï¼Œç”¨è¿‘ä¹å…©å€é€Ÿä¹Ÿå¯ä»¥è½æ‡‚ã€‚è§£é‡‹èƒ½åŠ›ä¹Ÿå¾ˆå¥½ï¼Œé—¡è¿°éƒ½å¾ˆæ¸…æ¥šã€‚å­¸ç”Ÿå•å•é¡Œå¦‚æœé‡åˆ°ä»–ä¸æœƒä»–ä¹Ÿæœƒåœ¨ä¸‹æ¬¡è£œå……ã€‚å¯èƒ½å› ç‚ºæœ‰åŠ åˆ†çš„é—œä¿‚ï¼Œæ‰€ä»¥å¾ˆå¤šäººåœ¨å•å•é¡Œã€‚æœ€å¾Œé‚„æœ‰å°èª¿ä¸‰åˆ†ï¼Œä½›ï¼</p><p>ç­å¹³å‡ 86.85ï¼Œé‚„æœ‰ä¸å°‘äººç ´ç™¾ @@</p><h1 id="æ ¡å‹™ç³»çµ±é–‹ç™¼èˆ‡ç®¡ç†ä¸€">æ ¡å‹™ç³»çµ±é–‹ç™¼èˆ‡ç®¡ç†ï¼ˆä¸€ï¼‰</h1><ul><li>è‹±æ–‡èª²åï¼šInstitutional System Development and Management</li><li>æ°¸ä¹…èª²è™Ÿï¼šCSIC30060</li><li>æ•™å¸«ï¼šé„­æ˜Œæ°ï¼ˆé›–ç„¶ä¸Šé¢å¯«å¾ˆå¤šäººï¼Œä½†æ˜¯åŸºæœ¬ä¸Šæ˜¯é„­è€å¸«åœ¨å¸¶ã€‚ï¼‰</li></ul><h2 id="èª²ç¨‹å…§å®¹-1">èª²ç¨‹å…§å®¹</h2><p>å­¸ç”Ÿä¸Šå°å ±å‘Šå’Œå ±é€²åº¦ã€‚æœ‰æ™‚å€™æœƒå®‰æ’æ¼”è¬›ï¼Œå¯ä»¥è·Ÿ Sophiï¼ˆæˆ‘å€‘çš„PMï¼‰è¨±é¡˜ã€‚</p><h2 id="ä¸Šèª²æ–¹å¼-1">ä¸Šèª²æ–¹å¼</h2><p>æ¯é€±æœƒæ’ä¸€åˆ°å…©å€‹äººä¸Šå°å ±å‘Šã€‚ä¹‹å¾Œå°±æ˜¯å ±å¤§å®¶é€™å‘¨å„è‡ªçš„é€²åº¦ï¼Œè€å¸«æœƒçµ¦ä½ ä¸€äº›åƒè€ƒæ„è¦‹ï¼Œä½†çœŸçš„åªæ˜¯åƒè€ƒï¼Œä»–ä¹Ÿä¸æœƒå¼·è¿«ä½ ä½œä»€éº¼ã€‚å¦‚æœæœ‰é‡åˆ°ã€Œäººéš›ã€å•é¡Œä¹Ÿå¯ä»¥åœ¨é€™æ™‚å€™æå‡ºä¾†ï¼Œäººå¾ˆå¥½çš„Sophi æœƒå¹«ä½ è§£æ±ºã€‚åŸºæœ¬ä¸Šè€å¸«ä¹Ÿæƒ³è¶•å¿«é–ƒäººï¼ˆå¤§å®¶éƒ½æƒ³ï¼‰ï¼Œæ‰€ä»¥éƒ½æœƒåœ¨ 2:30åˆ†å·¦å³çµæŸèª²ç¨‹ã€‚</p><h2 id="è€ƒè©¦ä½œæ¥­-1">è€ƒè©¦ä½œæ¥­</h2><p>ç„¡ã€‚è©•åˆ†ç”±è€å¸«è©•ä¼°ä½ é€™å­¸æœŸçš„é–‹ç™¼é€²åº¦ã€‚åŸºæœ¬ä¸Šä¸è¦äº‚ææ‡‰è©²éƒ½æœƒ A+</p><h2 id="å…¶ä»–-1">å…¶ä»–</h2><p>å¯ä»¥è«‹å‡ï¼Œä½†æ˜¯ä¸è¦å¤ªèª‡å¼µã€‚</p><h2 id="æœ€å¾Œæƒ³èªªçš„è©±-1">æœ€å¾Œæƒ³èªªçš„è©±</h2><p>æˆŠçµ„äººå€‘å°‘æ•¸èšåœ¨ä¸€èµ·çš„æ™‚é–“ï¼ˆï¼Ÿï¼‰ã€‚è€å¸«å’Œ Sophiäººéƒ½å¾ˆå¥½ï¼Œæœ‰å•é¡Œéƒ½å¯ä»¥æå‡ºä¾†ã€‚</p><h1 id="è«–æ–‡ç ”è¨">è«–æ–‡ç ”è¨</h1><ul><li>è‹±æ–‡èª²åï¼šSeminars</li><li>æ°¸ä¹…èª²è™Ÿï¼šCSIC30115</li><li>æ•™å¸«ï¼šæ¯é€±éƒ½æœ‰ä¸åŒçš„è¬›è€…</li></ul><h2 id="èª²ç¨‹å…§å®¹-2">èª²ç¨‹å…§å®¹</h2><p>è½æ¼”è¬›ã€‚</p><h2 id="ä¸Šèª²æ–¹å¼-2">ä¸Šèª²æ–¹å¼</h2><p>æ¯é€±æœƒè¦è«‹è¬›è€…å»æ¼”è¬›ã€‚é€šå¸¸æ˜¯ä¸€å€‹å°æ™‚æœƒçµæŸã€‚æœ‰æ™‚å€™æœƒå‡ºç¾è·Ÿ CSæ¯«ç„¡é—œä¿‚çš„æ¼”è¬›ä¸»é¡Œï¼Œåƒæ˜¯å…©æ€§é—œä¿‚ï¼ˆè¶…ã„ï¼‰ã€‚å¤šæ•¸éƒ½æ˜¯ä¼æ¥­ä¾†å®£å‚³ã€‚</p><h2 id="è€ƒè©¦ä½œæ¥­-2">è€ƒè©¦ä½œæ¥­</h2><p>æ‰‹å¯« 100å­—å¿ƒå¾—ã€‚æ²’å¯«ç®—æ²’åˆ°ã€‚åŠ©æ•™æœƒæ¯é€±æ›´æ–°ç›®å‰å¤§å®¶çš„å‡ºå¸­æ¬¡æ•¸ã€‚è½èªªæœƒçœŸçš„æ•¸å­—æ•¸ï¼Œæœ‰äººåœ¨Dcard æŠ±æ€¨ä»–è¢«æŠ“åˆ°ã€‚</p><h2 id="å…¶ä»–-2">å…¶ä»–</h2><p>å¯ä»¥ä¸‰æ¬¡ä¸å‡ºå¸­ã€‚</p><h2 id="æœ€å¾Œæƒ³èªªçš„è©±-2">æœ€å¾Œæƒ³èªªçš„è©±</h2><p>çœŸå¿ƒå¸Œæœ›ä»–å€‘å¯ä»¥é‚€è«‹æ›´æœ‰æ–™çš„è¬›è€… ==ã€‚æœ‰è¨˜å¾—å¥½çš„æ‡‰è©²æ˜¯ä¸€æ¬¡æ˜¯å¾®è»Ÿçš„å’Œå¦ä¸€å€‹åœ‹å¤–å¤§å­¸ä¾†è¬›ã€‚</p><h1 id="ç„¡ç·šå¤šåª’é«”ç¶²è·¯">ç„¡ç·šå¤šåª’é«”ç¶²è·¯</h1><ul><li>è‹±æ–‡èª²åï¼šWireless Multimedia Networks</li><li>æ°¸ä¹…èª²è™Ÿï¼šCSIC30073</li><li>æ•™å¸«ï¼šè¶™ç¦§ç¶ </li></ul><h2 id="èª²ç¨‹å…§å®¹-3">èª²ç¨‹å…§å®¹</h2><ul><li>Quality of Service (QoS)</li><li>Inserve</li><li>DiffServ</li><li>MPLS</li><li>Internet Traffic Engineering</li><li>IGMP &amp; Multicasting</li><li>MIMO Beamforming</li><li>Dynamic Reuse of Unlicensed Spectrum</li><li>TSN</li></ul><h2 id="ä¸Šèª²æ–¹å¼-3">ä¸Šèª²æ–¹å¼</h2><p>æŠ•å½±ç‰‡åŠ ä¸Šæ¿æ›¸ä½œç•«ã€‚ä¸€é–‹å§‹æ²’æœ‰éŒ„å½±ï¼ŒæœŸä¸­å¾Œç¶“å­¸ç”Ÿè¦æ±‚æœ‰éŒ„å½±ä¸Šå‚³ã€‚ä¸Šèª²è€å¸«æœƒæƒ³è¦å­¸ç”Ÿçš„åæ‡‰ï¼Œä½†æ˜¯æˆ‘å€‘é€™å±†æ²’ä»€éº¼åæ‡‰ï¼Œæ‰€ä»¥åç¬¬ä¸€æ’çš„åŒå­¸å°±å¯ä»¥ä¸€ç›´è·Ÿè€å¸«å°è©±XDã€‚è€å¸«æ™‚ä¸æ™‚æœƒåˆ†äº«ä»–å¯¦é©—å®¤çš„æ±è¥¿å’Œä»–ä¹‹å‰çš„ç¶“é©—ï¼Œå¯ä»¥æ„Ÿå—åˆ°ä»–å°æ–¼é€™å€‹é ˜åŸŸçš„ç†±æƒ…ã€‚</p><h2 id="è€ƒè©¦ä½œæ¥­-3">è€ƒè©¦ä½œæ¥­</h2><ul><li>Midterm: 30%<ul><li>è€ƒé¡Œæœ‰å•ç­”å’Œé¸æ“‡ã€‚å¯ä»¥è·Ÿè€å¸«è¦å»å¹´è€ƒå¤ï¼Œä½†æ˜¯ä¸æœƒçµ¦è§£ç­”ã€‚å¯ä»¥è·Ÿè€å¸«argue ç¯„åœ XDD</li></ul></li><li>Final: 35%<ul><li>é¡ä¼¼æœŸä¸­è€ƒã€‚ä½†æ˜¯è€å¸«å¿˜è¨˜çµ¦è€ƒå¤äº† QQ</li></ul></li><li>Project: 35%<ul><li>å¯ä»¥ä¸€åˆ°äºŒäººï¼Œä½†æ˜¯å…©å€‹äººçš„è¦åšçš„æ¯”ä¸€å€‹äººçš„é›£ã€‚é¡Œç›®è‡ªè¨‚ï¼Œè€å¸«æ˜¯èªªæ‹¿èª²å ‚å…§æ•™éçš„ï¼Œä½†å¥½åƒå¾ˆå¤šäººæ‹¿å…¶ä»–èª²æˆ–å¯¦é©—å®¤åœ¨åšçš„æ±è¥¿ä¾†å»¶ä¼¸ï¼ŸæœŸæœ«è€ƒå‰æœ‰ä¸€æ¬¡Proposalå ±å‘Šï¼Œè€å¸«æœƒçµ¦æ„è¦‹å’Œè©•åƒ¹é›£åº¦ã€‚æœŸæœ«å¾Œçš„å ±å‘Šæ˜¯ç·šä¸Šå ±å‘Šï¼Œé€™å¹´æ˜¯å¦å¤–ç´„æ™‚é–“ã€‚</li></ul></li></ul><h2 id="å…¶ä»–-3">å…¶ä»–</h2><p>ä¸é»åï¼Œä½†æ˜¯å¼·çƒˆå»ºè­°åˆ°èª²ã€‚è‡ªå·±å•ƒè¬›ç¾©æˆ–æ˜¯åŸæ–‡æ›¸å¾ˆç—›è‹¦â€¦â€¦</p><h2 id="æœ€å¾Œæƒ³èªªçš„è©±-3">æœ€å¾Œæƒ³èªªçš„è©±</h2><p>è€å¸«æœƒæŠŠ 5G å¿µæˆã€Œäº”é›ã€ï¼ŒæŠŠ Wi-Fi å¿µæˆã€Œæ­ªã„ˆã„ã€ã€‚</p><p>è€å¸«çš„è§£é‡‹éƒ½å¾ˆæ¸…æ¥šï¼Œä½†æ˜¯å°ç”Ÿé§‘éˆï¼Œå¾ˆå¤šä¹‹å‰å­¸éçš„æ±è¥¿éƒ½å¿˜è¨˜äº†ã€‚ä¸‹èª²å¯ä»¥å»æ‰¾è€å¸«ä¸€ç›´å•åˆ°æ‡‚ç‚ºæ­¢ã€‚æœ‰æ™‚å€™å¤ªå¤šäººå•ä¸€æ¨£çš„å•é¡Œè€å¸«æœƒå«å·²ç¶“å•éçš„åŒå­¸è¬›çµ¦å‰›ä¾†çš„åŒå­¸ã€‚å¯èƒ½å› ç‚ºå°ç­çš„é—œä¿‚ï¼Œè€å¸«éƒ½å¾ˆfreeï¼Œæƒ³è¦ä»€éº¼éƒ½å¯ä»¥å•å•çœ‹ã€‚</p><p>æœ€å¾Œæˆç¸¾çœ‹ä¸åˆ°ç´°é …ï¼Œä½†æ˜¯æ‹¿ A+ å°±æ²’æœ‰å»è·Ÿè€å¸«å•æˆç¸¾äº† XD</p><h1 id="ç¶²è·¯å®‰å…¨">ç¶²è·¯å®‰å…¨</h1><ul><li>è‹±æ–‡èª²åï¼šNetwork Security</li><li>æ°¸ä¹…èª²è™Ÿï¼šCSIC30093</li><li>æ•™å¸«ï¼šè¬çºŒå¹³</li></ul><h2 id="èª²ç¨‹å…§å®¹-4">èª²ç¨‹å…§å®¹</h2><p>åŸºæœ¬ä¸Šå°±æ˜¯ç…§è‘—ã€ŠWilliam Stallings, Network Security Essentials â€“Applications and Standards, Pearsonã€‹çš„å„å€‹ç« ç¯€ã€‚</p><h2 id="ä¸Šèª²æ–¹å¼-4">ä¸Šèª²æ–¹å¼</h2><p>æŠ•å½±ç‰‡åŠ ä¸Šå£è¿°è£œå……ã€‚</p><h2 id="è€ƒè©¦ä½œæ¥­-4">è€ƒè©¦ä½œæ¥­</h2><p>è€å¸«èªªæœƒåœ¨æ ¹æ“šç•¶å¹´çš„æˆç¸¾èª¿æ•´åˆ†é…ã€‚</p><ul><li>Midterm Exam: 30% Â± 10%<ul><li>è€ƒå‰å…­ç« ï¼Œäº¤å¤§è³‡å·¥è€ƒå¤é¡Œç³»çµ±ä¸Šé¢æœ‰è€ƒå¤ã€‚æœ‰ä¸€å®šçš„é¡Œæ•¸æœƒå’Œå‰å¹¾å¹´çš„é‡è¤‡ã€‚å»ºè­°å¯ä»¥å¤šåˆ·å¹¾å¹´ã€‚</li></ul></li><li>Final Exam: 30% Â± 10%<ul><li>å¤§è‡´è·ŸæœŸä¸­è€ƒä¸€æ¨£ã€‚</li></ul></li><li>Project + Homeworks + quizzes: 40% +- 20%<ul><li>Project æ˜¯å¾åŠ©æ•™çµ¦çš„ CVEä¸­æŒ‘ä¸€å€‹å‡ºä¾†é‡ç¾ï¼Œå»ºè­°æ—©é»é–‹å§‹æŒ‘å€‹ç°¡å–®çš„ä¾†å¯«ã€‚å ±å‘Šè¦åˆ†ä¸‰æ¬¡äº¤ï¼Œæ¯æ¬¡æœƒæœ‰ä¸åŒçš„é€²åº¦ã€‚åŸºæœ¬ä¸Šåˆ†æ•¸å¾ˆå¥½æ‹¿ï¼Œå…¨ç­å¹³å‡è¶…é«˜ã€‚</li></ul></li></ul><h2 id="å…¶ä»–-4">å…¶ä»–</h2><p>ä¸é»åï¼Œæ²’ç·šä¸Šï¼Œæ²’éŒ„å½±ã€‚æœƒæœ‰ pop quizã€‚é€™å­¸æœŸé‡åˆ°å…©æ¬¡ã€‚</p><h2 id="æœ€å¾Œæƒ³èªªçš„è©±-4">æœ€å¾Œæƒ³èªªçš„è©±</h2><p>ç”œçˆ›ã€‚å»ºè­°å»ä¸Šèª²ï¼Œæ‹¿åŸæ–‡æ›¸å•ƒå¾ˆèŠ±æ™‚é–“ï¼Œä½†æ˜¯å¯ä»¥å­¸åˆ°æ¯”è¼ƒå¤šæ±è¥¿ã€‚ <imgsrc="/assets/2023FallCourses/score.png" alt="Untitled" /></p><h1 id="è»Ÿé«”å®šç¾©ç¶²è·¯åŠç¶²è·¯åŠŸèƒ½è™›æ“¬åŒ–">è»Ÿé«”å®šç¾©ç¶²è·¯åŠç¶²è·¯åŠŸèƒ½è™›æ“¬åŒ–</h1><ul><li>è‹±æ–‡èª²åï¼šSoftware Defined Networks and Network FunctionVirtualization</li><li>æ°¸ä¹…èª²è™Ÿï¼šCSIC30127</li><li>æ•™å¸«ï¼šæ›¾å»ºè¶…ï¼ˆè¶…å“¥ï¼‰</li></ul><h2 id="èª²ç¨‹å…§å®¹-5">èª²ç¨‹å…§å®¹</h2><p>æ²’â€¦æ²’åœ¨ä¸Šèª² Orz</p><h2 id="ä¸Šèª²æ–¹å¼-5">ä¸Šèª²æ–¹å¼</h2><p>æŠ•å½±ç‰‡åŠ ä¸Šå£è¿°è£œå……ã€‚</p><h2 id="è€ƒè©¦ä½œæ¥­-5">è€ƒè©¦ä½œæ¥­</h2><ul><li>å¤§æ¦‚æ¯å…©é€±ä¸€å€‹ Labï¼Œdeadline çš„ä¸‹ä¸€å‘¨è¦å»å¯¦é«” Demoã€‚é€±è€Œå¾©å§‹ç›´åˆ°å¯«å®ŒFinal Project :)</li><li>Labs<ol type="1"><li>Environment Setup and Basic Operation (5%)</li><li>OpenFlow Protocol Observation and Flow Rule Installation (10%)</li><li>SDN-enabled Learning Bridge (15%)</li><li>Unicast DHCP Application (15%)</li><li>Proxy ARP (15%)</li><li>Network Function Virtualization (15%)</li></ol></li><li>Final Project: (25%)<ul><li>Virtual Routers</li><li>åŸºæœ¬ä¸Šå°±æ˜¯æŠŠå‰é¢çš„æ±è¥¿ä¸²èµ·ä¾†</li></ul></li></ul><h2 id="å…¶ä»–-5">å…¶ä»–</h2><p>ä¸é»åï¼Œæœ‰ç·šä¸Šï¼Œæœ‰éŒ„å½±ã€‚å› ç‚ºæ²’è€ƒè©¦ï¼Œæ‰€ä»¥åªè¦å¯ä»¥æŠŠåŠŸèª²å¯«å‡ºä¾†ï¼Œä¸ä¸Šèª²ä¹Ÿä¸æœƒçœŸçš„å‡ºå¤§äº‹ï¼ˆï¼Ÿ</p><h2 id="æœ€å¾Œæƒ³èªªçš„è©±-5">æœ€å¾Œæƒ³èªªçš„è©±</h2><p>å¸Œæœ›è¶…å“¥ä¸æœƒçœ‹åˆ°æˆ‘æ²’ä¸Šèª² QQ</p>]]></content:encoded>
      
      
      <category domain="https://blog.arui.dev/categories/NYCU/">NYCU</category>
      
      
      <category domain="https://blog.arui.dev/tags/NYCU/">NYCU</category>
      
      <category domain="https://blog.arui.dev/tags/Course/">Course</category>
      
      
      <comments>https://blog.arui.dev/2023FallCourses/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>å¾ä¸­è¯éƒµæ”¿åŒ¯æ¬¾åˆ° Firstrade çš„ç¾å…ƒå¸³æˆ¶</title>
      <link>https://blog.arui.dev/PostToFirstrade/</link>
      <guid>https://blog.arui.dev/PostToFirstrade/</guid>
      <pubDate>Sat, 24 Feb 2024 15:27:00 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;tldr&quot;&gt;TL;DR&lt;/h1&gt;
&lt;p&gt;å¾éƒµå±€åŒ¯æ¬¾åˆ°
Fristradeï¼Œç¶å®šç´„å®šåˆ°å…¥å¸³æœ€å¿«å¯èƒ½å¯ä»¥&lt;strong&gt;å››å¤©å®Œæˆ&lt;/strong&gt;ã€‚å…©å¤©æ˜¯ç¶å®šçš„æ™‚é–“ï¼Œå…©å¤©æ˜¯åŒ¯æ¬¾çš„æ™‚é–“ã€‚éƒµå±€é€™é‚Šçš„æ‰‹çºŒè²»å› ç‚ºæ´»å‹•æœŸé–“ï¼Œç”¨è¡Œå‹•éƒµå±€
App è½‰å¸³åªè¦ 168ã€‚ä¹‹å¾Œæœ€ä¾¿å®œæ‡‰è©²ä¹Ÿè¦ &lt;a
href=&quot;https://www.post.gov.tw/post/internet/B_saving/index.jsp?ID=3020204&quot;&gt;300
+ 100&lt;/a&gt;ã€‚&lt;strong&gt;ä¸­è½‰è¡Œæ”¶ 15 USD&lt;/strong&gt;ã€‚&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="tldr">TL;DR</h1><p>å¾éƒµå±€åŒ¯æ¬¾åˆ°Fristradeï¼Œç¶å®šç´„å®šåˆ°å…¥å¸³æœ€å¿«å¯èƒ½å¯ä»¥<strong>å››å¤©å®Œæˆ</strong>ã€‚å…©å¤©æ˜¯ç¶å®šçš„æ™‚é–“ï¼Œå…©å¤©æ˜¯åŒ¯æ¬¾çš„æ™‚é–“ã€‚éƒµå±€é€™é‚Šçš„æ‰‹çºŒè²»å› ç‚ºæ´»å‹•æœŸé–“ï¼Œç”¨è¡Œå‹•éƒµå±€App è½‰å¸³åªè¦ 168ã€‚ä¹‹å¾Œæœ€ä¾¿å®œæ‡‰è©²ä¹Ÿè¦ <ahref="https://www.post.gov.tw/post/internet/B_saving/index.jsp?ID=3020204">300+ 100</a>ã€‚<strong>ä¸­è½‰è¡Œæ”¶ 15 USD</strong>ã€‚</p><span id="more"></span><h1 id="æ™‚é–“ç·š">æ™‚é–“ç·š</h1><ul><li><code>2024/02/15 17:00</code> ç”³è«‹ç¶å®šç´„å®šå¸³æˆ¶</li><li><code>2024/02/17 12:01</code> é€šçŸ¥ç¶å®šå®Œæˆ</li><li><code>2024/02/19 14:19</code> åŒ¯æ¬¾è‡³ Firstrade</li><li><code>2024/02/21 09:26</code> çœ‹åˆ° Fristrade æ”¶åˆ°æ¬¾é …</li><li><code>2024/02/21 æ™šä¸Š</code> ç”³è«‹åŒ¯æ¬¾è£œåŠ©</li><li><code>2024/02/21 ä¸‹åˆ</code> æ”¶åˆ°åŒ¯æ¬¾è£œåŠ©</li></ul><h1 id="è²»ç”¨">è²»ç”¨</h1><table><thead><tr class="header"><th>é …ç›®</th><th>é‡‘é¡</th></tr></thead><tbody><tr class="odd"><td>ç”³è«‹ç¶å®šç´„å®šå¸³æˆ¶</td><td>NT$0</td></tr><tr class="even"><td>éƒµå±€åŒ¯æ¬¾ï¼ˆæ´»å‹•æœŸé–“ï¼‰</td><td>NT$158</td></tr><tr class="odd"><td>ä¸­è½‰è¡Œ</td><td>US$15</td></tr><tr class="even"><td>Firstrade è£œåŠ©</td><td>-US$21</td></tr><tr class="odd"><td>åˆè¨ˆèŠ±è²»</td><td>â‰ˆ -NT$31.70</td></tr></tbody></table><h1 id="ç´°ç¯€">ç´°ç¯€</h1><h2 id="ç”³è«‹ç¶å®šç´„å®šå¸³æˆ¶">ç”³è«‹ç¶å®šç´„å®šå¸³æˆ¶</h2><p>éœ€è¦çš„æ±è¥¿æœ‰ï¼šèº«åˆ†è­‰ã€éƒµå±€å­˜æ‘ºã€å°ç« å’Œ Firstradeçš„å¸³æˆ¶è³‡è¨Šã€‚é€™å€‹éç¨‹å¤§æ¦‚éœ€è¦ 5 åˆ†é˜ã€‚</p><p>åˆ°éƒµå±€å¾Œï¼Œæœƒçµ¦ä½ ä¸€å¼µç´™å¡«å¯«ï¼ŒåŸºæœ¬ä¸Šå°±ç…§è‘— Firstradeçµ¦çš„è³‡æ–™å¡«å°±å¥½äº†ã€‚å¯ä»¥åƒè€ƒä¸‹é¢é€™å¼µç…§ç‰‡ã€‚ï¼ˆæŠ±æ­‰é€™ç¨®å°æœ‹å‹å­—é«”ã€‚ï¼‰</p><figure><img src="/assets/PostToFirstrade/OutwardRemittanceForm.jpeg"alt="éƒµå±€ç´„å®šè¡¨æ ¼" /><figcaption aria-hidden="true">éƒµå±€ç´„å®šè¡¨æ ¼</figcaption></figure><p>ä¸å»ºè­°ç›´æ¥ç…§æŠ„ï¼ˆå› ç‚ºæˆ‘å­—å¾ˆé†œï¼‰ï¼Œè¦æŠ„é‚„æ˜¯ç…§è‘— Firstradeçš„è³‡æ–™æŠ„ã€‚æˆ–æ˜¯åƒè€ƒç¶²è·¯ä¸Šçš„æ•™å­¸ï¼Œä¾‹å¦‚<ahref="https://george-dewi.com/firstrade/#t-1688828552566">é€™ç¯‡</a>ã€‚</p><h2 id="éƒµå±€åŒ¯æ¬¾">éƒµå±€åŒ¯æ¬¾</h2><p>å¤§æ¦‚ç­‰ 2 å¤©ä¹‹å¾Œï¼Œå°±æœƒæ”¶åˆ°éƒµå±€çš„ç°¡è¨Šé€šçŸ¥ã€‚ç°¡è¨Šå…§å®¹å¤§æ¦‚æ˜¯é€™æ¨£ï¼š</p><blockquote><p>ä¸­è¯éƒµæ”¿å®¢æˆ¶æ‚¨å¥½ï¼šæ‚¨ç”³è«‹ç¶²è·¯ï¼ˆè¡Œå‹•ï¼‰éƒµå±€å¤–åŒ¯åŒ¯å‡ºåŒ¯æ¬¾æœå‹™å·²ç”Ÿæ•ˆï¼Œè«‹ç™»å…¥ç¶²è·¯éƒµå±€æˆ–ä¸‹è¼‰è¡Œå‹•éƒµå±€APPï¼Œå³å¯ä½¿ç”¨ç›¸é—œåŠŸèƒ½ã€‚</p></blockquote><p>æˆ‘æ˜¯ç”¨ <strong>è¡Œå‹•éƒµå±€ App</strong>ä¾†è½‰å¸³çš„ã€‚ä¸€é–‹å§‹é‚„ä»¥ç‚ºæ˜¯åœ¨ä¸€èˆ¬çš„è½‰å¸³çš„åœ°æ–¹ï¼Œçµæœä»–æ˜¯è¦å» Appä¸‹é¢çš„ã€Œæ›´å¤šã€â†’ã€Œå¤–åŒ¯åŒ¯æ¬¾ã€â†’ã€ŒåŒ¯å‡ºåŒ¯æ¬¾ã€æ‰æœ‰ã€‚åŒ¯å‡ºçš„æ•™å­¸ç¶²è·¯ä¸Šä¸€å®šä¹Ÿå¾ˆå¤šï¼Œè¦æ³¨æ„çš„å°±æ˜¯è¦å¯«å°é™„è¨€ã€‚å¯«éŒ¯å°±éº»ç…©äº†ï¼ˆæˆ‘ä¹Ÿæ²’é‡éå°±æ˜¯äº†XDï¼‰ã€‚</p><p>å› ç‚ºæˆ‘æ˜¯åœ¨æ´»å‹•æœŸé–“ï¼Œæ‰€ä»¥æ‰‹çºŒè²»åªè¦ 168ã€‚ä¸‹é¢æ˜¯åŒ¯æ¬¾ç´€éŒ„ã€‚</p><figure><img src="/assets/PostToFirstrade/PostRecord.png" alt="åŒ¯æ¬¾ç´€éŒ„" /><figcaption aria-hidden="true">åŒ¯æ¬¾ç´€éŒ„</figcaption></figure>]]></content:encoded>
      
      
      <category domain="https://blog.arui.dev/categories/Investment/">Investment</category>
      
      
      <category domain="https://blog.arui.dev/tags/Life/">Life</category>
      
      
      <comments>https://blog.arui.dev/PostToFirstrade/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[OS] Chapter 12 â€” Mass Storage System</title>
      <link>https://blog.arui.dev/[OS]Chapter-12/</link>
      <guid>https://blog.arui.dev/[OS]Chapter-12/</guid>
      <pubDate>Mon, 31 Jan 2022 10:12:24 GMT</pubDate>
      
      <description>&lt;div class=&quot;note default&quot;&gt;&lt;p&gt;&lt;a
href=&quot;https://arui-tw.notion.site/Chapter-12-Mass-Storage-System-0a7b775db2304a7c88922dc8457ade4a&quot;&gt;Notion
å¥½è®€ç‰ˆ&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;aside&gt;
&lt;p&gt;âœï¸ æ³›æŒ‡æ‰€æœ‰ secondary storage&lt;/p&gt;
&lt;/aside&gt;
&lt;h1 id=&quot;disk-structure&quot;&gt;Disk Structure&lt;/h1&gt;
&lt;p&gt;ç”±ç£ç›¤çµ„æˆï¼Œæœ€å°å„²å­˜å–®ä½æ˜¯ sectorï¼Œè²·ä¾†å°±åˆ‡æ­»çš„ï¼Œæ‰€ä»¥ç”¨è»Ÿé«”çš„ block
ï¼ˆå¤šå€‹ sectorï¼‰ä¾†æ§åˆ¶ã€‚Sector æœƒæœ‰
numberï¼Œæ‰€ä»¥å¯ä»¥å°ç‰¹å®šè³‡æ–™ä½œè®€å–ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/assets/%5BOS%5DChapter-12/Untitled.png&quot; /&gt;&lt;/p&gt;
&lt;h2 id=&quot;sectors-per-track&quot;&gt;&lt;strong&gt;Sectors per Track&lt;/strong&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Constant linear velocity ****(CLV)
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Density of bits per track æ˜¯å›ºå®šçš„&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;é€™æ¨£å…§åœˆçš„è³‡æ–™é‡å°±æœƒå°æ–¼å¤–åœˆçš„&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ä½†æ˜¯é€™æ¨£è®€å–è³‡æ–™çš„é€Ÿåº¦æœƒä¸å›ºå®š&lt;/p&gt;
&lt;p&gt;â†’ è®€å…§åœˆè¦è½‰æ¯”è¼ƒå¿«&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;applications: CD-ROM and DVD-ROM&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Constant angular velocity ****(CAV)
&lt;ul&gt;
&lt;li&gt;keep same rotation speed&lt;/li&gt;
&lt;li&gt;å…§åœˆ density æ¯”è¼ƒé«˜&lt;/li&gt;
&lt;li&gt;é€™æ¨£è½‰é€Ÿå°±ä¸ç”¨æ”¹&lt;/li&gt;
&lt;li&gt;applications: hard disks&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;disk-io&quot;&gt;Disk IO&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;/assets/%5BOS%5DChapter-12/Untitled%201.png&quot; /&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;EIDE, ATA, SATA (Serial ATA), USB, SCSI, etc&lt;/li&gt;
&lt;li&gt;æ•ˆèƒ½æœƒæœ‰å·®&lt;/li&gt;
&lt;li&gt;I/O bus is controlled by controller&lt;/li&gt;
&lt;/ul&gt;</description>
      
      
      
      <content:encoded><![CDATA[<div class="note default"><p><ahref="https://arui-tw.notion.site/Chapter-12-Mass-Storage-System-0a7b775db2304a7c88922dc8457ade4a">Notionå¥½è®€ç‰ˆ</a></p></div><aside><p>âœï¸ æ³›æŒ‡æ‰€æœ‰ secondary storage</p></aside><h1 id="disk-structure">Disk Structure</h1><p>ç”±ç£ç›¤çµ„æˆï¼Œæœ€å°å„²å­˜å–®ä½æ˜¯ sectorï¼Œè²·ä¾†å°±åˆ‡æ­»çš„ï¼Œæ‰€ä»¥ç”¨è»Ÿé«”çš„ blockï¼ˆå¤šå€‹ sectorï¼‰ä¾†æ§åˆ¶ã€‚Sector æœƒæœ‰numberï¼Œæ‰€ä»¥å¯ä»¥å°ç‰¹å®šè³‡æ–™ä½œè®€å–ã€‚</p><p><img src="/assets/%5BOS%5DChapter-12/Untitled.png" /></p><h2 id="sectors-per-track"><strong>Sectors per Track</strong></h2><ul><li>Constant linear velocity ****(CLV)<ul><li><p>Density of bits per track æ˜¯å›ºå®šçš„</p></li><li><p>é€™æ¨£å…§åœˆçš„è³‡æ–™é‡å°±æœƒå°æ–¼å¤–åœˆçš„</p></li><li><p>ä½†æ˜¯é€™æ¨£è®€å–è³‡æ–™çš„é€Ÿåº¦æœƒä¸å›ºå®š</p><p>â†’ è®€å…§åœˆè¦è½‰æ¯”è¼ƒå¿«</p></li><li><p>applications: CD-ROM and DVD-ROM</p></li></ul></li><li>Constant angular velocity ****(CAV)<ul><li>keep same rotation speed</li><li>å…§åœˆ density æ¯”è¼ƒé«˜</li><li>é€™æ¨£è½‰é€Ÿå°±ä¸ç”¨æ”¹</li><li>applications: hard disks</li></ul></li></ul><h2 id="disk-io">Disk IO</h2><p><img src="/assets/%5BOS%5DChapter-12/Untitled%201.png" /></p><ul><li>EIDE, ATA, SATA (Serial ATA), USB, SCSI, etc</li><li>æ•ˆèƒ½æœƒæœ‰å·®</li><li>I/O bus is controlled by controller</li></ul><span id="more"></span><h1 id="disk-scheduling">Disk Scheduling</h1><ul><li><p>Disk-access time has 3 major components</p><p><img src="/assets/%5BOS%5DChapter-12/Untitled%202.png" /></p><ul><li><p><strong>seektime</strong>ï¼šå»ç§»å‹•è®€å¯«é ­çš„ä½ç½®èŠ±çš„æ™‚é–“ï¼ˆé€šå¸¸æœ€æ…¢ï¼‰</p><p>â†’ ä¸»è¦å„ªåŒ–ç›®æ¨™</p></li><li><p>rotational latencyï¼šè½‰å‹•ç£ç›¤çš„æ™‚é–“ï¼ˆå¿«åˆ°å¯ä»¥è¢« ignoreï¼‰</p></li><li><p>read timeï¼šcontent transfertimeï¼ˆå–æ±ºæ–¼ä¸€æ¬¡è®€å¯«çš„è³‡æ–™é‡ï¼Œä¹Ÿå¯èƒ½é€™é‚Šæœ€æ…¢ï¼‰</p></li></ul></li><li><p>Disk bandwidth â€” # of bytes transferred/(complete of last req â€“start of first req)</p></li></ul><h2 id="fcfs-first-come-first-served">FCFS(First-Come-First-Served)</h2><ul><li>å•é¡Œçš„æè¿°æ–¹å¼æœƒæ˜¯ä¸€ä¸²æ•¸å­—ï¼Œä»£è¡¨è‘—ä»–æ˜¯ç¬¬å¹¾åœˆçš„è³‡æ–™ã€‚</li></ul><p><img src="/assets/%5BOS%5DChapter-12/Untitled%203.png" /></p><h2 id="sstf-shortest-seek-time-first">SSTF(Shortest-Seek-Time-First)</h2><ul><li>çœ‹å“ªä¸€å€‹é›¢ç›®å‰çš„ç£é ­æœ€è¿‘çš„å°±å»é‚£å€‹ï¼ˆGreedyï¼‰</li><li>æœ‰ starvationï¼Œå› ç‚º requestæœƒä¸åœåœ°ç™¼ç”Ÿï¼Œæ‰€ä»¥å¾ˆé çš„å¯èƒ½ä¸€ç›´è¢«æ’éšŠ</li><li>ä¸æ˜¯Optimalï¼Œå› ç‚ºåªèƒ½æ‰¾ç¾åœ¨é›¢æˆ‘æœ€è¿‘çš„ï¼Œå¯èƒ½ç­‰ä¸€ä¸‹é€²ä¾†çš„æœƒæ›´è¿‘ï¼Œä½†æ˜¯ä»–å°±è·³èµ°äº†ï¼Œä»–æ‡‰è©²è¦åœä¸€ä¸‹ç­‰é‚£å€‹æœªä¾†çš„å‚¢ä¼™ã€‚</li></ul><p><img src="/assets/%5BOS%5DChapter-12/Untitled%204.png" /></p><h2 id="scan-scheduling">SCAN Scheduling</h2><ul><li><p>é€šå¸¸çš„è§£</p></li><li><p>æˆ‘å°±ç§»å‹•æˆ‘çš„ï¼Œæœ‰å‰›å¥½å¯ä»¥åšçš„æˆ‘å°±åš</p></li><li><p>disk head move from one end to the other end</p></li><li><p>è½‰åˆ°åº•æœƒæ›æ–¹å‘</p><p>â‡’ æª¢æŸ¥æ™‚é–“ä¸ uniform</p></li><li><p>A.k.a elevator algorithm</p></li></ul><figure><img src="/assets/%5BOS%5DChapter-12/Untitled%205.png"alt="æ³¨æ„ä»–ç”šè‡³æœƒèµ°åˆ° 0 çš„ä½ç½®" /><figcaption aria-hidden="true">æ³¨æ„ä»–ç”šè‡³æœƒèµ°åˆ° 0 çš„ä½ç½®</figcaption></figure><h2 id="c-scan-scheduling">C-SCAN Scheduling</h2><ul><li><p>åªè½‰ä¸€å€‹æ–¹å‘ï¼Œèµ°åˆ°åº•å°±æŠŠç£é ­æ‹‰å›å»å¦ä¸€ç«¯</p><p>â‡’ æ¯”è¼ƒ Uniform</p></li><li><p>ï¼ˆRound robinï¼‰</p></li><li><p>åŸºæœ¬ä¸Šéƒ½ç”¨é€™å€‹ï¼Œä¸æœƒç”¨ SCAN</p></li></ul><p><img src="/assets/%5BOS%5DChapter-12/Untitled%206.png" /></p><h2 id="c-look-scheduling">C-LOOK Scheduling</h2><ul><li>ä¸€æ¨£åªè½‰ä¸€å€‹æ–¹å‘ï¼Œä½†æ˜¯ä¸æœƒèµ°åˆ°åº•</li><li>å¦‚æœå¾€å³é‚Šèµ°ï¼Œå°±æœƒå»çœ‹å³é‚Šçš„ä¸‹ä¸€å€‹æ˜¯èª°</li><li>å…¶å¯¦è·Ÿ SSTF å¾ˆåƒï¼Œå› ç‚ºä»–åœ¨ä¹Ÿæœƒè¢«å‰›é€²ä¾†çš„å¸¶è‘—èµ°ï¼ˆä½†æ˜¯ä¸æœƒstarvationï¼‰</li></ul><p><img src="/assets/%5BOS%5DChapter-12/Untitled%207.png" /></p><h2 id="summary">Summary</h2><ul><li>SSTF<ul><li>common and has a natural appeal, but not optimal</li></ul></li><li>SCAN<ul><li>perform better for disks with <strong>heavy load</strong></li><li><strong>No</strong> starvation problem</li></ul></li><li>C-SCAN<ul><li>More uniform wait time</li></ul></li><li>Performance is also influenced by the file-allocation method<ul><li><p>Contiguous: less head movement</p><p>â†’ å¯èƒ½æœƒå› ç‚ºæœ‰åŒæ™‚å¾ˆå¤š process åœ¨è®€ï¼Œæ‰€ä»¥é‚„æ˜¯ä¸ contiguousçš„</p></li><li><p>Indexed &amp; linked: greater head movement</p></li></ul></li></ul><h2 id="review-slides-i">Review Slides (I)</h2><ul><li>3 major components in disk-access time<ul><li>Seek</li><li>Rotation</li><li>Read</li></ul></li><li>Goal of disk-scheduling algorithm</li><li>Disk-scheduling algorithms<ul><li>FCFS</li><li>SSTF</li><li>SCAN</li><li>C-SCAN</li><li>C-LOOK</li></ul></li></ul><h1 id="disk-swap-space-management">Disk &amp; Swap-SpaceManagement</h1><h2 id="disk-formatting">Disk Formatting</h2><p>ä¸€èˆ¬çš„æ ¼å¼åŒ–æ˜¯ high level çš„æ ¼å¼åŒ–ï¼Œlow level çš„ disk çš„formattingï¼ˆé€™æ˜¯å‡ºå» å‰å°±åšå¥½çš„ï¼‰æ˜¯ dividing a disk (magnetic recordingmaterial) into sectors that disk controller can read and write ã€‚</p><ul><li>each sector = header + data area + trailer<ul><li>Header â€” metadataï¼Œi.e. where the sector is, the ID of thesector</li><li>trailer â€” error correction code, based on all bytes in dataarea</li></ul></li><li>High-level: partition and ç”¨ data block çš„æ–¹å¼å»å­˜å–</li></ul><h2 id="booting">Booting</h2><ul><li><p>Bootstrap program</p><ul><li><p>Initialize CPU, registers, device controllers, memory, and thenstarts OS</p></li><li><p>First <strong>bootstrap code</strong> stored in ROM</p></li><li><p>Complete bootstrap in the boot block the boot disk (aka systemdisk)</p></li></ul></li><li><p>Booting from a Disk in Windows 2000</p><p><img src="/assets/%5BOS%5DChapter-12/Untitled%208.png" /></p><ol type="1"><li>Run bootstrap code in ROM</li><li>Read boot code in MBR(Master boot record)</li><li>Find boot partition from partition table</li><li>Read boot sector/block and continue booting</li></ol></li></ul><h2 id="bad-block">Bad block</h2><p>A.k.a å£è»Œ</p><ul><li>Disk controller æ˜¯ç¬¬ä¸€å€‹å»è™•ç†çš„</li><li>IDE â€” çœ‹ ECC çŸ¥é“ä»–å£æ‰å°±ä¸æœƒè®€çµ¦ä¸Šé¢çš„ï¼Œè€Œæ˜¯ notifyä»–å€‘èªªã€Œæ¬¸ï¼Œå£å»å•Šï¼ã€</li><li>SCSI â€” é™¤äº†ä¸æœƒè®“ä½ ç”¨ä»¥å¤–ï¼Œé‚„æœƒæŠŠå£æ‰çš„åœ°æ–¹çš„å„²å­˜ç©ºé–“ recreateå‡ºä¾†ï¼Œæœ‰ä¸‹é¢å…©ç¨®æ–¹å¼<ol type="1"><li><p>Sector sparing (forwarding) â€”åƒæ˜¯æœ‰ç©ºç™½çš„æ’²å…‹ç‰Œï¼Œæœ‰ç‰Œä¸è¦‹å°±æ‹¿ç©ºçš„è£œå……ã€‚ä½†æ˜¯é€™æ¨£é€£çºŒçš„ sector #æœƒå­˜åœ¨ä¸é€£çºŒçš„åœ°æ–¹ï¼Œæ‰€ä»¥å£å¤ªå¤šæ•ˆèƒ½å°±æœƒè®Šå·®ã€‚</p><p>â†’ Run time åœ¨ç”¨çš„</p></li><li><p>Sector slipping â€” å¾å£æ‰çš„åœ°æ–¹é–‹å§‹å…¨éƒ¨å¾€å¾Œç§»ä¸€æ ¼ã€‚è¶…èŠ±æ™‚é–“ã€‚</p><p>â†’ Reboot åœ¨åšçš„</p></li></ol></li></ul><h2 id="swap-space">Swap space</h2><ul><li><ahref="https://hackmd.io/@Pl-eQT9CQaS0jhExKqL8_w/BkhOSR4jW/https%3A%2F%2Fhackmd.io%2Fs%2FryDbZPA7f#Swap-space">Seethis</a></li><li>ä¹‹å‰æ˜¯èªªç”± Virtual Memory æˆ–æ˜¯ Memory Manager ã€‚æŠŠä»–åˆ‡æˆå›ºå®šçš„pageï¼Œç„¶å¾Œç›´æ¥ mapã€‚</li><li>ä»–ä¹Ÿå¯ä»¥ç”¨ File system ä¾†ç®¡ã€‚æŠŠæ¯ä¸€å€‹ page è¨­æˆ 4kb çš„fileã€‚ç•¶è¦å­˜å–çš„æ™‚å€™å°±ç”¨ file name ç•¶ä½œ page IDã€‚</li><li>é€šå¸¸æ˜¯ç›´æ¥ç”¨ Memory Manager ä¾†æ“ä½œï¼Œä¸é€šé filesystemï¼Œæ¯”è¼ƒå¿«ã€‚</li><li>æ‰€ä»¥ç”¨ raw partition ä¸€å®šæ¯”è¼ƒå¿«ï¼Œä½†æ˜¯é€™æ¨£å°±æœƒæµªè²» raw partitionçš„ç©ºé–“ã€‚ä¸”å¦‚æœ VM ç”¨å¾—å¾ˆå…‡ï¼Œé‚£ swap spaceæœƒä¸å¤ ï¼Œé‚£å°±æ•ˆèƒ½å¤§é‡ä¸‹é™ã€‚</li><li>æ‰€ä»¥é€šå¸¸éƒ½ä¸€èµ·ç”¨ã€‚</li><li>Swap Space Allocation<ul><li>1st version: disk å’Œ memory éƒ½ä¸€ä»½ä¸€æ¨£çš„</li><li>2nd version:<ul><li>Solaris 1:<ul><li>Run time ç”¢ç”Ÿçš„æ‰å­˜ï¼Œåƒæ˜¯ code å°±ä¸ç”¨å­˜ï¼Œåæ­£éœ€è¦å†å» diskæ‹¿å°±å¥½</li><li>å¦‚æœ declare äº†ä½†æ˜¯é‚„æ²’ç”¨ï¼Œé‚£å°±ä¸ç”¨å­˜åœ¨ swap space</li></ul></li><li>Solaris 2:<ul><li>å…ˆä¸è¦å† swap space å­˜ copyï¼Œåªæœ‰åœ¨ swap out æ‰ create</li></ul></li></ul></li></ul></li></ul><p><img src="/assets/%5BOS%5DChapter-12/Untitled%209.png" /></p><h1 id="raid-structure">RAID Structure</h1><p>ç¾åœ¨å„²å­˜ç©ºé–“è¶Šä¾†è¶Šä¾¿å®œã€‚</p><p>RAID = <strong>R</strong>edundant <strong>A</strong>rrays of<strong>I</strong>nexpensive <strong>D</strong>isks</p><p>â†’ æƒ³è¦ç”¨å¾ˆå¤šä¾¿å®œçš„ç¡¬ç¢Ÿï¼Œç”¢ç”Ÿä¸€å€‹ powerful çš„ storage device</p><p>â†’ provide <strong>reliability</strong> via<strong>redundancy</strong> (å¤š backup)</p><p>â†’ improve <strong>performance</strong> via<strong>parallelism</strong> (å¹³è¡ŒåŒ–ï¼Œä¸€èµ·è®€å¯«)</p><ul><li>RAID is arranged into different levels<ul><li>Striping â†’ è³‡æ–™åˆ†æ•£</li><li>Mirror (Replication) â†’ è³‡æ–™ copy</li><li>Error-correcting code (ECC) &amp; Parity bit</li></ul></li></ul><h2 id="raid-0">RAID 0</h2><p><img src="/assets/%5BOS%5DChapter-12/Untitled%2010.png" /></p><p><img src="/assets/%5BOS%5DChapter-12/Untitled%2011.png" /></p><ul><li>Striping â†’ æŠŠæª”æ¡ˆåˆ‡å‰²ç”¨ Round Robin çš„æ–¹å¼æ“ºåˆ°å°ç¢Ÿä¸Šå»</li><li>Improve <strong>performance</strong> via<strong>parallelism</strong> â†’ å¤§è³‡æ–™å¯ä»¥åŒæ™‚è®€å–</li></ul><h2 id="raid-1">RAID 1</h2><p><img src="/assets/%5BOS%5DChapter-12/Untitled%2012.png" /></p><ul><li>Mirror â†’ è¤‡è£½</li><li>Provide <strong>reliability</strong> via <strong>redundancy</strong>â†’ é€šå¸¸æœ€å¤šä½œä¸‰å€‹ replica<ul><li>è®€å–é€Ÿåº¦æœƒè®Šæˆ N å€</li><li>å¯«å…¥é€Ÿåº¦ä¸è®Š</li></ul></li></ul><h2 id="raid-2-hamming-code">RAID 2: Hamming code</h2><p><img src="/assets/%5BOS%5DChapter-12/Untitled%2013.png" /></p><ul><li><p><a href="http://en.wikipedia.org/wiki/Hamming_code">Hammingcode</a> â†’ å¯ä»¥æ¨å‡ºæ˜¯èª°éºå¤±ç„¶å¾Œé‡å»ºå‡ºä¾†</p></li><li><p>E.g.: Hamming code(7,4)</p><p><img src="/assets/%5BOS%5DChapter-12/Untitled%2014.png" /></p><ul><li>4 data bits (on 4 disks) + 3 parity bits (on 3 disks)</li><li>åªæµªè²»çš„ 75%ï¼ˆRAID 1 æ˜¯ 100%ï¼‰</li></ul></li></ul><h2 id="raid-3-4-parity-bit">RAID 3 &amp; 4: Parity Bit</h2><p><img src="/assets/%5BOS%5DChapter-12/Untitled%2015.png" /></p><ul><li><p>ç¡¬ç¢Ÿå£æ‰ï¼Œä»–æœ¬ä¾†å°±æœƒè‡ªå·±èªªï¼Œæ‰€ä»¥æ‡‰è©²æ˜¯ä¸ç”¨åµæ¸¬çš„ï¼Œæˆ‘å€‘åªéœ€è¦recovery</p><p>â†’ a single parity bit is enough to correct error from a single diskfailure</p><p>â†’ æ‰€ä»¥æˆ‘å€‘åªéœ€è¦æµªè²» <code>1/N</code></p></li><li><p>RAID3: Bit-level striping; RAID 4: Block-level striping</p><p>â†’ RAID 4 recover çš„é€Ÿåº¦æœƒç•¥å¿«ï¼ˆé™¤éå£æ‰çš„åªæœ‰ä¸€å€‹bitï¼‰ï¼Œå› ç‚ºè®€å–éƒ½æ˜¯ä¸€å€‹ block åœ¨æ“ä½œçš„ï¼Œæ‰€ä»¥ä»–å°±ä¸ç”¨æ©«è·¨å¥½å¹¾çš„ diskäº†</p></li><li><p>è®€å–é€Ÿåº¦æ˜¯ <code>N - 1</code> å€ï¼Œå¯«å…¥é€Ÿåº¦ä¸è®Šï¼ˆå› ç‚ºè¦å»å¯«å­˜Parity bit çš„é‚£é¡†ï¼‰</p></li></ul><h2 id="raid-5-distributed-parity">RAID 5: Distributed Parity</h2><p><img src="/assets/%5BOS%5DChapter-12/Untitled%2016.png" /></p><ul><li>Load balancing â†’ æŠŠ parity bit åˆ†æ•£åœ¨å„å€‹ disk</li><li>æœ€å¸¸è¦‹çš„</li><li>Read å¯ä»¥æ˜¯ <code>N</code> å€äº†</li><li>Write<ul><li><p>Method 1</p><p><img src="/assets/%5BOS%5DChapter-12/Untitled%2017.png" /></p><ol type="1"><li>è®€ N-2 ç­† data</li><li>é‡ç®— pb</li><li>å¯«é€²å»é‚£å…©å€‹</li></ol><p>â‡’ N / (N - 2 + 2) = 1</p></li><li><p>Method 2</p><p><img src="/assets/%5BOS%5DChapter-12/Untitled%2018.png" /></p><ol type="1"><li>è®€åŸæœ¬çš„å€¼</li><li>ç®—å‡ºä¿®æ”¹çš„å½±éŸ¿</li><li>å¯«å…¥</li></ol><p>â‡’ N / 4 times faster</p></li></ul></li></ul><h2 id="raid-6-pq-dual-parity-redundancy">RAID 6: P+Q Dual ParityRedundancy</h2><p><img src="/assets/%5BOS%5DChapter-12/Untitled%2019.png" /></p><ul><li>ä½ æœ‰ä¸åªä¸€å€‹ PB â‡’ å¯ä»¥å¤šå€‹ç¡¬ç¢Ÿå£æ‰</li></ul><h2 id="hybrid-raid">Hybrid RAID</h2><p><img src="/assets/%5BOS%5DChapter-12/Untitled%2020.png" /></p><ul><li>RAID 0+1: Stripe then replicate â†’ ä¿è­·èƒ½åŠ›æ¯”è¼ƒå¼±</li><li>RAID 1+0: Replicate then stripe</li><li>å…ˆå¯«å…ˆåš</li></ul><h2 id="review-slides-ii">Review Slides (II)</h2><ul><li>Swap space using FS? Raw partition?</li><li>How to reduce swap space usage?</li><li>RAID disks? Purpose?</li><li>RAID-0~6?</li><li>RAID 0+1, RAID 1+0</li></ul><h1 id="textbook-questions">Textbook Questions</h1><p><img src="/assets/%5BOS%5DChapter-12/Untitled%2021.png" /></p><p><img src="/assets/%5BOS%5DChapter-12/Untitled%2022.png" /></p><div class="note warning"><p>æ­¤ç­†è¨˜ç‚ºæ¸…è¯å¤§å­¸å‘¨å¿—é æ•™æˆä½œæ¥­ç³»çµ±ä¹‹èª²å ‚ç­†è¨˜ï¼Œæ‰€æœ‰å…§å®¹åŠåœ–ç‰‡çš†å–ææ–¼èª²å ‚å…§å®¹ã€‚<br />å¦‚å…§å®¹æœ‰èª¤ï¼Œæ­¡è¿ä¾†ä¿¡ <ahref="mailto:mail@arui.dev">mail@arui.dev</a>ã€‚</p></div>]]></content:encoded>
      
      
      <category domain="https://blog.arui.dev/categories/Operating-System-Notes/">Operating System Notes</category>
      
      
      <category domain="https://blog.arui.dev/tags/Operating-System/">Operating System</category>
      
      <category domain="https://blog.arui.dev/tags/Notes/">Notes</category>
      
      
      <comments>https://blog.arui.dev/[OS]Chapter-12/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[OS] Chapter 13 â€” I/O System</title>
      <link>https://blog.arui.dev/[OS]Chapter-13/</link>
      <guid>https://blog.arui.dev/[OS]Chapter-13/</guid>
      <pubDate>Mon, 31 Jan 2022 10:12:24 GMT</pubDate>
      
      <description>&lt;div class=&quot;note default&quot;&gt;&lt;p&gt;&lt;a
href=&quot;https://www.notion.so/arui-tw/Chapter-13-I-O-System-7f1b37167d5b4a77bc4e18c96b74ed95&quot;&gt;Notion
å¥½è®€ç‰ˆ&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;h1 id=&quot;overview&quot;&gt;Overview&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;é›»è…¦ä¸æ˜¯åœ¨åš I/O å°±æ˜¯åœ¨åšè¨ˆç®—&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;I/O devices&lt;/strong&gt;: tape, HD, mouse, joystick, network
card, screen, flash disks, etc&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;I/O subsystem&lt;/strong&gt;: the methods to &lt;strong&gt;control
all I/O devices&lt;/strong&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Two conflicting trends&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æˆ‘å€‘å¸Œæœ›ä»–æ˜¯ interfaceï¼Œé€™æ¨£æ‰å¯ä»¥ standardization çš„æ§åˆ¶&lt;/li&gt;
&lt;li&gt;ä½†æ˜¯ä»–åˆå¾ˆå¤šæ¨£æ€§&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Device drivers&lt;/strong&gt;: a uniform device-access
&lt;strong&gt;interface&lt;/strong&gt; to the I/O subsystem&lt;/p&gt;
&lt;p&gt;â‡’ Similar to system calls between apps and OS&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Device categories&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Storage devices: disks, tapes&lt;/li&gt;
&lt;li&gt;Transmission devices: network cards, modems&lt;/li&gt;
&lt;li&gt;Human-interface devices: keyboard, screen, mouse&lt;/li&gt;
&lt;li&gt;Specialized devices: joystick, touchpad&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;io-hardware&quot;&gt;I/O Hardware&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Port&lt;/strong&gt;: A &lt;strong&gt;connection point&lt;/strong&gt;
between I/O devices and the host. æ¯å€‹ port éƒ½æœ‰è‡ªå·±çš„ IDï¼Œé‚£å°±æ˜¯ device
å°æ–¼é›»è…¦çš„ identifierã€‚&lt;/p&gt;
&lt;p&gt;â†’ E.g.: USB ports&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Controller&lt;/strong&gt;: A collection of electronics that can
operate a port, a bus, or a device&lt;/p&gt;
&lt;p&gt;â‡’ A controller could have its own processor, memory, etc. (E.g.: SCSI
controller)&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Bus&lt;/strong&gt;: A set of &lt;strong&gt;wires and a well-defined
protocol&lt;/strong&gt; that specifies messages sent over the
wiresï¼ˆé€£æ¥çš„æ–¹å¼ï¼Œé™¤äº†ç‰©ç†ç›¸æ¥ï¼Œé‚„æœ‰ protocol çš„éƒ¨åˆ†ï¼‰&lt;/p&gt;
&lt;p&gt;â†’ E.g.: PCI bus&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
      
      
      
      <content:encoded><![CDATA[<div class="note default"><p><ahref="https://www.notion.so/arui-tw/Chapter-13-I-O-System-7f1b37167d5b4a77bc4e18c96b74ed95">Notionå¥½è®€ç‰ˆ</a></p></div><h1 id="overview">Overview</h1><ul><li><p>é›»è…¦ä¸æ˜¯åœ¨åš I/O å°±æ˜¯åœ¨åšè¨ˆç®—</p></li><li><p><strong>I/O devices</strong>: tape, HD, mouse, joystick, networkcard, screen, flash disks, etc</p></li><li><p><strong>I/O subsystem</strong>: the methods to <strong>controlall I/O devices</strong></p></li><li><p>Two conflicting trends</p><ul><li>æˆ‘å€‘å¸Œæœ›ä»–æ˜¯ interfaceï¼Œé€™æ¨£æ‰å¯ä»¥ standardization çš„æ§åˆ¶</li><li>ä½†æ˜¯ä»–åˆå¾ˆå¤šæ¨£æ€§</li></ul></li><li><p><strong>Device drivers</strong>: a uniform device-access<strong>interface</strong> to the I/O subsystem</p><p>â‡’ Similar to system calls between apps and OS</p></li><li><p>Device categories</p><ul><li>Storage devices: disks, tapes</li><li>Transmission devices: network cards, modems</li><li>Human-interface devices: keyboard, screen, mouse</li><li>Specialized devices: joystick, touchpad</li></ul></li></ul><h1 id="io-hardware">I/O Hardware</h1><ul><li><p><strong>Port</strong>: A <strong>connection point</strong>between I/O devices and the host. æ¯å€‹ port éƒ½æœ‰è‡ªå·±çš„ IDï¼Œé‚£å°±æ˜¯ deviceå°æ–¼é›»è…¦çš„ identifierã€‚</p><p>â†’ E.g.: USB ports</p></li><li><p><strong>Controller</strong>: A collection of electronics that canoperate a port, a bus, or a device</p><p>â‡’ A controller could have its own processor, memory, etc. (E.g.: SCSIcontroller)</p></li><li><p><strong>Bus</strong>: A set of <strong>wires and a well-definedprotocol</strong> that specifies messages sent over thewiresï¼ˆé€£æ¥çš„æ–¹å¼ï¼Œé™¤äº†ç‰©ç†ç›¸æ¥ï¼Œé‚„æœ‰ protocol çš„éƒ¨åˆ†ï¼‰</p><p>â†’ E.g.: PCI bus</p></li></ul><span id="more"></span><p><img src="/assets/%5BOS%5DChapter-13/Untitled.png" /></p><p><img src="/assets/%5BOS%5DChapter-13/Untitled%201.png" /></p><h1 id="io-methods">I/O Methods</h1><ul><li>é€é <code>port address</code> åš <code>ä»€éº¼äº‹</code></li><li>Port address ç”¨ä¸€å€‹ç°¡å–®çš„ table å°±å¥½äº†ï¼Œåæ­£ä¹Ÿæ²’æœ‰å¾ˆå¤§</li><li>Each I/O port consists of four registers (1~4 Bytes)<ul><li>Data-in register â€” In buffer</li><li>Data-out register â€” Out buffer</li><li>Status register â€” ç‹€æ…‹çš„å€¼</li><li>Control register â€” command</li></ul></li></ul><h2 id="io-methods-categorization">I/O Methods Categorization</h2><ul><li><p>Depending on how to address a device</p><ul><li><p>Port-mapped I/O</p><ul><li>ç›´æ¥ç”¨ I/O instruction (e.g. <code>IN</code>, <code>OUT</code>)</li></ul></li><li><p>Memory-mapped I/O</p><ul><li>Access by standard data-transfer instruction (e.g.<code>MOV</code>)</li></ul><p>ğŸ™‚Â More efficient for <strong>large memory I/O</strong> (e.g. graphiccard)</p><p>â˜¹ï¸Â Vulnerable to accidental modification, error</p></li></ul></li><li><p>Depending on how to interact with a device:</p><ul><li><p><strong>Poll</strong> (busy-waiting): processor periodicallycheck status register of a device.ä¸åœåœ°ç¢ºèªå¥½äº†æ²’ï¼Œå•¥æ™‚å¯ä»¥ä½œä¸‹ä¸€å€‹</p><p>â†’ å¦‚æœé‡ä¸å¤šï¼Œç”¨é€™å€‹</p></li><li><p><strong>Interrupt</strong>: device notify processor of itscompletion. I/O å¥½äº†ä»–æœƒç›´æ¥ call interrupt è·Ÿä½ çš„ç¨‹å¼è¬›ã€‚</p></li></ul><p>â‡’ é€šå¸¸æœƒ Memory-mapped I/O ï¼‹ Interruptæˆ–æ˜¯å¦å¤–å…©å€‹ç›¸åŠ ï¼Œä¸ç„¶æœƒäº’ç›¸æŠµéŠ·å¥½è™•ã€‚</p></li><li><p>Depending on who to control the transfer:</p><ul><li><p><strong>Programmed I/O</strong>: transfer controlled by CPU</p><p>â†’ éœ€è¦ä¸€ç›´ç”¨ CPU</p></li><li><p><strong>Direct memory access</strong> (DMA) I/O: controlled by<strong>DMA controller</strong> (a special purpose controller)</p><p>â†’ åªè² è²¬ I/O</p><ul><li>Design for <strong>large data transfer</strong></li></ul></li></ul></li></ul><h2 id="interrupt">Interrupt</h2><ul><li><p>Interrupt Vector Table</p><figure><img src="/assets/%5BOS%5DChapter-13/Untitled%202.png"alt="æ•¸å­—è¶Šå°è¶Šé‡è¦" /><figcaption aria-hidden="true">æ•¸å­—è¶Šå°è¶Šé‡è¦</figcaption></figure></li><li><p>Interrupt Prioritization</p><ul><li><p>Maskable interrupt â€” æœ‰ä¸€äº›ä¸é‡è¦çš„ interrupt æœƒè¢« maskæ‰</p></li><li><p>Non-maskable interrupt (NMI): highest-priority, never masked</p><p>â†’ Often used for power-down, memory error</p></li></ul></li><li><p>Interrupt-Driven I/O</p><p><img src="/assets/%5BOS%5DChapter-13/Untitled%203.png" /></p></li><li><p>CPU and device Interrupt handshake</p><ol type="1"><li>Device asserts <strong>interrupt request</strong> (IRQ) â†’ I/Oè¦è¨»å†Šä»–çš„ interruptï¼Œé€™æ¨£ OS æ‰çŸ¥é“è¦å»è™•ç†èª°</li><li>CPU checks the <strong>interrupt request line</strong> at thebeginning of each instruction cycle</li><li>Save the status and address of interrupted process</li><li>CPU acknowledges the interrupt and search the <strong>interruptvector</strong> table for interrupt handler routines</li><li>CPU fetches the next instruction from the <strong>handlerroutine</strong></li><li>Restore interrupted process after executing interrupt handlerroutine</li></ol></li></ul><h2 id="dma-direct-memory-access">DMA (Direct Memory Access)</h2><p><img src="/assets/%5BOS%5DChapter-13/Untitled%204.png" /></p><p>File System â†’ ï¼ˆæˆ‘è¦è®€å¤šå°‘è³‡æ–™ï¼Œè¦è®€åˆ° Xï¼‰â†’ device driver â†’ï¼ˆèªªã€Œæˆ‘è¦è®€å¤šå°‘è³‡æ–™ï¼Œè¦è®€åˆ° Xã€ï¼Œä¸¦ register ä¸€å€‹ interruptèªªã€Œåšå®Œä¹‹å¾Œè·Ÿæˆ‘èªªæ¬¸ã€ï¼‰ â†’ disk controller â†’ ï¼ˆåˆå§‹åŒ–DMAï¼Œå› ç‚ºä»–åªèƒ½å‚³å¾ˆå°‘çš„è³‡æ–™ï¼Œæ‰€ä»¥ DMA å°±é–‹å§‹ä¸åœåœ°é€æ¬ç§»çš„æŒ‡ä»¤åˆ° diskcontrollerï¼Œç„¶å¾Œå­˜åˆ° Xï¼‰â†’ DMA â†’ ï¼ˆThrough interrupt åˆ° CPU èªªæˆ‘æ¬å®Œäº†ï¼‰â†’CPU â†’ çœ‹åˆ°æ¬å®Œäº†ï¼Œé–‹å¿ƒï¼šï¼‰</p><p>æ³¨æ„é‚£å€‹ X é€šå¸¸æ˜¯ physical çš„ addressï¼Œä¸ç„¶å°±è¦å»çœ‹ pagetableï¼Œé‚£å°±éœ€è¦ CPU å»è·‘ OS ä¾†çœ‹ã€‚</p><p>â†’ é€™æ¨£ Virtual Memory å°±æœ‰é»å¤±æ•ˆï¼Œå› ç‚ºé‚£å¡Šå°±è¢« fix ä½äº†ã€‚</p><h2 id="review-slides-i">Review Slides ( I )</h2><ul><li>Definition of I/O port? Bus? Controller?</li><li><strong>I/O device and CPU communication?</strong><ul><li><strong>Port-mapped vs. Memory-mapped</strong></li><li><strong>Poll vs. Interrupt</strong></li><li><strong>Programmed I/O vs. DMA</strong></li></ul></li><li>Steps to handle an interrupt I/O and DMA request?</li></ul><h1 id="kernel-io-subsystem">Kernel I/O Subsystem</h1><ul><li><p><strong>I/O Scheduling</strong></p></li><li><p><strong>Buffering â€” Bridge é€Ÿå·®</strong></p></li><li><p><strong>Caching â€”</strong> Always just a copy; Key toperformance</p></li><li><p><strong>Spooling â€” åƒ bufferï¼Œä½†æ˜¯æ˜¯ all ornothing</strong></p></li><li><p><strong>Error handling â€”</strong> when I/O error happens</p></li><li><p><strong>I/O protection â€”</strong> Privilegedinstructions</p></li><li><p>Device-status Table</p><p><img src="/assets/%5BOS%5DChapter-13/Untitled%205.png" /></p></li><li><p>Life Cycle of An I/O Request</p><p><img src="/assets/%5BOS%5DChapter-13/Untitled%206.png" /></p></li></ul><h1 id="performance">Performance</h1><ul><li>Intercomputer Communications</li></ul><h1 id="application-interface">Application Interface</h1><h1 id="textbook-questions">Textbook Questions</h1><p><img src="/assets/%5BOS%5DChapter-13/Untitled%207.png" /></p><p><img src="/assets/%5BOS%5DChapter-13/Untitled%208.png" /></p><div class="note warning"><p>æ­¤ç­†è¨˜ç‚ºæ¸…è¯å¤§å­¸å‘¨å¿—é æ•™æˆä½œæ¥­ç³»çµ±ä¹‹èª²å ‚ç­†è¨˜ï¼Œæ‰€æœ‰å…§å®¹åŠåœ–ç‰‡çš†å–ææ–¼èª²å ‚å…§å®¹ã€‚<br />å¦‚å…§å®¹æœ‰èª¤ï¼Œæ­¡è¿ä¾†ä¿¡ <ahref="mailto:mail@arui.dev">mail@arui.dev</a>ã€‚</p></div>]]></content:encoded>
      
      
      <category domain="https://blog.arui.dev/categories/Operating-System-Notes/">Operating System Notes</category>
      
      
      <category domain="https://blog.arui.dev/tags/Operating-System/">Operating System</category>
      
      <category domain="https://blog.arui.dev/tags/Notes/">Notes</category>
      
      
      <comments>https://blog.arui.dev/[OS]Chapter-13/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[OS] Chapter 11 â€” File System Implementation</title>
      <link>https://blog.arui.dev/[OS]Chapter-11/</link>
      <guid>https://blog.arui.dev/[OS]Chapter-11/</guid>
      <pubDate>Mon, 31 Jan 2022 10:11:24 GMT</pubDate>
      
      <description>&lt;div class=&quot;note default&quot;&gt;&lt;p&gt;&lt;a
href=&quot;https://arui-tw.notion.site/Chapter-11-File-System-Implementation-3bd2f7997ad041ac8966f8bd52fd1b18&quot;&gt;Notion
å¥½è®€ç‰ˆ&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;h1 id=&quot;file-system-structure&quot;&gt;File-System Structure&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€å€‹ disk æä¾›çš„æœ€å°å–®ä½æ˜¯ sectorsï¼ˆusually 512 bytesï¼‰&lt;/li&gt;
&lt;li&gt;ä½†æ˜¯ mapping çš„æ™‚å€™ä¸å–œæ­¡ç”¨ sectorï¼Œå¤ªå°äº†&lt;/li&gt;
&lt;li&gt;æ‰€ä»¥éƒ½ç”¨ Blocksï¼Œé€šå¸¸æ˜¯å››åˆ°åå¹¾å€‹ sectors&lt;/li&gt;
&lt;li&gt;ä¸€å€‹ OS å¯ä»¥ support &amp;gt; 1 å€‹ FS type&lt;/li&gt;
&lt;li&gt;éœ€è¦å…©å€‹ interface
&lt;ul&gt;
&lt;li&gt;å°ä¸Šï¼šuser programs&lt;/li&gt;
&lt;li&gt;å°ä¸‹ï¼šphysical storage (disk)&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;layered-file-system&quot;&gt;Layered File System&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;æœ€ä¸Šå±¤æ˜¯ API&lt;/li&gt;
&lt;li&gt;æœ€ä¸‹å±¤ï¼ˆæœ€çµ‚è¦å¯«åˆ° disk ä¸Šé¢å»çš„ï¼‰è¦é€é driver å¯«éå»ï¼Œé‚£ driver
è¦çš„æ˜¯å–®ä½æ˜¯ sector&lt;/li&gt;
&lt;li&gt;Logical file system â€” æ ¹æ“š file path æ‰¾åˆ° file
IDï¼Œä¹Ÿè¦å»åˆ¤æ–·æ¬Šé™ï¼ˆi.e. åˆ¤æ–· API æ˜¯ä¸æ˜¯åˆæ³•å¯åŸ·è¡Œçš„æ±è¥¿ï¼‰&lt;/li&gt;
&lt;li&gt;File-organization module â€” æ¯ä¸€å€‹ FS æœ€ä¸ä¸€æ¨£çš„åœ°æ–¹ã€‚è¦æ‰¾åˆ°åœ¨
logical ä¸­çš„ä½å€å°æ‡‰åˆ°çš„ physical çš„åœ°æ–¹ã€‚ï¼ˆç”šè‡³éœ€è¦ map
åˆ°ä¸åŒçš„é›»è…¦ï¼‰&lt;/li&gt;
&lt;li&gt;Basic File system â€” æœ€åŸºæœ¬çš„ I/O çš„å‹•ä½œï¼ˆè·Ÿæª”æ¡ˆç®¡ç†ç„¡é—œå•¦ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;figure&gt;
&lt;img src=&quot;/assets/%5BOS%5DChapter-11/Untitled.png&quot;
alt=&quot;å³é‚Šçš„åè©ä¸ç”¨è¨˜&quot; /&gt;
&lt;figcaption aria-hidden=&quot;true&quot;&gt;å³é‚Šçš„åè©ä¸ç”¨è¨˜&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;ä¹‹æ‰€ä»¥ä¸€å€‹ &lt;code&gt;fread&lt;/code&gt; å¯ä»¥å°ä¸åŒçš„ file system
ä½œæ“ä½œå°±æ˜¯ä¸­é–“æœ‰ FS manager (VFS â€” Virtual File System)&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/assets/%5BOS%5DChapter-11/Untitled%201.png&quot; /&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
      
      
      
      <content:encoded><![CDATA[<div class="note default"><p><ahref="https://arui-tw.notion.site/Chapter-11-File-System-Implementation-3bd2f7997ad041ac8966f8bd52fd1b18">Notionå¥½è®€ç‰ˆ</a></p></div><h1 id="file-system-structure">File-System Structure</h1><ul><li>ä¸€å€‹ disk æä¾›çš„æœ€å°å–®ä½æ˜¯ sectorsï¼ˆusually 512 bytesï¼‰</li><li>ä½†æ˜¯ mapping çš„æ™‚å€™ä¸å–œæ­¡ç”¨ sectorï¼Œå¤ªå°äº†</li><li>æ‰€ä»¥éƒ½ç”¨ Blocksï¼Œé€šå¸¸æ˜¯å››åˆ°åå¹¾å€‹ sectors</li><li>ä¸€å€‹ OS å¯ä»¥ support &gt; 1 å€‹ FS type</li><li>éœ€è¦å…©å€‹ interface<ul><li>å°ä¸Šï¼šuser programs</li><li>å°ä¸‹ï¼šphysical storage (disk)</li></ul></li></ul><h2 id="layered-file-system">Layered File System</h2><ul><li>æœ€ä¸Šå±¤æ˜¯ API</li><li>æœ€ä¸‹å±¤ï¼ˆæœ€çµ‚è¦å¯«åˆ° disk ä¸Šé¢å»çš„ï¼‰è¦é€é driver å¯«éå»ï¼Œé‚£ driverè¦çš„æ˜¯å–®ä½æ˜¯ sector</li><li>Logical file system â€” æ ¹æ“š file path æ‰¾åˆ° fileIDï¼Œä¹Ÿè¦å»åˆ¤æ–·æ¬Šé™ï¼ˆi.e. åˆ¤æ–· API æ˜¯ä¸æ˜¯åˆæ³•å¯åŸ·è¡Œçš„æ±è¥¿ï¼‰</li><li>File-organization module â€” æ¯ä¸€å€‹ FS æœ€ä¸ä¸€æ¨£çš„åœ°æ–¹ã€‚è¦æ‰¾åˆ°åœ¨logical ä¸­çš„ä½å€å°æ‡‰åˆ°çš„ physical çš„åœ°æ–¹ã€‚ï¼ˆç”šè‡³éœ€è¦ mapåˆ°ä¸åŒçš„é›»è…¦ï¼‰</li><li>Basic File system â€” æœ€åŸºæœ¬çš„ I/O çš„å‹•ä½œï¼ˆè·Ÿæª”æ¡ˆç®¡ç†ç„¡é—œå•¦ï¼‰</li></ul><figure><img src="/assets/%5BOS%5DChapter-11/Untitled.png"alt="å³é‚Šçš„åè©ä¸ç”¨è¨˜" /><figcaption aria-hidden="true">å³é‚Šçš„åè©ä¸ç”¨è¨˜</figcaption></figure><ul><li><p>ä¹‹æ‰€ä»¥ä¸€å€‹ <code>fread</code> å¯ä»¥å°ä¸åŒçš„ file systemä½œæ“ä½œå°±æ˜¯ä¸­é–“æœ‰ FS manager (VFS â€” Virtual File System)</p><p><img src="/assets/%5BOS%5DChapter-11/Untitled%201.png" /></p></li></ul><span id="more"></span><h1 id="file-system-implementation">File System Implementation</h1><h2 id="on-disk-structure">On-Disk Structure</h2><p>â†’ å› ç‚º reboot å¾Œï¼Œè³‡æ–™é‚„æ˜¯è¦åœ¨ï¼Œæ‰€ä»¥å’Œä¹‹å‰çš„ä¸ä¸€æ¨£</p><ul><li>Boot control <strong>block</strong> ****(per partition) â€” é—œæ–¼booting çš„ code æˆ–è³‡è¨Š<ul><li>è£ OS ä»–å°±æœƒå¹«ä½  create èµ·ä¾†</li><li>ä¸€å€‹ partition åªæœƒæœ‰ä¸€å€‹ï¼ˆä¹Ÿæœ€å¤šä¸€å€‹ï¼‰ boot controlblockï¼Œé€šå¸¸æœƒæ”¾åœ¨æœ€ä¸Šé¢</li><li>å¦‚æœä¸æ˜¯é–‹æ©Ÿæ§½ï¼Œé‚£å°±ä¸æœƒæœ‰é€™å€‹ block</li><li>Unix File System â†’ boot block; NTFS â†’ partition boot sector</li></ul></li><li>Partition control block ****(per partition) â€” é—œæ–¼é€™å€‹ partitionçš„è³‡è¨Š<ul><li>details: # of blocks, block size, free-block-list, free FCBpointers, etc</li><li>UFS â†’ superblock; NTFS â†’ Master File Table</li><li>å¦‚æœæ²’æœ‰ boot control blockï¼Œé‚£ä»–æ‡‰è©²æœƒåœ¨æœ€å‰é¢</li></ul></li><li>File control block (per file) â€” file çš„ metadata<ul><li>æ³¨æ„ä¸å­˜ dataï¼Œdata æœƒæœ‰ä¸€å€‹æŒ‡æ¨™æŒ‡éå»</li><li>UFS â€” <strong>inode</strong>; NTFS: stored in MFT (relationaldatabase)</li></ul></li><li>Directory structure (per file system): organize files</li></ul><p><img src="/assets/%5BOS%5DChapter-11/Untitled%202.png" /></p><ul><li><p><code>$ stat</code></p><p><img src="/assets/%5BOS%5DChapter-11/Untitled%203.png" /></p></li></ul><h2 id="in-memory-structure">In-Memory Structure</h2><p>â†’ ä¸€æ¨£çš„ï¼Œåªæ˜¯å“ªäº›æ±è¥¿è¦è¢« load åˆ° memory è£¡é¢</p><ul><li>in-memory partition table â€” æœ‰äººè¢« mountï¼Œä»–å°±æœƒå­˜é—œæ–¼é€™å€‹ partitionçš„è³‡è¨Šã€‚Unmount å°±æœƒè¢«ç§»é™¤ã€‚</li><li>in-memory directory structure â€” æœ€è¿‘ accessed åˆ°çš„ directory</li><li>system-wide open-file table â€” è¢« open çš„ file çš„ file controlblock</li><li>per-process open-file table â€” process å°æ–¼ä¸€å€‹ file éœ€è¦ keepçš„è³‡è¨Šï¼Œä¸” file close çš„æ™‚å€™ï¼Œä»–å°±æœƒè¢«æ¸…æ‰ï¼Œä¸æœƒå¯«å›å»ã€‚</li></ul><p><strong>File-Open</strong></p><p><img src="/assets/%5BOS%5DChapter-11/Untitled%204.png" /></p><ul><li>å¦‚æœæ²’è®€éé€™å€‹ directoryï¼Œä»–å°±æœƒå» disk ï¼ˆsecondarystorageï¼‰çš„åœ°æ–¹æŠŠä»–æ‹‰å‡ºä¾†</li><li>Directory çš„æœ€å¾Œæ¥çš„æ˜¯ file control block</li></ul><p><strong>File-Read</strong></p><p><img src="/assets/%5BOS%5DChapter-11/Untitled%205.png" /></p><ul><li>ä¸Šé¢ open å¥½äº†ï¼Œæ‰€ä»¥å…©å€‹ open-file table éƒ½ ready äº†</li></ul><ol type="1"><li>å» per-process ç¢ºèªæœ‰æ²’æœ‰æ¬Šé™ï¼ˆlogical file systemï¼‰</li><li>å¦‚æœæœ‰ï¼Œå» system-wide æ‰¾ file control block è£¡é¢å­˜çš„ data block çš„pointer</li></ol><p><strong>File-Create</strong></p><ol type="1"><li>OS allocates a new FCB</li><li>Update directory structure<ol type="1"><li>OS read in the corresponding directory structure into memory</li><li><strong>Updates the dir structure</strong> with the new file nameand the FCB</li><li>(After file being closed), OS writes back the directory structureback to disk â†’ Close æ‰æœƒå¯«å›å»ï¼Œå› ç‚º disk å¤ªæ…¢äº†</li></ol></li><li>The file appears in userâ€™s dir command</li></ol><h2 id="virtual-file-system">Virtual File System</h2><ul><li>Four main object types defined by Linux VFS Disk Allocation Methods<ul><li>inode (FCB) â†’ an individual <strong>file</strong></li><li>file object â†’ an <strong>open file</strong> (per process)</li><li>superblock object â†’ an entire file system</li><li>entry object â†’ an individual directory entry</li></ul></li></ul><h2 id="directory-implementation"><strong>DirectoryImplementation</strong></h2><p>å¤§å‹ç³»çµ±çš„ directory å¤ªå¤§äº†ï¼Œä¸”æ‰äº†å¾ˆæ…˜</p><ul><li>Linear lists<ul><li>use link list and traverse</li><li>easy to program but poor performance</li></ul></li><li>Hash table<ul><li>æŠŠ file path ç•¶æˆ keyï¼ŒFCB æ˜¯ value</li><li>constant time for searching</li><li>linked list for collisions on a hash entry</li><li>hash table usually has fixed # of entries</li></ul></li></ul><h2 id="review-slides-i">Review Slides (I)</h2><ul><li>Transfer unit between memory and disk?</li><li>App â†’ LFS â†’ FOM â†’ BFS â†’ I/O Control â†’ Devices</li><li>on-disk structure<ul><li>Boot control block, Partition control block</li><li>File control block, Directory structure</li></ul></li><li>In-memory<ul><li>Partition table, Directory structure</li><li>System-wide open-file table</li><li>Per-process open-file table</li></ul></li><li>Steps to open file, read/write file and create file?</li><li>Purpose of VFS?</li></ul><h1 id="allocation-methods">Allocation Methods</h1><p>æŠŠ file å°æ‡‰åˆ° blockã€‚</p><h2 id="contiguous-allocation">Contiguous Allocation</h2><figure><img src="/assets/%5BOS%5DChapter-11/Untitled%206.png"alt="å³é‚Šçš„è¡¨ï¼Œæ¯ä¸€è¡Œå°±æ˜¯ä¸€å€‹ inodeï¼Œstart å’Œ length æ˜¯ metadata" /><figcaption aria-hidden="true">å³é‚Šçš„è¡¨ï¼Œæ¯ä¸€è¡Œå°±æ˜¯ä¸€å€‹ inodeï¼Œstart å’Œlength æ˜¯ metadata</figcaption></figure><ul><li>ä¸€å€‹ block ä¸€å®šåªå±¬æ–¼ä¸€å€‹ file</li><li>Sequential access å’Œ random access éƒ½å¾ˆæœ‰æ•ˆç‡ï¼ˆæ ¹æ“š I/Oçš„æ¬¡æ•¸ä½œåˆ¤æ–·ï¼‰â†’ random æ˜¯å› ç‚ºå¯ä»¥ç”¨ç®—çš„é£›éå»</li><li>â˜¹ï¸Â Problems<ul><li>External fragmentation â†’ compactionï¼ˆç¡¬ç¢Ÿæ¸…ç†ï¼‰</li><li>File cannot growï¼ˆæœƒè¢«å¾Œé¢å¡ä½ï¼‰â†’ æ¬ç§»è³‡æ–™ï¼ˆbig costï¼‰</li></ul></li></ul><h2 id="extent-based-file-system-ext">Extent-Based File System(Ext)</h2><ul><li>ç”¨ link list çš„æ–¹æ³•æŠŠ extent ä¸²èµ·ä¾†</li><li>æ‰€ä»¥é™¤äº†å­˜ start å’Œ lengthï¼Œé‚„è¦å¤šå­˜ pointer to next extent</li><li>â˜¹ï¸Â Problems<ul><li>Random access become more costly</li><li>â€œInternal fragmentationâ€ â†’ extent çµ¦ä»–çš„ blocks æ²’ç”¨å®Œ</li></ul></li></ul><h2 id="linked-allocation">Linked Allocation</h2><p><img src="/assets/%5BOS%5DChapter-11/Untitled%207.png" /></p><ul><li>æŠŠä¸‹ä¸€å€‹ block çš„ pointer å­˜åœ¨ data block è£¡é¢ï¼Œdir åªæœƒæœ‰ç¬¬ä¸€å€‹pointer</li><li>Only good for <strong>sequential-access</strong> files, randomaccess need to traverse through the link list</li><li>Each access to a link list is a disk I/O (because link pointer isstored inside the data block)</li><li>æ¯ä¸€å€‹ data block éƒ½æœƒæµªè²» 4 byte å»å­˜ pointer</li><li>Reliability â†’ æ–·äº†å°± GG</li></ul><h2 id="fat-file-allocation-table-file-system">FAT (File AllocationTable) file system</h2><p><img src="/assets/%5BOS%5DChapter-11/Untitled%208.png" /></p><ul><li>æŠŠæ•´å€‹ pointers å­˜èµ·ä¾†ï¼Œæ‰€ä»¥å°±è®Šæˆä¸€å€‹ç´” link listï¼Œå­˜å–é‚„æ˜¯éœ€è¦traverseï¼Œä½†æ˜¯ä¸ç”¨ I/Oï¼Œåªæœƒæœ‰å¾ˆå¿«çš„ memory access</li><li>è¶…å¿«ï¼Œä½†æ˜¯éœ€è¦ç©ºé–“</li><li>Link æ–·äº†ä¹Ÿ GG</li></ul><h2 id="indexed-allocation">Indexed Allocation</h2><p><img src="/assets/%5BOS%5DChapter-11/Untitled%209.png" /></p><ul><li>è·Ÿå‰›å‰›å¾ˆåƒï¼Œä½†æ˜¯ä»–æ˜¯ç”¨ indexï¼Œä¸ç”¨ traverse</li><li>å¾ˆå¿«ï¼Œrandom ä¹Ÿè¶…å¿«</li><li>æ³¨æ„é‚£å€‹ index ä¹Ÿæ˜¯å­˜åœ¨ disk ä¸Šäº†ï¼Œä»–ä¹Ÿæ˜¯ä¸€å€‹ block</li><li>æ‰€ä»¥ inode æœƒå­˜é‚£å€‹ index åœ¨çš„ block</li><li>â˜¹ï¸<ul><li>Index block å¾ˆæµªè²»ç©ºé–“ï¼Œå°çš„ block æ ¹æœ¬ç”¨ä¸å®Œ</li><li>Index block å¦‚æœä¸å¤ å¤§ï¼Ÿ<ul><li><p>Linked Indexed Scheme</p><p>â†’ search time æœƒè®Šé•·</p><p><img src="/assets/%5BOS%5DChapter-11/Untitled%2010.png" /></p></li><li><p>Multilevel Scheme (two-level)</p><p>â†’ å¤§ file é€™å€‹æ¯”è¼ƒå„ª</p><p>â†’ å° file å°±å¾ˆæµªè²»</p><p><img src="/assets/%5BOS%5DChapter-11/Untitled%2011.png" /></p></li></ul></li></ul></li></ul><h2 id="combined-scheme-unix-inode">Combined Scheme: Unix inode</h2><p>æ ¹æ“š file size æ±ºå®šç”¨å“ªå€‹</p><p><img src="/assets/%5BOS%5DChapter-11/Untitled%2012.png" /></p><h1 id="free-space-management">Free-Space Management</h1><ul><li>æ‰¾åˆ°å…¨éƒ¨çš„ free block</li><li>Free-space list: records all free disk blocks</li><li>Scheme<ul><li><p>Bit vector</p><p><img src="/assets/%5BOS%5DChapter-11/Untitled%2013.png" /></p><ul><li>ç”¨ä¸€ä¸² 1 å’Œ 0 å»ç´€éŒ„ä»–æ˜¯ä¸æ˜¯ free çš„</li><li>ğŸ™‚Â simplicity, efficient</li><li>â˜¹ï¸ å› ç‚ºæ˜¯ fix sizeï¼Œæœƒæµªè²» memory ç©ºé–“</li></ul></li><li><p>Linked list (same as linked allocation)</p><p><img src="/assets/%5BOS%5DChapter-11/Untitled%2014.png" /></p></li><li><p>Grouping (same as linked index allocation)</p></li><li><p>Counting (same as contiguous allocation)</p><p>â†’ keep the address of the first free block and # of contiguous freeblocks</p></li></ul></li></ul><h2 id="review-slides-ii">Review Slides (II)</h2><ul><li>Allocation:<ul><li>Contiguous file allocation? Extent-based file system?</li><li>Linked allocation?</li><li>Indexed allocation?<ul><li>Linked scheme</li><li>multilevel index allocation</li><li>Combine scheme</li></ul></li></ul></li><li>Free space:<ul><li>Bit vector, linked list, counting, grouping</li></ul></li></ul><h1 id="textbook-questions">Textbook Questions</h1><p><img src="/assets/%5BOS%5DChapter-11/Untitled%2015.png" /></p><p><img src="/assets/%5BOS%5DChapter-11/Untitled%2016.png" /></p><p><img src="/assets/%5BOS%5DChapter-11/Untitled%2017.png" /></p><div class="note warning"><p>æ­¤ç­†è¨˜ç‚ºæ¸…è¯å¤§å­¸å‘¨å¿—é æ•™æˆä½œæ¥­ç³»çµ±ä¹‹èª²å ‚ç­†è¨˜ï¼Œæ‰€æœ‰å…§å®¹åŠåœ–ç‰‡çš†å–ææ–¼èª²å ‚å…§å®¹ã€‚<br />å¦‚å…§å®¹æœ‰èª¤ï¼Œæ­¡è¿ä¾†ä¿¡ <ahref="mailto:mail@arui.dev">mail@arui.dev</a>ã€‚</p></div>]]></content:encoded>
      
      
      <category domain="https://blog.arui.dev/categories/Operating-System-Notes/">Operating System Notes</category>
      
      
      <category domain="https://blog.arui.dev/tags/Operating-System/">Operating System</category>
      
      <category domain="https://blog.arui.dev/tags/Notes/">Notes</category>
      
      
      <comments>https://blog.arui.dev/[OS]Chapter-11/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[OS] Chapter 10 â€” File System Interface</title>
      <link>https://blog.arui.dev/[OS]Chapter-10/</link>
      <guid>https://blog.arui.dev/[OS]Chapter-10/</guid>
      <pubDate>Mon, 31 Jan 2022 10:10:24 GMT</pubDate>
      
      <description>&lt;div class=&quot;note default&quot;&gt;&lt;p&gt;&lt;a
href=&quot;https://arui-tw.notion.site/Chapter-10-File-System-Interface-588a7531b9aa40058c8423706f01da16&quot;&gt;Notion
å¥½è®€ç‰ˆ&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;aside&gt;
&lt;p&gt;âœï¸ å¾ä½¿ç”¨è€…çš„è§’åº¦å»çœ‹&lt;/p&gt;
&lt;/aside&gt;
&lt;h1 id=&quot;file-concept&quot;&gt;File Concept&lt;/h1&gt;
&lt;p&gt;File ä¹Ÿæ˜¯æŠ½åƒçš„æ¦‚å¿µã€‚&lt;/p&gt;
&lt;aside&gt;
&lt;p&gt;ğŸ“– &lt;strong&gt;File (Data)&lt;/strong&gt;: a logical storage unit created by
OS&lt;/p&gt;
&lt;/aside&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Physical storage unit in disk&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/assets/%5BOS%5DChapter-10/Untitled.png&quot; /&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;File attributes (Metadata)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Identifier: non-human-readable name&lt;/li&gt;
&lt;li&gt;Name&lt;/li&gt;
&lt;li&gt;Type&lt;/li&gt;
&lt;li&gt;Location&lt;/li&gt;
&lt;li&gt;Size&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Protection&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Last-access time, Last-updated time&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;File operations&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Create&lt;/li&gt;
&lt;li&gt;Write&lt;/li&gt;
&lt;li&gt;Read&lt;/li&gt;
&lt;li&gt;Repositioning within a file (i.e. file seek)&lt;/li&gt;
&lt;li&gt;Delete&lt;/li&gt;
&lt;li&gt;Truncating â†’ åˆ‡æ‰å°¾å·´&lt;/li&gt;
&lt;li&gt;Appending â†’ è²¼åœ¨å°¾å·´</description>
      
      
      
      <content:encoded><![CDATA[<div class="note default"><p><ahref="https://arui-tw.notion.site/Chapter-10-File-System-Interface-588a7531b9aa40058c8423706f01da16">Notionå¥½è®€ç‰ˆ</a></p></div><aside><p>âœï¸ å¾ä½¿ç”¨è€…çš„è§’åº¦å»çœ‹</p></aside><h1 id="file-concept">File Concept</h1><p>File ä¹Ÿæ˜¯æŠ½åƒçš„æ¦‚å¿µã€‚</p><aside><p>ğŸ“– <strong>File (Data)</strong>: a logical storage unit created byOS</p></aside><ul><li><p>Physical storage unit in disk</p><p><img src="/assets/%5BOS%5DChapter-10/Untitled.png" /></p></li><li><p>File attributes (Metadata)</p><ul><li>Identifier: non-human-readable name</li><li>Name</li><li>Type</li><li>Location</li><li>Size</li><li><strong>Protection</strong></li><li>Last-access time, Last-updated time</li></ul></li><li><p>File operations</p><ul><li>Create</li><li>Write</li><li>Read</li><li>Repositioning within a file (i.e. file seek)</li><li>Delete</li><li>Truncating â†’ åˆ‡æ‰å°¾å·´</li><li>Appending â†’ è²¼åœ¨å°¾å·´ <span id="more"></span></li></ul></li><li><p>Open-File Tables</p><p>æ³¨æ„ä»–å­˜çš„æ˜¯ metadataï¼Œä¸æ˜¯ data</p><ul><li>Per-process table<ul><li><p>Tracking all files opened by this process</p></li><li><p>è·Ÿæ“ä½œé€™å€‹ file æœ‰é—œçš„è³‡è¨Šï¼ˆindependent çš„ï¼‰</p></li><li><p>File pointer â†’ process æ“ä½œé€™å€‹æª”æ¡ˆåˆ°çš„ä½ç½®</p></li><li><p>è£¡é¢é‚„æœ‰ä¸€å€‹ pointer æŒ‡åˆ° file çš„ System-wide table</p><p>â‡’ é€™æ¨£å°±å¯ä»¥é¿å…è³‡æ–™ä¸€è‡´æ€§çš„å•é¡Œï¼Œæ‰€ä»¥æ‰ä¸è¦ duplicate ä¸€ä»½åˆ°Per-process table è£¡é¢</p></li></ul></li><li>System-wide table ****<ul><li>ä¸ç®¡èª°æ“ä½œéƒ½è¦çœ‹åˆ°çš„è³‡è¨Šï¼ˆshare çš„ï¼‰</li><li>File size, disk location</li></ul></li></ul><p><img src="/assets/%5BOS%5DChapter-10/Untitled%201.png" /></p></li><li><p>Open File Attributes</p><ul><li>File pointer (per-process)</li><li>File open count (system table)</li><li>Disk location (system table)</li><li>Access rights (per-process)</li></ul></li><li><p>File types</p><ul><li><p>.exe, .com, .obj, .cc, .mov, etc</p><p><img src="/assets/%5BOS%5DChapter-10/Untitled%202.png" /></p></li><li><p>Hint for OS to operate file in a reasonable way</p></li></ul></li></ul><h1 id="access-methods">Access Methods</h1><p>æ˜¯ä»¥ä½¿ç”¨è€…çš„è§’åº¦ä¾†çœ‹ï¼š</p><ul><li><p>Sequential access</p><ul><li>é€£çºŒçš„å­˜å–</li><li><code>fread</code>, <code>fwrite</code></li></ul><p><img src="/assets/%5BOS%5DChapter-10/Untitled%203.png" /></p></li><li><p>Direct (relative) access a.k.a random access</p><ul><li>Call API éœ€è¦çµ¦ä»–ä½å€</li><li>åƒæ˜¯ä½¿ç”¨ table</li><li>ä½¿ç”¨è€…è¦è‡ªå·±ç¶­è­·ä½å€ï¼ˆWith great power comes greatresponsibilityï¼‰</li></ul></li></ul><p><img src="/assets/%5BOS%5DChapter-10/Untitled%204.png" /></p><ul><li>Index Access Methods<ul><li><p>DB</p></li><li><p>ç”¨ index å»å­˜å–è³‡æ–™</p><p><img src="/assets/%5BOS%5DChapter-10/Untitled%205.png" /></p></li><li><p>Index: contains pointers to blocks of a file</p></li><li><p>With a large file â†’ index could become too large</p></li><li><p>To find a record in a file:</p><ul><li>search the index file â†’ find the pointer</li><li>use the pointer to directly access the record</li></ul></li></ul></li></ul><h2 id="review-slides-i">Review Slides (I)</h2><ul><li>File vs. Sector, Track</li><li>Open-file (in-memory) attributes<ul><li>Per-process, system-wide?</li></ul></li><li>File-access methods?<ul><li>Sequential access</li><li>Direct access</li><li>Index access</li></ul></li></ul><h1 id="directory-structure">Directory Structure</h1><h2 id="directory-basics">Directory Basics</h2><ul><li><p>Partition (Raw partition) â€” å„²å­˜çš„ç©ºé–“åˆ‡å‰²å¾Œè®Šæˆå–®ç¨çš„ partitionä½œæ˜¯ä½¿ç”¨å’Œç®¡ç†ï¼Œä½†æ˜¯é€™å€‹å€å¡Šæˆ‘å€‘<strong>é‚„æ²’ä½œæ ¼å¼åŒ–çš„å‹•ä½œ</strong></p></li><li><p>Volume â€” æˆ‘å€‘æœ‰æŠŠä»–ä½œ formattedï¼ˆFile system çš„æ ¼å¼åŒ–ï¼‰çš„å‹•ä½œäº†ï¼ˆFile system çš„å°ˆæœ‰åè©ï¼‰â†’ å¼·èª¿é€™æ˜¯ç”± <strong>filesystem</strong> ç®¡ç†ä½¿ç”¨çš„ç©ºé–“</p></li><li><p>Directories â€” used by file system to store the information aboutthe files in the partition</p></li><li><p>File-System Organization</p><figure><img src="/assets/%5BOS%5DChapter-10/Untitled%206.png"alt="Volume å’Œ Partition æ˜¯å¯ä»¥è·¨ disk çš„" /><figcaption aria-hidden="true">Volume å’Œ Partition æ˜¯å¯ä»¥è·¨ diskçš„</figcaption></figure></li><li><p>File name æœ¬èº«ä¹Ÿæ˜¯ directory çš„ä¸€éƒ¨åˆ†</p><ul><li>å› ç‚ºè¦æ‰¾åˆ° fileï¼Œå°±è¦æœ‰ file name</li><li>æ‰€ä»¥ Directory çš„æœ€å¾Œä¸€å±¤æ˜¯ file name</li></ul><figure><img src="/assets/%5BOS%5DChapter-10/Untitled%207.png"alt="åœˆåœˆæ˜¯ directory çš„æœ€å¾Œä¸€å±¤ï¼Œæ–¹æ¡†æ˜¯ file content" /><figcaption aria-hidden="true">åœˆåœˆæ˜¯ directory çš„æœ€å¾Œä¸€å±¤ï¼Œæ–¹æ¡†æ˜¯ filecontent</figcaption></figure></li><li><p>Directory Operations</p><ul><li>Search for a file</li><li>Create a file</li><li>Delete a file</li><li>List a directory</li><li>Rename a file</li><li>Traverse the file system</li></ul></li></ul><h2 id="directory-structure-1">Directory structure</h2><h3 id="single-level-directory">Single-Level Directory</h3><ul><li>æŒ‡çš„æ˜¯æ²’æœ‰è³‡æ–™å¤¾ï¼Œå®Œå…¨åªæœ‰æª”æ¡ˆ</li><li>Single æŒ‡çš„æ˜¯ file name</li><li>File name å¾ˆå®¹æ˜“æ‰“æ¶ï¼Œå› ç‚ºä¸èƒ½é‡è¤‡</li><li>å› ç‚ºæ˜¯ flat çš„ï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½è¦ scan throughï¼Œæ•ˆèƒ½å·®</li></ul><p><img src="/assets/%5BOS%5DChapter-10/Untitled%208.png" /></p><h3 id="two-level-directory">Two-Level Directory</h3><ul><li>å‡ºç¾äº†è³‡æ–™å¤¾</li><li>ä¸€å€‹ user ä¸€å€‹è³‡æ–™å¤¾ï¼Œæ‰€ä»¥é‚„æ˜¯æœ‰ä¸Šé¢çš„å•é¡Œ</li></ul><p><img src="/assets/%5BOS%5DChapter-10/Untitled%209.png" /></p><h3 id="tree-structured-directory">Tree-Structured Directory</h3><ul><li>Multi-Level</li><li>æœ‰ absolute path å’Œ relative path</li></ul><p><img src="/assets/%5BOS%5DChapter-10/Untitled%2010.png" /></p><h3 id="acyclic-graph-directory">Acyclic-Graph Directory</h3><ul><li>å¯ä»¥å»ºç«‹æ·å¾‘åˆ°åŒä¸€å€‹ file</li><li>When does a file actually get deleted?<ol type="1"><li>deleting the link but not the file</li><li>deleting the file but leaves the link â†’ dangling pointer</li></ol>ğŸ˜ƒÂ deleting the file when <strong>reference counters</strong> is 0</li></ul><p><img src="/assets/%5BOS%5DChapter-10/Untitled%2011.png" /></p><h3 id="general-graph-directory">General-Graph Directory</h3><ul><li><p>å¯ä»¥éš¨ä¾¿äº‚æŒ‡ï¼Œç”šè‡³å¯ä»¥æœ‰ cycle</p></li><li><p>æœ‰å¯èƒ½æœƒæ˜æ˜ access ä¸åˆ°äº†ï¼Œä½†æ˜¯å› ç‚ºæœ‰ linkåœ¨ï¼Œæ‰€ä»¥ä¹Ÿæ²’åˆªæ‰æª”æ¡ˆ</p><p><img src="/assets/%5BOS%5DChapter-10/Untitled%2012.png" /></p><ul><li><p>Garbage collection</p><p>â†’ å¾ root é–‹å§‹ traverseï¼Œmark æ¯ä¸€å€‹äººï¼Œæ²’ mark åˆ°çš„å°±åˆªæ‰</p><p>â˜¹ï¸Â Poor performance</p></li><li><p>Use cycle-detection algorithm when a link is created</p></li></ul></li></ul><p><img src="/assets/%5BOS%5DChapter-10/Untitled%2013.png" /></p><h2 id="review-slides-ii">Review Slides (II)</h2><ul><li>Directory structure: pros &amp; cons<ul><li>One-level directory</li><li>Two-level directory</li><li>Tree-structured directory</li><li>Acyclic-graph directory</li><li>General-graph directory</li></ul></li></ul><h1 id="file-system-mounting-file-sharing">File System Mounting &amp;File Sharing</h1><h2 id="mounting">Mounting</h2><ul><li><p>A file system must be mounted before it can be accessed</p></li><li><p>Mount point â€” æ¥åˆ°çš„ä½å€ï¼ˆthe root path that a FS will be mountedtoï¼‰ï¼Œç³»çµ±æ§½å°±æ˜¯ mount åœ¨ <code>/</code></p></li><li><p>Mount timing: three possibility</p><ol type="1"><li>boot time ï¼ˆç³»çµ±æ§½ï¼‰</li><li>automatically at run-timeï¼ˆUSBï¼‰</li><li>manually at run-time</li></ol></li><li><p>File System Mounting Example</p><p><img src="/assets/%5BOS%5DChapter-10/Untitled%2014.png" /></p><ul><li>Partition B çš„ mount point æ˜¯åœ¨ <code>/usr</code></li><li>Partition C çš„ mount point æ˜¯åœ¨ <code>/home</code></li></ul></li><li><p><code>mount â€“t ext2 /dev/sda0 /mnt/hdd</code></p><ul><li>mount ä¸€å€‹ file type æ˜¯ <code>ext2</code> çš„ï¼ˆæ‰€ä»¥çŸ¥é“é€™æ˜¯å•¥FSï¼Œæ‰èƒ½æ­£ç¢ºè®€å–ï¼‰ï¼Œä»–ç¾åœ¨æ˜¯ <code>/dev/sda0</code> ï¼ˆæ˜¯è¢« I/O deviceattach æˆä¸€å€‹æª”æ¡ˆçš„ï¼Œmount ä¹‹å¾Œæ‰å¯ä»¥è®€å–ï¼‰è¦ mount åˆ°<code>/mnt/hdd</code></li></ul></li><li><p>How to extend the tree</p><ul><li><p>Tree é•·é€™æ¨£</p><p><img src="/assets/%5BOS%5DChapter-10/Untitled%2015.png" /></p></li><li><p>å‰é¢çš„ <code>m</code> ä»£è¡¨é‚£ä¸æ˜¯æˆ‘ç®¡çš„ï¼Œæ˜¯ mounté€²ä¾†çš„ï¼Œæ‰€ä»¥è¦å»æŸ¥ä¸‹é¢çš„ mount table</p><p><img src="/assets/%5BOS%5DChapter-10/Untitled%2016.png" /></p></li><li><p>mount å°±æœƒä¿®æ”¹é€™è£¡é¢çš„å…§å®¹</p><p><img src="/assets/%5BOS%5DChapter-10/Untitled%2017.png" /></p></li></ul></li></ul><h2 id="sharing">Sharing</h2><ul><li><p>åŸºæœ¬ä¸Šéƒ½æ˜¯ multi-userï¼Œæ‰€ä»¥è¦ sharingï¼Œä½†æ˜¯è¦è™•ç†permission</p></li><li><p>å°æ–¼æ¯ä¸€å€‹ processï¼Œéœ€è¦å»ç®¡ç†ä»–çš„</p><ul><li>Identityï¼šèª° call çš„ï¼ˆLogin å°±çŸ¥é“äº†ï¼‰ï¼ˆä¹Ÿæœ‰ gropingå»å¹«åŠ©ç®¡ç†ï¼‰</li><li>Permissionï¼šçŸ¥é“æ˜¯èª°å¾Œè¦çŸ¥é“ä»–å¯ä»¥å‹•èª°</li></ul></li><li><p>Each user â€” UserID, GroupID</p></li><li><p>Each file has 3 sets of attributes â€” owner (one and only), group(can operate), others</p><p><img src="/assets/%5BOS%5DChapter-10/Untitled%2018.png" /></p></li><li><p>Access-Control</p><p>Create an access-control list (ACL) for each user</p><ul><li>æ¯æ¬¡ request å°±å»æŸ¥ä»–çš„æ¬Šé™</li></ul><p>â˜¹ï¸Â  æœƒå¤ªå¤§ï¼Œæ¯æ–°å¢ä¸€å€‹ user or file ACL will be huger</p><ul><li>3 classes of users â†’ 3 ACL (<strong>RWX</strong>) for each file<ul><li>Owner â€” (e.g. 7 = RWX = 111)</li><li>group â€” (e.g. 6 = RWX = 110)</li><li>other (public) â€” (e.g. 4 = RWX = 100)</li></ul><figure><img src="/assets/%5BOS%5DChapter-10/Untitled%2019.png"alt="chmod 664 intro.ps (ç¬¬ä¸€å€‹ bit ä»£è¡¨ä»– 484 dir)" /><figcaption aria-hidden="true">chmod 664 <ahref="http://intro.ps">intro.ps</a> (ç¬¬ä¸€å€‹ bit ä»£è¡¨ä»– 484dir)</figcaption></figure></li></ul></li></ul><h1 id="protection">Protection</h1><ul><li>Access control protection</li><li>Data failure protection<ul><li>ç”¨åŠ å¯†çš„æ–¹å¼ä¿è­·ä»–ä¸æœƒéºå¤±</li></ul></li></ul><h2 id="review-slides-iii">Review Slides (III)</h2><ul><li>File system mounting point, timing?</li><li>Access-control list? How does it function?</li></ul><h1 id="textbook-problem-set">Textbook Problem Set</h1><p><img src="/assets/%5BOS%5DChapter-10/Untitled%2020.png" /></p><div class="note warning"><p>æ­¤ç­†è¨˜ç‚ºæ¸…è¯å¤§å­¸å‘¨å¿—é æ•™æˆä½œæ¥­ç³»çµ±ä¹‹èª²å ‚ç­†è¨˜ï¼Œæ‰€æœ‰å…§å®¹åŠåœ–ç‰‡çš†å–ææ–¼èª²å ‚å…§å®¹ã€‚<br />å¦‚å…§å®¹æœ‰èª¤ï¼Œæ­¡è¿ä¾†ä¿¡ <ahref="mailto:mail@arui.dev">mail@arui.dev</a>ã€‚</p></div>]]></content:encoded>
      
      
      <category domain="https://blog.arui.dev/categories/Operating-System-Notes/">Operating System Notes</category>
      
      
      <category domain="https://blog.arui.dev/tags/Operating-System/">Operating System</category>
      
      <category domain="https://blog.arui.dev/tags/Notes/">Notes</category>
      
      
      <comments>https://blog.arui.dev/[OS]Chapter-10/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[OS] Chapter 7 â€” Deadlocks</title>
      <link>https://blog.arui.dev/[OS]Chapter-7/</link>
      <guid>https://blog.arui.dev/[OS]Chapter-7/</guid>
      <pubDate>Mon, 31 Jan 2022 10:07:24 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;deadlock-characterization&quot;&gt;Deadlock Characterization&lt;/h1&gt;
&lt;div class=&quot;note default&quot;&gt;&lt;p&gt;&lt;a
href=&quot;https://www.notion.so/arui-tw/Chapter-7-Deadlocks-b345b44b6ac14b28a37bdc7bb497edb9&quot;&gt;Notion
å¥½è®€ç‰ˆ&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;aside&gt;
&lt;p&gt;ğŸ“– ç¨‹å¼ä¹‹é–“å½¼æ­¤ç­‰å¾…ï¼Œç„¡æ³•é€²è¡Œäº†&lt;/p&gt;
&lt;/aside&gt;
&lt;ul&gt;
&lt;li&gt;Example
&lt;ul&gt;
&lt;li&gt;2 processes and 2 tape drivers
&lt;ul&gt;
&lt;li&gt;ä¸€äººå„æ‹¿ä¸€å€‹ï¼Œç„¶å¾Œç­‰å°æ–¹æ‰‹ä¸Šé‚£å€‹&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;2 processes, and semaphores A &amp;amp; B
&lt;ul&gt;
&lt;li&gt;P1 (hold B, wait A): wait(A), signal(B)&lt;/li&gt;
&lt;li&gt;P2 (hold A, wait B): wait(B) , signal(A)&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Necessary Condition&lt;/strong&gt; â†’
ä¸€å®šè¦&lt;strong&gt;å…¨éƒ¨&lt;/strong&gt;çš„æ¢ä»¶&lt;strong&gt;åŒæ™‚&lt;/strong&gt;ç™¼ç”Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Mutual exclusion â€” è³‡æºæ˜¯æ²’æœ‰å…±äº«æ€§çš„ï¼ˆæš«æ™‚ï¼‰&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Hold and Wait â€” æœƒ hold resource ç„¶å¾Œ wait åˆ¥äºº&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;No preemptive â€” ä¸èƒ½å¼·åˆ¶åˆ¥äººæ”¾é–‹ resource&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Circular wait â€” ä¸€å®šæœƒæœ‰ä¸€å€‹ circular çš„ waitã€‚&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math inline&quot;&gt;&#92;(P_0 &#92;rightarrow P_1 &#92;rightarrow P_1
&#92;rightarrow &#92;dots&#92;rightarrow P_n &#92;rightarrow P_0&#92;)&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;/assets/%5BOS%5DChapter-7/Untitled.png&quot; /&gt;&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="deadlock-characterization">Deadlock Characterization</h1><div class="note default"><p><ahref="https://www.notion.so/arui-tw/Chapter-7-Deadlocks-b345b44b6ac14b28a37bdc7bb497edb9">Notionå¥½è®€ç‰ˆ</a></p></div><aside><p>ğŸ“– ç¨‹å¼ä¹‹é–“å½¼æ­¤ç­‰å¾…ï¼Œç„¡æ³•é€²è¡Œäº†</p></aside><ul><li>Example<ul><li>2 processes and 2 tape drivers<ul><li>ä¸€äººå„æ‹¿ä¸€å€‹ï¼Œç„¶å¾Œç­‰å°æ–¹æ‰‹ä¸Šé‚£å€‹</li></ul></li><li>2 processes, and semaphores A &amp; B<ul><li>P1 (hold B, wait A): wait(A), signal(B)</li><li>P2 (hold A, wait B): wait(B) , signal(A)</li></ul></li></ul></li></ul><p><strong>Necessary Condition</strong> â†’ä¸€å®šè¦<strong>å…¨éƒ¨</strong>çš„æ¢ä»¶<strong>åŒæ™‚</strong>ç™¼ç”Ÿ</p><ul><li><p>Mutual exclusion â€” è³‡æºæ˜¯æ²’æœ‰å…±äº«æ€§çš„ï¼ˆæš«æ™‚ï¼‰</p></li><li><p>Hold and Wait â€” æœƒ hold resource ç„¶å¾Œ wait åˆ¥äºº</p></li><li><p>No preemptive â€” ä¸èƒ½å¼·åˆ¶åˆ¥äººæ”¾é–‹ resource</p></li><li><p>Circular wait â€” ä¸€å®šæœƒæœ‰ä¸€å€‹ circular çš„ waitã€‚</p><p><span class="math inline">\(P_0 \rightarrow P_1 \rightarrow P_1\rightarrow \dots\rightarrow P_n \rightarrow P_0\)</span></p></li></ul><p><img src="/assets/%5BOS%5DChapter-7/Untitled.png" /></p><span id="more"></span><h1 id="system-model">System Model</h1><ul><li><p>è¦æœ‰æŸäº›è³‡æº <span class="math inline">\(R_1, R_2, \dots,R_m\)</span></p><ul><li>E.g. CPU, memory pages, I/O devices</li></ul></li><li><p>æ¯å€‹è³‡æº <span class="math inline">\(R_i\)</span>å¯èƒ½æœƒæœ‰è¤‡æ•¸çš„å…± <span class="math inline">\(W_i\)</span> å€‹instances</p><ul><li>E.g. a computer has 2 CPUs</li></ul></li><li><p>æ¯ä¸€å€‹ process å–å¾— resource çš„æ–¹å¼ï¼š</p><p>Request â†’ use â†’ release</p></li></ul><h2 id="resource-allocation-graph">Resource-Allocation Graph</h2><figure><img src="/assets/%5BOS%5DChapter-7/Untitled%201.png"alt="åœ“å½¢è·Ÿæ­£æ–¹å½¢ä¸èƒ½æ”¹" /><figcaption aria-hidden="true">åœ“å½¢è·Ÿæ­£æ–¹å½¢ä¸èƒ½æ”¹</figcaption></figure><ul><li>3 processes, P1 <em>~ P3</em></li><li>4 resources, R1 <em>~ R4</em><ul><li>R1 and R3 each has one instance</li><li>R2 has two instances</li><li>R4 has three instances</li></ul></li><li>Request edges:<ul><li>P1 â†’ R1: P1 requests R1 ï¼ˆä¸€ç›´å­˜åœ¨å› ç‚º resource æ­£åœ¨è¢«ç”¨ï¼‰</li></ul></li><li>Assignment edges:<ul><li>R2 â†’ P1: é‚£å€‹ instance æ­£åœ¨è¢« P2 ä½¿ç”¨</li></ul></li></ul><p>â‡’ P1 is hold on an instance of R2 and waiting for an instance ofR1</p><ul><li>If the graph contains a cycle, a deadlock may exist<ul><li><p>å¦‚æœæœ‰ multiple instancesï¼Œé‚£å°±è¦æª¢æŸ¥æ¯ä¸€æ¢è·¯ç·šéƒ½æ˜¯ cycleæ‰è¡Œ</p></li><li><p>Example 1</p><p><img src="/assets/%5BOS%5DChapter-7/Untitled%202.png" /></p><ol type="1"><li>P1 is waiting for P2</li><li>P2 is waiting for P3 â†’ P1 is waiting for P3</li><li>P3 is waiting for P1 or P2, and they both waiting for P3</li></ol><p>â‡’ deadlock!</p></li><li><p>Example 2</p><p><img src="/assets/%5BOS%5DChapter-7/Untitled%203.png" /></p><ol type="1"><li>P1 is waiting for P2 or P3</li><li>P3 is waiting for P1 or P4</li><li>Since P2 and P4 wait no one</li></ol><p>â‡’ no deadlock</p></li></ul></li></ul><h3 id="deadlock-detection">Deadlock Detection</h3><ul><li>æ²’ cycle â†’ æ²’ deadlock</li><li>æœ‰ cycle<ul><li>one instance per resource type â†’ æœ‰ deadlock</li><li>multiple instances per resource type â†’ å¯èƒ½æœ‰ deadlock</li></ul></li></ul><h3 id="handling-deadlocks">Handling Deadlocks</h3><ul><li>ç¢ºä¿ä¸æœƒé€²å»<ul><li>deadlock prevention â€” ç¢ºä¿è‡³å°‘ä¸€å€‹å¿…è¦æ¢ä»¶ä¸æœƒç™¼ç”Ÿ</li><li>deadlock avoidance â€” åœ¨ runtime å»ä¸æ–·çš„æª¢æŸ¥</li></ul></li><li>è®“ä»–é€²å»å† recover<ul><li>deadlock detection</li><li>deadlock recovery</li></ul></li><li>å®Œå…¨ä¸è™•ç†ï¼ˆignore the problemï¼‰<ul><li>è®“ user å»ä¸­æ–·ä»–</li></ul></li></ul><h2 id="review-slides-i">Review Slides ( I )</h2><ul><li>deadlock necessary conditions?<ul><li>mutual exclusion</li><li>hold &amp; wait</li><li>no preemption</li><li>circular wait</li></ul></li><li>resource-allocation graph?<ul><li>cycle in RAG â†’ deadlock?</li></ul></li><li>deadlock handling types?<ul><li>deadlock prevention</li><li>deadlock avoidance</li><li>deadlock recovery</li><li>ignore the problem</li></ul></li></ul><h1 id="deadlock-prevention-deadlock-avoidance">Deadlock Prevention&amp; Deadlock Avoidance</h1><h2 id="deadlock-prevention">Deadlock Prevention</h2><ul><li>æ¯ä¸€ç¨® resource å„æ‹¿æ‰ä¸€ç¨®æ¢ä»¶ã€‚ï¼ˆæ¯ä¸€å€‹å¯ä»¥ä¸ä¸€æ¨£ï¼‰<ul><li><p>Mutual exclusion (ME): do not require ME on sharableresources</p><ul><li>E.g. set file to read only â†’ no mutual exclusion (can many read insame time)</li><li>ä½†ä¸æ˜¯æ‰€æœ‰éƒ½å¯ä»¥é€™æ¨£è§£</li><li>ï¼ˆMemory æ˜¯ support concurrent access çš„ï¼Œæ˜¯ programer çš„è¡Œç‚ºè®“ä»–æœ‰ME çš„æ¢ä»¶å‡ºä¾†çš„ï¼‰</li></ul></li><li><p>Hold &amp; Wait</p><ul><li>è¦å®šä»–è¦ free æ‰æ‰‹ä¸Šçš„ resource æ‰èƒ½å»è¦å…¶ä»–resourceã€‚æˆ–æ˜¯ä¸€å°±è¦æŠŠå…¨éƒ¨çš„ resource è¦é½Šï¼ˆåªè¦è¦ç­‰å°±è¦æŠŠæ‹¿åˆ°çš„ freeæ‰ï¼Œå¯ä»¥ç­‰ï¼Œä½†æ˜¯æ‰‹ä¸Šä¸èƒ½æœ‰æ±è¥¿ï¼‰ã€‚</li><li>All or nothing allocation</li><li>å»æ”¹è®Š mutex_wait çš„å¯¦ä½œ</li></ul><p>â˜¹ï¸Â Resource ä½¿ç”¨ç‡é™ä½ï¼Œå¯èƒ½æœƒæœ‰ starvation</p></li><li><p>No preemption</p><ul><li>æ”¹æˆå¯ä»¥ä½œ preemptive</li><li>E.g. preemptive çš„ scheduler â†’ æœ‰ timer å»è®“ OS always controlCPU</li></ul><p>â˜¹ï¸Â Overheadï¼Œè¦å¤šä¸€å¡Š memory å»æš«å­˜è³‡æ–™</p><p>â†’ Printer çš„ä»£åƒ¹å°±å¤ªé«˜äº†ï¼ˆè¦é‡å°ï¼‰</p></li><li><p>Circular wait</p><ul><li><p>åœ¨ request resource çš„æ™‚å€™ï¼Œå¦‚æœä½ è¦ request <spanclass="math inline">\(R_k\)</span>ï¼Œé‚£å°±è¦ release <spanclass="math inline">\(R_i, \forall i \geq k\)</span>ã€‚ï¼ˆå°æ–¼ <spanclass="math inline">\(k\)</span> çš„å¯ä»¥ç¹¼çºŒ holdï¼‰</p><p>æ‰‹ä¸Šä¸èƒ½æ¡æ¯”è¼ƒå¤§çš„ã€‚</p></li><li><p>Example</p><ul><li>F(<em>tape drive</em>) = 1, F(<em>disk drive</em>) = 5,F(<em>printer</em>) = 12</li><li>å¦‚æœ hold diskï¼Œå¯ä»¥è¦ printer</li><li>å¦‚æœ hold printer å’Œ tapeï¼Œé‚£ request drive å°±è¦ releaseprinterï¼Œtape å¯ä»¥ç•™è‘—</li></ul></li><li><p>Proof</p><ul><li><p>è­‰æ˜æœ‰ deadlock ä½†æ˜¯ä¸å¯èƒ½æˆç«‹</p></li><li><p><span class="math inline">\(P_0(R_0) \rightarrowR_1\)</span>(<span class="math inline">\(P_0\)</span> hold <spanclass="math inline">\(R_0\)</span> and request <spanclass="math inline">\(R_1\)</span>)</p><p><span class="math inline">\(P_1(R_1) \rightarrow R_2, \dots, P_N(R_N)\rightarrow \red {R_0}\)</span></p></li><li><p>ä½†æ˜¯æœ€å¾Œä¸€å€‹ä¸å¯èƒ½æˆç«‹ï¼Œå› ç‚º <spanclass="math inline">\(N&gt;0\)</span></p></li></ul></li></ul></li></ul></li></ul><h2 id="avoidance-algorithms">Avoidance Algorithms</h2><ul><li><p>Single instance of a resource type</p><p>â†’ ç”¨ resource-allocation graph (RAG) algorithm ****ç›´æ¥åµæ¸¬circle</p></li><li><p>Multiple instances of a resource type</p><p>â†’ bankerâ€™s algorithm</p></li></ul><h3 id="resource-allocation-graph-rag-algorithm">Resource-AllocationGraph (RAG) Algorithm</h3><p><img src="/assets/%5BOS%5DChapter-7/Untitled%204.png" /></p><ul><li>Request edges:<ul><li><span class="math inline">\(P_i \rightarrow R_j\)</span>: <spanclass="math inline">\(P_i\)</span> waiting for <spanclass="math inline">\(R_j\)</span></li></ul></li><li>Assignment edges:<ul><li><span class="math inline">\(R_j â†’ P_i\)</span>: <spanclass="math inline">\(R_j\)</span> is allocated and held by <spanclass="math inline">\(P_i\)</span></li><li>Resource è¢« release å¯èƒ½è½‰å› claim edge</li></ul></li><li>Claim edge:<ul><li><span class="math inline">\(P_i \rightarrow R_j\)</span>: <spanclass="math inline">\(P_i\)</span> may request <spanclass="math inline">\(R_j\)</span> <strong>in the future</strong> (worstcase)</li><li>çœŸçš„ç™¼ç”Ÿå°±æœƒè®Šæˆ request edges</li></ul></li><li>Example<ul><li><p>é€™ä¸æœƒå‡ºäº‹</p><p><img src="/assets/%5BOS%5DChapter-7/Untitled%205.png" /></p></li><li><p>ç•¶ P2 request for R1 çš„æ™‚å€™ï¼Œä»–æœƒè¢«æ“‹æ‰ã€‚å› ç‚ºæˆ‘å€‘æœƒå‡è¨­ claimçš„æƒ…å½¢æœƒåœ¨æœªä¾† somehow ç™¼ç”Ÿã€‚</p><p><img src="/assets/%5BOS%5DChapter-7/Untitled%206.png" /></p></li></ul></li><li>Cycle-detection algorithm â‡’ <spanclass="math inline">\(O(n^2)\)</span></li></ul><h3 id="bankers-algorithm"><strong>Bankerâ€™s algorithm</strong></h3><p>å»è€ƒæ…® worse caseã€‚</p><p><img src="/assets/%5BOS%5DChapter-7/Untitled%207.png" /></p><ul><li>Safe state â†’ å¯ä»¥æ‰¾åˆ°ä¸€å€‹ safe sequenceè®“ç¨‹å¼ç…§è‘—è·‘ï¼ŒçµæŸå‰éƒ½ä¸æœƒé‡åˆ° deadlock</li><li>Unsafe state â†’ æœ‰æ©Ÿç‡æœƒ deadlock</li><li>Deadlock avoidance â†’ ä¸è¦é€²åˆ° unsafe</li></ul><p><strong>Safe Sequence</strong></p><ul><li><p>Assume æœ‰ 12 å€‹ tape drives</p></li><li><p>Safe state:</p><ul><li><p>At t0:</p><table><thead><tr class="header"><th></th><th>Max Needs</th><th>Current Holding</th></tr></thead><tbody><tr class="odd"><td>P0</td><td>10</td><td>5</td></tr><tr class="even"><td>P1</td><td>4</td><td>2</td></tr><tr class="odd"><td>P2</td><td>9</td><td>2</td></tr></tbody></table><ul><li>Max need is hinted from processes</li><li>Max need is worst case</li></ul><p>â†’ &lt;P1, P0, P2&gt; is a safe sequence</p><ol type="1"><li><p>çµ¦ P1 3 å€‹ï¼ˆæœ‰çš„éƒ½çµ¦ä»–ï¼‰</p><table><thead><tr class="header"><th></th><th>Max Needs</th><th>Current Holding</th><th>Available</th></tr></thead><tbody><tr class="odd"><td>P0</td><td>10</td><td>5</td><td></td></tr><tr class="even"><td>P1</td><td>4</td><td>2</td><td>3</td></tr><tr class="odd"><td>P2</td><td>9</td><td>2</td><td></td></tr></tbody></table></li><li><p>çµ¦ P0 5 å€‹</p><table><thead><tr class="header"><th></th><th>Max Needs</th><th>Current Holding</th><th>Available</th></tr></thead><tbody><tr class="odd"><td>P0</td><td>10</td><td>5</td><td>5</td></tr><tr class="even"><td>P1</td><td>4</td><td>0</td><td>0</td></tr><tr class="odd"><td>P2</td><td>9</td><td>2</td><td></td></tr></tbody></table></li><li><p>çµ¦ P2 10 å€‹</p><table><thead><tr class="header"><th></th><th>Max Needs</th><th>Current Holding</th><th>Available</th></tr></thead><tbody><tr class="odd"><td>P0</td><td>10</td><td>0</td><td></td></tr><tr class="even"><td>P1</td><td>4</td><td>0</td><td></td></tr><tr class="odd"><td>P2</td><td>9</td><td>2</td><td>10</td></tr></tbody></table></li></ol></li></ul></li><li><p>Unsafe state:</p><ul><li><p>At t1:</p><p>å‡è¨­é€™æ™‚å€™ OS æ‹¿åˆ°çš„ä¸€å€‹ request èªª P2 æƒ³è¦å¤šä¸€å€‹ tape driveã€‚</p><table><thead><tr class="header"><th></th><th>Max Needs</th><th>Current Holding</th><th>Available</th></tr></thead><tbody><tr class="odd"><td>P0</td><td>10</td><td>5</td><td></td></tr><tr class="even"><td>P1</td><td>4</td><td>2</td><td>3 â†’ 2</td></tr><tr class="odd"><td>P2</td><td>9</td><td>2 â†’ 3</td><td></td></tr></tbody></table><ul><li>è·‘ä¸€æ¬¡ä¸Šé¢çš„æµç¨‹ï¼Œç„¶å¾Œæˆ‘å€‘å°±æœƒç™¼ç¾ï¼Œå¦‚æœæˆ‘å€‘åŒæ„äº†ï¼ˆP2 çš„ currentholding è®Šæˆ 3 äº†ï¼‰ï¼Œæˆ‘å€‘å°±æœƒç™¼ç¾ä»–å¯èƒ½æœƒ deadlock ï¼ˆi.e. é€²åˆ° unsafestateï¼‰ã€‚</li><li>æ‰€ä»¥ OS å°±æœƒæ“‹æ‰é€™å€‹ requestã€‚</li></ul></li></ul></li><li><p>Banker algorithm:</p><ol type="1"><li><p>æ‹¿åˆ° requestï¼Œå…ˆå‡è¨­åŒæ„äº†</p></li><li><p>ç„¶å¾Œå»è·‘ safe sequence</p><p>é¸ sequence çš„é †åºéš¨ä¾¿éƒ½æ²’å·®ã€‚</p></li><li><p>å¦‚æœ safe sequence å­˜åœ¨ï¼Œæˆ‘å€‘å°± grant requestï¼Œåä¹‹å°±ä¸åŒæ„</p><p>å¦‚æœæœ‰æ•¸å€‹ï¼Œé‚£å°±éƒ½å¯ä»¥ï¼Œåæ­£è‡³å°‘ä¸€å€‹å°±å¥½äº†</p></li></ol></li><li><p>Bankerâ€™s Algorithm Example 1</p><p>æˆ‘æ‡¶å¾—è²¼.. P.27</p></li><li><p>Programming Example</p><p>A, B, C are semaphores initialized with the values of 2, 1, 1.</p><p>ç”¨ round-robin è·‘ã€‚</p><ul><li><p>åŸæœ¬</p><p><img src="/assets/%5BOS%5DChapter-7/Untitled%208.png" /></p></li><li><p>Use avoidance</p><p><img src="/assets/%5BOS%5DChapter-7/Untitled%209.png" /></p><ul><li>P4 çš„ wait(A) å¦‚æœæˆåŠŸäº†ï¼ŒåŠ ä¸Š claim edge å°±æœƒ dead lockï¼Œæ‰€ä»¥ OSä¸æœƒè®“ä»–æ‹¿</li><li>æ¥ä¸‹ä¾† P2 å°±æœƒæ¶åˆ° Aï¼Œç„¶å¾Œ eventually ä»–å°±æœƒ signal A andCï¼Œå‰©ä¸‹çš„å°±æœƒæˆåŠŸçµæŸäº†</li></ul></li></ul></li></ul><h2 id="review-slides-ii">Review Slides (II)</h2><ul><li>deadlock prevention methods?<ul><li>mutual exclusion</li><li>hold &amp; wait</li><li>no preemption</li><li>circular wait</li></ul></li><li>deadlock avoidance methods?<ul><li>safe state definition?</li><li>safe sequence?</li><li>claim edge?</li></ul></li></ul><h1 id="deadlock-detection-recovery-from-deadlock">Deadlock Detection&amp; Recovery from Deadlock</h1><ul><li><p>deadlock äº†å†è§£</p><p>ï¼ˆå°±ç®—å¡ä½äº†ï¼Œä¹Ÿåªæ˜¯ user programï¼ŒOS ä¸€å®šä¸æœƒå¡ä½çš„å•¦ï¼Œè¦ä¿¡ä»»OSï¼‰</p></li><li><p>æ‰€ä»¥å°±å°±ç•¶ä¸‹çš„æƒ…æ³å»è·‘ä¸Šé¢é‚£äº› check</p></li><li><p>Single instance</p><p><img src="/assets/%5BOS%5DChapter-7/Untitled%2010.png" /></p></li><li><p>Multiple-Instance â†’ Bankerâ€™s algorithm</p><ul><li>å¯ä»¥æŠŠ Max Needs æ‹¿æ‰ï¼Œæ²’ç”¨äº†</li><li>å»æª¢æŸ¥æœ‰æ²’æœ‰ safe sequence å­˜åœ¨ï¼Œæœ‰å°±ç•¶ä½œæ²’äº‹ã€‚æ²’æœ‰å°±ä»£è¡¨é€²å…¥deadlock äº†ã€‚</li></ul><p><img src="/assets/%5BOS%5DChapter-7/Untitled%2011.png" /></p></li><li><p>Deadlock Recovery</p><p>â†’ Process termination</p><ul><li>ä½†æ˜¯è¦ kill èª°ï¼Ÿï¼ˆå¯èƒ½å¯ä»¥ kill priority ä½çš„ï¼‰ï¼ˆä½†æ˜¯ä¸€ç›´ killpriority ä½çš„å¯èƒ½æœƒ starvation ï¼‰</li><li>Kill æ‰ä¹‹å¾Œé‚„å¯ä»¥ roll back å—ï¼Ÿ</li></ul></li></ul><h1 id="textbook-problem-set">Textbook Problem Set</h1><p><img src="/assets/%5BOS%5DChapter-7/Untitled%2012.png" /></p><p><img src="/assets/%5BOS%5DChapter-7/Untitled%2013.png" /></p><p><img src="/assets/%5BOS%5DChapter-7/Untitled%2014.png" /></p><p><img src="/assets/%5BOS%5DChapter-7/Untitled%2015.png" /></p><div class="note warning"><p>æ­¤ç­†è¨˜ç‚ºæ¸…è¯å¤§å­¸å‘¨å¿—é æ•™æˆä½œæ¥­ç³»çµ±ä¹‹èª²å ‚ç­†è¨˜ï¼Œæ‰€æœ‰å…§å®¹åŠåœ–ç‰‡çš†å–ææ–¼èª²å ‚å…§å®¹ã€‚<br />å¦‚å…§å®¹æœ‰èª¤ï¼Œæ­¡è¿ä¾†ä¿¡ <ahref="mailto:mail@arui.dev">mail@arui.dev</a>ã€‚</p></div>]]></content:encoded>
      
      
      <category domain="https://blog.arui.dev/categories/Operating-System-Notes/">Operating System Notes</category>
      
      
      <category domain="https://blog.arui.dev/tags/Operating-System/">Operating System</category>
      
      <category domain="https://blog.arui.dev/tags/Notes/">Notes</category>
      
      
      <comments>https://blog.arui.dev/[OS]Chapter-7/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[OS] Chapter 6 â€” Process Synchronization</title>
      <link>https://blog.arui.dev/[OS]Chapter-6/</link>
      <guid>https://blog.arui.dev/[OS]Chapter-6/</guid>
      <pubDate>Mon, 31 Jan 2022 10:06:24 GMT</pubDate>
      
      <description>&lt;div class=&quot;note default&quot;&gt;&lt;p&gt;&lt;a
href=&quot;https://arui-tw.notion.site/Chapter-6-Process-Synchronization-dc2fdd2951b047f78a39377759ebe90c&quot;&gt;Notion
å¥½è®€ç‰ˆ&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;h1 id=&quot;background&quot;&gt;Background&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;å› ç‚ºæœ‰ share çš„ dataï¼Œæœƒè¢«å¤šå€‹ content å»ç”¨ä»–ï¼Œæ‰€ä»¥éœ€è¦&lt;/li&gt;
&lt;li&gt;å°±ç®—åªæœ‰ä¸€å€‹ coreï¼Œä¹Ÿæœƒæœ‰ Concurrent çš„å•é¡Œï¼ˆå› ç‚ºæœƒæœ‰ content
switchï¼‰&lt;/li&gt;
&lt;li&gt;é‡é»å°±æ˜¯ä»–å€‘ execute çš„ order&lt;/li&gt;
&lt;li&gt;Consumer &amp;amp; Producer Problem
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;ç”¨ counter å»è¨˜é‚„æœ‰å¹¾å€‹ç©ºä½&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Producer&lt;/p&gt;
&lt;p&gt;&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	nextItem = &lt;span class=&quot;built_in&quot;&gt;getItem&lt;/span&gt;( );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (counter == BUFFER_SIZE);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	buffer[in] = nextItem;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	in = (in + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) % BUFFER_SIZE;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	counter++;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Consumer&lt;/p&gt;
&lt;p&gt;&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (counter == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) ;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	item = buffer[out];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	out = (out + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) % BUFFER_SIZE;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	counter--;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ä½†æ˜¯ counter æœƒæ˜¯é€™å…©éš» thread
å…±ç”¨çš„æ±æ±ï¼Œæ‰€ä»¥æœƒå‡ºç¾ä¸ä¸€è‡´çš„å•é¡Œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;counter++&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;move ax, counter&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;add  ax, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;move counter, ax&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;counter--&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;move bx, counter&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sub  bx, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;move counter, bx&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ä½†æ˜¯â€¦å¦‚æœæ˜¯é€™æ¨£å‘¢ï¼Ÿï¼ˆcounter initially is 5ï¼‰&lt;/p&gt;
&lt;p&gt;&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;producer: move ax, counter   &lt;span class=&quot;comment&quot;&gt;// ax = 5&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;producer: add ax, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;          &lt;span class=&quot;comment&quot;&gt;// ax = 6&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;context &lt;span class=&quot;keyword&quot;&gt;switch&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;consumer: move bx, counter   &lt;span class=&quot;comment&quot;&gt;// bx = 5&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;consumer: sub bx, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;          &lt;span class=&quot;comment&quot;&gt;// bx = 4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;context &lt;span class=&quot;keyword&quot;&gt;switch&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;producer: move counter, ax   &lt;span class=&quot;comment&quot;&gt;// counter = 6&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;context &lt;span class=&quot;keyword&quot;&gt;switch&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;consumer: move counter, bx   &lt;span class=&quot;comment&quot;&gt;// counter = 4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;ä¸éå¦‚æœä¸æ˜¯ preemptive å°±ä¸æœƒæœ‰é€™å€‹å•é¡Œäº†ã€‚&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;race-condition&quot;&gt;Race Condition&lt;/h2&gt;
&lt;aside&gt;
&lt;p&gt;ğŸ“– å¤šå€‹ process æ“ä½œ shared data
concurrentlyï¼Œçµæœæœƒå–æ±ºæ–¼æœ€å¾Œå®Œæˆçš„äººã€‚ï¼ˆé€™æ˜¯æè¿°ä¸€å€‹å•é¡Œé»ï¼Œæ‰€ä»¥æ˜¯å› ç‚ºæœ‰
race conditionï¼Œè¦ç”¨åŒæ­¥åŒ–è§£æ±ºï¼‰&lt;/p&gt;
&lt;/aside&gt;
&lt;ul&gt;
&lt;li&gt;Single processor çš„å¯ä»¥ç”¨ disable interrupt æˆ– non-preemptive CPU
ä¾†è§£æ±ºã€‚&lt;/li&gt;
&lt;/ul&gt;</description>
      
      
      
      <content:encoded><![CDATA[<div class="note default"><p><ahref="https://arui-tw.notion.site/Chapter-6-Process-Synchronization-dc2fdd2951b047f78a39377759ebe90c">Notionå¥½è®€ç‰ˆ</a></p></div><h1 id="background">Background</h1><ul><li>å› ç‚ºæœ‰ share çš„ dataï¼Œæœƒè¢«å¤šå€‹ content å»ç”¨ä»–ï¼Œæ‰€ä»¥éœ€è¦</li><li>å°±ç®—åªæœ‰ä¸€å€‹ coreï¼Œä¹Ÿæœƒæœ‰ Concurrent çš„å•é¡Œï¼ˆå› ç‚ºæœƒæœ‰ contentswitchï¼‰</li><li>é‡é»å°±æ˜¯ä»–å€‘ execute çš„ order</li><li>Consumer &amp; Producer Problem<ul><li><p>ç”¨ counter å»è¨˜é‚„æœ‰å¹¾å€‹ç©ºä½</p></li><li><p>Producer</p><p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">nextItem = <span class="built_in">getItem</span>( );</span><br><span class="line"><span class="keyword">while</span> (counter == BUFFER_SIZE);</span><br><span class="line">buffer[in] = nextItem;</span><br><span class="line">in = (in + <span class="number">1</span>) % BUFFER_SIZE;</span><br><span class="line">counter++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></li><li><p>Consumer</p><p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line"><span class="keyword">while</span> (counter == <span class="number">0</span>) ;</span><br><span class="line">item = buffer[out];</span><br><span class="line">out = (out + <span class="number">1</span>) % BUFFER_SIZE;</span><br><span class="line">counter--;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></li><li><p>ä½†æ˜¯ counter æœƒæ˜¯é€™å…©éš» threadå…±ç”¨çš„æ±æ±ï¼Œæ‰€ä»¥æœƒå‡ºç¾ä¸ä¸€è‡´çš„å•é¡Œï¼š</p><ul><li><p><code>counter++</code></p><p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">move ax, counter</span><br><span class="line">add  ax, <span class="number">1</span></span><br><span class="line">move counter, ax</span><br></pre></td></tr></table></figure></p></li><li><p><code>counter--</code></p><p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">move bx, counter</span><br><span class="line">sub  bx, <span class="number">1</span></span><br><span class="line">move counter, bx</span><br></pre></td></tr></table></figure></p></li><li><p>ä½†æ˜¯â€¦å¦‚æœæ˜¯é€™æ¨£å‘¢ï¼Ÿï¼ˆcounter initially is 5ï¼‰</p><p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">producer: move ax, counter   <span class="comment">// ax = 5</span></span><br><span class="line">producer: add ax, <span class="number">1</span>          <span class="comment">// ax = 6</span></span><br><span class="line">context <span class="keyword">switch</span></span><br><span class="line">consumer: move bx, counter   <span class="comment">// bx = 5</span></span><br><span class="line">consumer: sub bx, <span class="number">1</span>          <span class="comment">// bx = 4</span></span><br><span class="line">context <span class="keyword">switch</span></span><br><span class="line">producer: move counter, ax   <span class="comment">// counter = 6</span></span><br><span class="line">context <span class="keyword">switch</span></span><br><span class="line">consumer: move counter, bx   <span class="comment">// counter = 4</span></span><br></pre></td></tr></table></figure></p><p>ä¸éå¦‚æœä¸æ˜¯ preemptive å°±ä¸æœƒæœ‰é€™å€‹å•é¡Œäº†ã€‚</p></li></ul></li></ul></li></ul><h2 id="race-condition">Race Condition</h2><aside><p>ğŸ“– å¤šå€‹ process æ“ä½œ shared dataconcurrentlyï¼Œçµæœæœƒå–æ±ºæ–¼æœ€å¾Œå®Œæˆçš„äººã€‚ï¼ˆé€™æ˜¯æè¿°ä¸€å€‹å•é¡Œé»ï¼Œæ‰€ä»¥æ˜¯å› ç‚ºæœ‰race conditionï¼Œè¦ç”¨åŒæ­¥åŒ–è§£æ±ºï¼‰</p></aside><ul><li>Single processor çš„å¯ä»¥ç”¨ disable interrupt æˆ– non-preemptive CPUä¾†è§£æ±ºã€‚</li></ul><span id="more"></span><h1 id="critical-section">Critical Section</h1><ul><li><p><del>ä¸€å€‹ process ä¹‹é–“æºé€šçš„ protocol</del></p></li><li><p>Critical section: æœƒç”¢ç”Ÿ race condition çš„é‚£æ®µç¨‹å¼ç¢¼ã€‚</p></li><li><p>Mutually exclusive: æœƒæœ‰ç›¸åŒ critical section çš„processã€‚ä»–å€‘è¦åœ¨é‚£æ®µ critical section è¢«è¿«å» serializeã€‚</p><figure><img src="/assets/%5BOS%5DChapter-6/Untitled.png"alt="Remainder section: å‰©ä¸‹çš„" /><figcaption aria-hidden="true">Remainder section: å‰©ä¸‹çš„</figcaption></figure></li></ul><h2 id="critical-section-requirements">Critical SectionRequirements</h2><ol type="1"><li>Mutual Exclusion: if process P is executing in its CS, no otherprocesses can be executing in their CS</li><li>Progress: æœ‰ process æƒ³è¦é€²å»ç©ºçš„ criticalsectionï¼Œå°±æ‡‰è©²è¦è®“ä»–é¦¬ä¸Šé€²å»ã€‚ï¼ˆæœ‰æ•ˆæ€§ï¼‰</li><li>Bounded Waiting: ä¸èƒ½è®“ç­‰çš„äººä¸€ç›´ç­‰ï¼Œè¦ bound ä»–çš„ waitingtimeã€‚ï¼ˆå…¬å¹³æ€§ï¼‰</li></ol><ul><li>2 å’Œ 3 æ˜¯å¯æ¨å–çš„</li></ul><h2 id="review-slide">Review Slide</h2><ul><li>Race condition?</li><li>Critical-Section (CS) problem? 4 sections?<ul><li>entry, CS, exit, remainder</li></ul></li><li>3 requirements for solutions to CS problems?<ul><li>mutual exclusion</li><li>progress</li><li>bounded waiting</li></ul></li></ul><h1 id="software-solution">Software Solution</h1><ul><li><p>Assume only 2 processes, <span class="math inline">\(P_0\)</span>and <span class="math inline">\(P_1\)</span></p></li><li><p>ç”¨ <code>turn</code> æ±ºå®šè¼ªåˆ°èª°</p><p><img src="/assets/%5BOS%5DChapter-6/Untitled%201.png" /></p><ul><li>å› ç‚ºæ˜¯ç”¨ single instruction å» setï¼Œæ‰€ä»¥ä¸æœƒè¢«ä¸­æ–·è© å”±</li><li>Requirements<ol type="1"><li>Mutual Exclusion: Yes</li><li>Progress: <strong>Nope</strong>ï¼Œä¸ç¬¦åˆ Progress çš„æ¢ä»¶ï¼Œ å› ç‚º <spanclass="math inline">\(P_0\)</span> å¯èƒ½å·²ç¶“ç¹ä¸€åœˆæƒ³ä¸Šå»äº†ï¼Œä½†æ˜¯å› ç‚º<span class="math inline">\(P_1\)</span> é‚„æ²’é€²é CSï¼Œæ‰€ä»¥ä»–é€²ä¸å»</li><li>Bounded Waiting: Yesï¼Œå› ç‚ºæ˜¯ Round robin.</li></ol></li></ul></li></ul><h2 id="petersons-solution-for-two-processes">Petersonâ€™s Solution forTwo Processes</h2><ul><li><p>è·Ÿå‰›å‰›é‚£å€‹å¾ˆåƒï¼Œä½†æ˜¯å¤šäº†ä¸€å€‹ flagï¼Œç”¨ä¾†è¡¨ç¤ºä»–æ˜¯ä¸æ˜¯æƒ³è¦é€²å»critical sectionï¼ˆTrue å°±æ˜¯ä»–æº–å‚™å¥½é€²å»äº†ï¼‰</p></li><li><p>å°æ–¹å¯ä»¥çœ‹åˆ°åˆ¥äººçš„ flagï¼Œä½†æ˜¯åªæœ‰è‡ªå·±å¯ä»¥æ”¹è‡ªå·±çš„</p></li><li><p>æ‰€ä»¥é€²å»çš„æ™‚å€™å°±æ˜¯åˆ¥äººä¸æƒ³é€²å»ï¼Œæˆ–æ˜¯ä½ æ‹¿åˆ° token äº†ï¼ˆi.e.å°æ–¹æ²’æ‹¿åˆ° tokenï¼‰</p><figure><img src="/assets/%5BOS%5DChapter-6/Untitled%202.png"alt="æ³¨æ„æ˜¯è¦åœ¨é€²å»å‰æŠŠ turn å€¼çµ¦å°æ–¹" /><figcaption aria-hidden="true">æ³¨æ„æ˜¯è¦åœ¨<strong>é€²å»å‰</strong>æŠŠ turnå€¼çµ¦å°æ–¹</figcaption></figure></li></ul><h3 id="proof">Proof</h3><ul><li>Mutual exclusion: ç”¨åè­‰<ol type="1"><li><p>å‡è¨­ä»–å€‘å¯ä»¥åŒæ™‚åœ¨è£¡é¢</p></li><li><p>é‚£ä¸‹é¢çš„æ¢ä»¶å°±è¦åŒæ™‚å­˜åœ¨ã€‚</p><p><img src="/assets/%5BOS%5DChapter-6/Untitled%203.png" /></p></li><li><p>å› ç‚ºä»–å€‘éƒ½åœ¨è£¡é¢ï¼Œæ‰€ä»¥ flag éƒ½æ˜¯ true</p></li><li><p>ä½†æ˜¯ turn ä¸å¯èƒ½åŒæ™‚æ˜¯ 0 ä¸” 1</p></li><li><p>æ‰€ä»¥ä¸å¯èƒ½åŒæ™‚é€²å»</p></li></ol></li><li>Progress<ol type="1"><li>å‡è¨­ <span class="math inline">\(P_0\)</span> æƒ³è¦é€²å»ï¼Œä¸” <spanclass="math inline">\(P_1\)</span> ä¸æƒ³è¦é€²å»ï¼Œè¦è­‰é€™æ™‚å€™ <spanclass="math inline">\(P_0\)</span> æ‡‰è©²è¦è¦å¯ä»¥é€²å» â‡’å¥½åƒä¹Ÿä¸ç”¨è­‰ï¼Œåæ­£å°±å¯ä»¥å•Š</li><li>å…©å€‹éƒ½æƒ³é€²å»çš„æ™‚å€™ï¼Œé‚£å°±çœ‹<code>turn</code>ï¼Œä¸€å®šæœ‰å…¶ä¸­ä¸€å€‹å¯ä»¥é€²å»</li></ol></li><li>Bounded Waiting<ul><li>å‡è¨­ç•¶ <span class="math inline">\(P_1\)</span> æƒ³è¦é€²å»ï¼Œä½†æ˜¯ <spanclass="math inline">\(P_0\)</span> åœ¨è£¡é¢ã€‚</li></ul><ol type="1"><li><p><span class="math inline">\(P_0\)</span> ä¸€é›¢é–‹ CS å°±æŠŠ<code>flag</code> è¨­æˆ False äº†ï¼Œæ‰€ä»¥é¦¬ä¸Šå°±è¼ªåˆ° <spanclass="math inline">\(P_1\)</span> äº†</p></li><li><p><span class="math inline">\(P_0\)</span> å¦‚æœä¸€é›¢é–‹ CSå°±åˆæƒ³é€²å»ï¼ˆå¯èƒ½å› ç‚ºå‰©ä¸‹çš„éƒ½æ˜¯ CPU burstï¼Œæ‰€ä»¥å°±æ²’æœ‰è¢« content switchæ‰ï¼‰</p><p>â‡’ ä½†æ˜¯å› ç‚ºæœƒåœ¨æœ€ä¸€é–‹å§‹æŠŠ token çµ¦åˆ¥äººï¼Œæ‰€ä»¥æœƒè¢«è®“çµ¦åˆ¥äººä½œ</p></li></ol></li></ul><h2 id="producerconsumer-problem">Producer/Consumer Problem</h2><ul><li><p>å¦‚æœå…ˆé€² Consumer å°±æœƒ deadlockï¼ˆi.e. ç¨‹å¼æ²’æœ‰åœ¨å‰é€²ï¼Œä½†æ˜¯ CPUåœ¨ç‡’ï¼‰ã€‚</p><p><img src="/assets/%5BOS%5DChapter-6/Untitled%204.png" /></p></li><li><p>æ­£ç¢ºä½†æ˜¯ä½æ•ˆèƒ½ã€‚</p><p><img src="/assets/%5BOS%5DChapter-6/Untitled%205.png" /></p></li><li><p>æ­£ç¢ºä¸”å„ªè³ªã€‚</p><p><img src="/assets/%5BOS%5DChapter-6/Untitled%206.png" /></p></li></ul><h2 id="bakery-algorithm-n-processes">Bakery Algorithm (nprocesses)</h2><ul><li>åƒå»éºµåŒ…åº—</li></ul><ol type="1"><li>åœ¨æ¯æ¬¡é€²å» CS å‰ï¼Œè¦æŠ½è™Ÿç¢¼ç‰Œ</li><li>è™Ÿç¢¼ç‰Œæœ€å°çš„å…ˆé€²ï¼ˆå› ç‚º counter æ˜¯ç”¨ <code>++</code>çš„ï¼Œæ‰€ä»¥<strong>åªèƒ½</strong>ä¿è­‰æ˜¯ non-decrease order çš„ï¼Œe.g. 1, 2, 3,3, 4, 4, 4, 5ï¼‰</li><li>å¦‚æœè™Ÿç¢¼ç‰Œä¸€æ¨£ï¼Œå°±æ ¹æ“š process IDï¼Œå°çš„å…ˆ</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Process i</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">choosing[i] = <span class="literal">true</span>;  <span class="comment">// é–‹å§‹æŠ½</span></span><br><span class="line">num[i] = <span class="built_in">max</span>(num[<span class="number">0</span>], num[<span class="number">1</span>], ..., num[n<span class="number">-1</span>]) + <span class="number">1</span>; <span class="comment">// get ticket</span></span><br><span class="line">choosing[i] = <span class="literal">false</span>; <span class="comment">// æŠ½å®Œäº†</span></span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line"><span class="keyword">while</span> (choosing[j]);  <span class="comment">// ç¢ºå®šä»–æŠ½å®Œäº†æ‰å¯ä»¥æ¯”</span></span><br><span class="line"><span class="keyword">while</span> ((num[j] != <span class="number">0</span>) &amp;&amp;     <span class="comment">// num æ˜¯ 0 å°±æ˜¯ä¸æƒ³é€²å»</span></span><br><span class="line"> ((num[j], j) &lt; (num[i], i))); <span class="comment">// æ¯”è¼ƒæ¯ä¸€å€‹ j ç¢ºå®šæˆ‘æ˜¯æœ€å°çš„</span></span><br><span class="line">&#125;</span><br><span class="line">**critical section**</span><br><span class="line">num[i] = <span class="number">0</span>;</span><br><span class="line">**reminder section**</span><br><span class="line">&#125; <span class="keyword">while</span>(<span class="number">1</span>);</span><br></pre></td></tr></table></figure><ul><li>æœ€å°è™Ÿç¢¼ä¸€å®šå…ˆåš â†’ first come first serve â†’ bounded-waitingtime</li><li>å¦‚æœæ²’æœ‰ choosing<ol type="1"><li>å‡è¨­ç›®å‰æœ€å¤§æ˜¯ 5</li><li>P4 æŠ½çš„æ¯”è¼ƒå¿«ï¼ŒæŠ½åˆ° 6ï¼Œé€™æ™‚å€™ P1 é‚„æ˜¯ 0</li><li>ç„¶å¾Œ P4 æœƒé€²å» CSï¼ˆä»–é€™æ™‚å€™æœƒä»¥ç‚º P1 æ²’æœ‰è¦é€²å»ï¼Œå› ç‚ºä»–æ˜¯ 0ï¼‰</li><li>æ¥ä¸‹ä¾† P1 æŠ½å®Œäº†ï¼ŒæŠ½åˆ° 6ï¼Œä»–å°±å»è·Ÿ P4 æ¯”ï¼Œç™¼ç¾è·Ÿä»–ä¸€æ¨£ï¼Œä½†æ˜¯ä»–çš„ pidæ¯”è¼ƒå°ï¼Œæ‰€ä»¥ä»–å°±é–‹é–‹å¿ƒå¿ƒçš„é€²å»äº†ã€‚ç„¶å¾Œå°±æ²’æœ‰ç„¶å¾Œäº†ã€‚(race conditionby355)</li></ol><ul><li>å¦‚æœæœ‰ lockingï¼ŒP4 å°±æœƒç­‰åˆ° P1 å…ˆæŠ½å®Œå†è·Ÿä»–æ¯”</li></ul></li></ul><h1 id="synchronization-hardware">Synchronization Hardware</h1><p>åªè¦ç”¨åˆ° Hardware çš„å°±ç®—æ˜¯ï¼ˆåŒ…æ‹¬ä¹‹å‰çš„ disable interruptï¼‰</p><h2 id="atomic-instruction">Atomic instruction</h2><p>ä¸€å€‹ CPU çš„ instructionï¼Œæ‰€ä»¥ä¸€å®šæœƒä¸€æ¬¡åšå®Œã€‚</p><p>ä¸éœ€è¦ library çš„ supportï¼Œå…§å»ºå°±æœ‰äº†ã€‚</p><h3 id="testandset"><code>TestAndSet()</code></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">boolean <span class="title">TestAndSet</span> <span class="params">(<span class="type">bool</span> &amp;lock)</span> </span>&#123;</span><br><span class="line"><span class="type">bool</span> value = lock;</span><br><span class="line">lock = TRUE;   <span class="comment">// ä¸è«–çµæœï¼Œéƒ½æœƒé–èµ·ä¾†</span></span><br><span class="line"><span class="keyword">return</span> value;  <span class="comment">// return çš„æ˜¯åŸæœ¬çš„å€¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/assets/%5BOS%5DChapter-6/Untitled%207.png" /></p><ul><li><p>Mutual exclusion: Yes</p><p>â‡’ å› ç‚ºåªæœ‰æ­£åœ¨ CS è£¡é¢çš„äººæŠŠä»–è¨­æˆ False æ‰å¯ä»¥æ”¾ä¸‹ä¸€å€‹é€²å»</p></li><li><p>Progress: Yes</p><p>â‡’ åªè¦æ²’äººåœ¨è£¡é¢ï¼Œæƒ³é€²å»å°±å¯ä»¥é¦¬ä¸Šé€²å»</p></li><li><p>Bounded-Wait: No</p><p>â‡’ å› ç‚ºå…ˆæ¶å…ˆè´ï¼Œæ‰€ä»¥å¯èƒ½ä¸€ç›´æ¶ä¸åˆ°</p><p>â‡’ P0 çš„ CS çµæŸäº†ï¼Œä½†æ˜¯ CPU burst é‚„æ²’å®Œï¼Œæ‰€ä»¥ä»–åˆæ¶åˆ°lockï¼Œç„¶å¾Œé€²å»ä¹‹å¾Œ CPU burst çµæŸäº†ï¼Œcontent switchã€‚æ›P1ï¼Œä½†æ˜¯ä»–è¢«æ“‹åœ¨å¤–é¢ï¼ŒCPU burst ç‡’å®Œä¹‹å¾Œéƒ½è¼ªä¸åˆ°ä»– QQï¼Œåˆå›åˆ° P0ç¹¼çºŒã€‚</p></li></ul><h3 id="swap"><code>Swap()</code></h3><p>æŠŠå€¼å°èª¿ã€‚</p><figure><img src="/assets/%5BOS%5DChapter-6/Untitled%208.png"alt="ä¸€é–‹å§‹æœƒæŠŠ key è¨­æˆ Trueï¼Œç„¶å¾Œå°±åœ¨ while è£¡é¢ä¸€ç›´æŠŠ lock è·Ÿ key äº¤æ›ã€‚å¦‚æœ lock åœ¨åˆ¥çš„åœ°æ–¹è¢«è¨­æˆ False äº†ï¼Œå°±å¯ä»¥é€²å» CS äº†ã€‚" /><figcaption aria-hidden="true">ä¸€é–‹å§‹æœƒæŠŠ key è¨­æˆ Trueï¼Œç„¶å¾Œå°±åœ¨ whileè£¡é¢ä¸€ç›´æŠŠ lock è·Ÿ key äº¤æ›ã€‚å¦‚æœ lock åœ¨åˆ¥çš„åœ°æ–¹è¢«è¨­æˆ Falseäº†ï¼Œå°±å¯ä»¥é€²å» CS äº†ã€‚</figcaption></figure><ul><li>ç‰¹æ€§ä¹Ÿè·Ÿå‰›å‰›ä¸€æ¨£</li></ul><h2 id="review-slide-2">Review Slide (2)</h2><ul><li>Use software solution to solve CS?<ul><li>Petersonâ€™s and Bakery algorithms</li></ul></li><li>Use HW support to solve CS?<ul><li><code>TestAndSet()</code>, <code>Swap()</code></li></ul></li></ul><h1 id="semaphores">Semaphores</h1><ul><li>Resource counting çš„å•é¡Œã€‚</li><li>ä¸€å€‹å€¼ indicate æƒ³è¦é€é semaphore ä¿è­·çš„è³‡æºçš„æ•¸é‡å¤šå¯¡ã€‚<ul><li>If #record = 1 â†’ binary semaphore, mutex lock</li><li>if #record &gt; 1 â†’ counting semaphore</li></ul></li><li>ç”¨å…©å€‹ atomic operationï¼š<ol type="1"><li><p><code>wait</code>ï¼šæ¶è³‡æº</p><p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">wait</span>(S) &#123;</span><br><span class="line"><span class="keyword">while</span> (S &lt;= <span class="number">0</span>); <span class="comment">// busy waiting</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç”¨çš„æ˜¯ Spinlock â†’ ç­‰å¾…é‚„æ˜¯æœƒç‡’ CPUï¼ˆå› ç‚ºä¸€ç›´åœ¨ä½œæŒ‡ä»¤ï¼‰</p></li><li><p><code>signal</code>ï¼šæ”¾è³‡æº</p><p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">signal</span>(S) &#123;</span><br><span class="line">S++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></li></ol></li></ul><h2 id="posix-semaphore">POSIX Semaphore</h2><ul><li><p>ä»–æ˜¯ OS çš„ API</p></li><li><p>Semaphore is part of POSIX standard BUT it is not belonged toPthread</p><ul><li>It can be used with or <strong>without</strong> thread</li></ul></li><li><p>å› ç‚º lock å¤šæ˜¯åœ¨ threads ä¹‹é–“ï¼Œsemaphore å¤šæ˜¯åœ¨ processä¹‹é–“ã€‚</p></li><li><p>POSIX Semaphore routines:</p><p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sem_init</span>(<span class="type">sem_t</span> *sem, <span class="type">int</span> pshared, <span class="type">unsigned</span> <span class="type">int</span> value)</span><br><span class="line"><span class="built_in">sem_wait</span>(<span class="type">sem_t</span> *sem)</span><br><span class="line"><span class="built_in">sem_post</span>(<span class="type">sem_t</span> *sem)</span><br><span class="line"><span class="built_in">sem_getvalue</span>(<span class="type">sem_t</span> *sem, <span class="type">int</span> *valptr) <span class="comment">// check</span></span><br><span class="line"><span class="built_in">sem_destroy</span>(<span class="type">sem_t</span> *sem)</span><br></pre></td></tr></table></figure></p></li><li><p>Example:</p><p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;semaphore.h&gt;</span></span></span><br><span class="line"><span class="type">sem_t</span> sem;</span><br><span class="line"><span class="built_in">sem_init</span>(&amp;sem);</span><br><span class="line"><span class="built_in">sem_wait</span>(&amp;sem);</span><br><span class="line"><span class="comment">// critical section</span></span><br><span class="line"><span class="built_in">sem_post</span>(&amp;sem);</span><br><span class="line"><span class="built_in">sem_destroy</span>(&amp;sem);</span><br></pre></td></tr></table></figure></p></li><li><p>Another example</p><p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line"><span class="built_in">wait</span>(mutex);   <span class="comment">// pthread_mutex_lock(&amp;mutex)</span></span><br><span class="line"><span class="comment">// critical section</span></span><br><span class="line"><span class="built_in">signal</span>(mutex); <span class="comment">// pthread_mutex_unlock(&amp;mutex)</span></span><br><span class="line"><span class="comment">// remainder section</span></span><br><span class="line">&#125; <span class="keyword">while</span>(<span class="number">1</span>);</span><br></pre></td></tr></table></figure></p><ul><li>Progress: Yes</li><li>Bounded waiting: å–æ±ºæ–¼ <code>wait</code> çš„å¯¦ä½œ</li></ul></li></ul><h2 id="non-busy-waiting-implementation">Non-busy waitingImplementation</h2><aside><p>âœï¸ Waiting çš„æ‡‰è©²è¦è¢« put to sleepï¼ˆæ‰€ä»¥æœ‰è¦è¦å» wake up ä»–ï¼‰</p></aside><ul><li><p>Semaphore is data struct with a queue ï¼ˆå¯ä»¥ç”¨å„ç¨® queuestrategyï¼‰</p><p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="type">int</span> value;        <span class="comment">// init to 0</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">process</span> *L;</span><br><span class="line"><span class="comment">// â€œPCBâ€ queue </span></span><br><span class="line">&#125; semaphore;</span><br></pre></td></tr></table></figure></p><p><img src="/assets/%5BOS%5DChapter-6/Untitled%209.png" /></p></li><li><p><code>wait()</code> and <code>signal()</code></p><ul><li>éœ€è¦ç”¨åˆ° <code>block()</code> and <code>wakeup()</code> å…©å€‹ systemcallsã€‚ï¼ˆæ˜é¡¯çš„ç¼ºé»ï¼Œéœ€è¦å¤šç”¨åˆ° system callï¼‰</li></ul><p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">signal</span><span class="params">(semaphore S)</span> </span>&#123; </span><br><span class="line">S.value++;</span><br><span class="line"><span class="keyword">if</span> (S.value &lt;= <span class="number">0</span>) &#123;         <span class="comment">// æ³¨æ„æœ‰ `=`ï¼Œå› ç‚ºæˆ‘å€‘å…ˆ `++` äº† </span></span><br><span class="line">remove a process P from S.L; </span><br><span class="line"><span class="built_in">wakeup</span>(P);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">wait</span><span class="params">(semaphore S)</span> </span>&#123;</span><br><span class="line">S.value--;  <span class="comment">// subtract first</span></span><br><span class="line"><span class="keyword">if</span> (S.value &lt; <span class="number">0</span>) &#123;         <span class="comment">// æ³¨æ„æ²’æœ‰ `=`</span></span><br><span class="line">add <span class="keyword">this</span> process to S.L; <span class="comment">// è¦å…ˆæ”¾é€²å»æ‰èƒ½å»ç¡è¦º</span></span><br><span class="line"><span class="built_in">block</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></li><li><p>æ›´å¤šè¡ŒåŠ ä¸Šæ›´å¤š share dataï¼ˆé‚£äº› queueï¼‰ï¼Œæ‰€ä»¥è¦ç¢ºä¿ä»–æœ‰ atomicçš„ç‰¹æ€§ã€‚å¯ä»¥ç”¨ï¼š</p><ul><li>Single-processor: disable interrupts</li><li>Multi-processor:<ul><li>HW support (e.g. Test-And-Set, Swap)</li><li>SW solution (Petersonâ€™s solution, Bakery algorithm)</li></ul></li></ul><figure><img src="/assets/%5BOS%5DChapter-6/Untitled%2010.png"alt="æ³¨æ„ä¸è¦åŒ…åˆ° sleep å’Œ wakeupï¼Œä¸ç„¶æœƒ deadlockã€‚" /><figcaption aria-hidden="true">æ³¨æ„ä¸è¦åŒ…åˆ° sleep å’Œ wakeupï¼Œä¸ç„¶æœƒdeadlockã€‚</figcaption></figure></li><li><p>å¦‚æœç­‰å¾…æ™‚é–“çŸ­ï¼Œä¸å¦‚ç”¨ busy waitingï¼Œä¸ç„¶è¦ä¸€ç›´ call systemcallã€‚</p></li></ul><h2 id="cooperation-synchronization">Cooperation Synchronization</h2><p>å› ç‚ºæœƒæœ‰è³‡æ–™çš„ independencyï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç”¨é€™å€‹ä¾†è§£ã€‚</p><ul><li><p>Example:</p><ul><li><p>P1 executes S1; P2 executes S2 (S2 be executed only after S1 hascompleted)</p></li><li><p><code>sync</code> ä¸€é–‹å§‹è¨­æˆ 0</p><p><img src="/assets/%5BOS%5DChapter-6/Untitled%2011.png" /></p></li></ul></li><li><p>A More Complicated Example (DAG)</p><p><img src="/assets/%5BOS%5DChapter-6/Untitled%2012.png" /></p><ul><li>(Initially, all semaphores are 0)</li></ul><p><img src="/assets/%5BOS%5DChapter-6/Untitled%2013.png" /></p></li></ul><h2 id="deadlocks-starvation">Deadlocks &amp; Starvation</h2><ul><li>Deadlocks: 2 processes are waiting indefinitely for each other torelease resourcesï¼ˆç¨‹å¼ä¹‹é–“å½¼æ­¤äº’å¡ï¼‰</li><li>Starvation:<ul><li>example: LIFO (Last In First Out) queue in semaphore processqueue</li><li>æœ‰äººå¯ä»¥åŸ·è¡Œåªæ˜¯è¼ªä¸åˆ°æˆ‘</li></ul></li></ul><h2 id="review-slide-3">Review Slide (3)</h2><ul><li>Whatâ€™s semaphore? 2 operations?</li><li>Whatâ€™s busy-waiting (Spinlock) semaphore?</li><li>Whatâ€™s non-busy-waiting (Non-Spinlock) semaphore?</li><li>How to ensure atomic wait &amp; signal ops?</li><li>Deadlock? starvation?</li></ul><h1 id="classical-problems-of-synchronization">Classical Problems ofSynchronization</h1><p>è§£æ±ºæ–¹æ³•å¾ˆå¤šï¼Œé‡é»æ˜¯å»å®šç¾©å•é¡Œã€‚</p><ul><li>Bounded-Buffer (Producer-Consumer) Problem</li><li>Reader-Writers Problem</li><li>Dining-Philosopher Problem</li></ul><h2 id="bounded-buffer-problem">Bounded-Buffer Problem</h2><p>å°±ä¸Šé¢é‚£äº›å•é¡Œã€‚</p><ul><li>A pool of <em>n</em> buffers, each capable of holding one item</li><li>Producer:<ul><li>grab an empty buffer</li><li>place an item into the buffer</li><li>waits if no empty buffer is available</li></ul></li><li>Consumer:<ul><li>grab a buffer and retracts the item</li><li>place the buffer back to the free pool</li><li>waits if all buffers are empty</li></ul></li></ul><h2 id="readers-writers-problem">Readers-Writers Problem</h2><ul><li>reader processes â†’ åªæœƒè®€</li><li>writer processes â†’ åªæœƒå¯«</li><li>å¦‚æœéƒ½æ˜¯ reader é‚£æ²’å·®ï¼Œåæ­£åŒæ™‚ read ä¹Ÿä¸æœƒå‡ºäº‹ã€‚ä½†æ˜¯ writerå°±åªèƒ½ä¸€å€‹äººå¯«ï¼Œé€£ reader éƒ½ä¸èƒ½åŒæ™‚ readã€‚ï¼ˆExclusive accessï¼‰</li><li>Different variations involving priority<ul><li><p><strong>First RW problem</strong>: no reader will be kept waitingunless a writer is updating a shared objectï¼ˆåªè¦ç¬¦åˆä¸Šé¢çš„åŸºæœ¬å®šç¾©å°±å¥½äº†ï¼‰</p></li><li><p><strong>Second RW problem</strong>: first çš„æ¢ä»¶åŠ ä¸Š writer ä¸èƒ½starvationã€‚</p><p>â†’ Writer è¦æ¯”è¼ƒé«˜çš„ priority</p><p>â†’ once a writer is ready, no new reader may start reading</p></li></ul></li></ul><h3 id="first-reader-writer-algorithm">First Reader-WriterAlgorithm</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mutual exclusion for write</span></span><br><span class="line">semaphore wrt = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// mutual exclusion for readcount</span></span><br><span class="line">semaphore mutex=<span class="number">1</span>  <span class="comment">// ä¿è­· readcount</span></span><br><span class="line"><span class="type">int</span> readcount=<span class="number">0</span>;   <span class="comment">// æœ‰å¤šå°‘äººè¦ read</span></span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Writer</span>() &#123; </span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="built_in">wait</span>(wrt);</span><br><span class="line">**<span class="comment">// Writer Code**</span></span><br><span class="line"><span class="built_in">signal</span>(wrt);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Reader</span>() &#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="built_in">wait</span>(mutex);</span><br><span class="line"></span><br><span class="line">readcount++;</span><br><span class="line"><span class="comment">// Acquire write lock if reads havenâ€™t</span></span><br><span class="line"><span class="comment">// å…¨éƒ¨ reader å…±ç”¨ä¸€å€‹ write lock</span></span><br><span class="line"><span class="keyword">if</span> (readcount == <span class="number">1</span>) <span class="comment">// ä»£è¡¨åŸæœ¬æ²’æœ‰äººåœ¨ read</span></span><br><span class="line"><span class="built_in">wait</span>(wrt);        <span class="comment">// æ‰€ä»¥éœ€è¦è¦éä¾†</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">signal</span>(mutex);</span><br><span class="line"></span><br><span class="line">**<span class="comment">// Reader Code**</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">wait</span>(mutex);</span><br><span class="line"></span><br><span class="line">readcount--;</span><br><span class="line"><span class="comment">// release write lock if no more reads</span></span><br><span class="line"><span class="keyword">if</span> (readcount == <span class="number">0</span>)  <span class="comment">// ä»£è¡¨æ²’æœ‰äººè¦ read äº†</span></span><br><span class="line"><span class="built_in">signal</span>(wrt);       <span class="comment">// å°±å¯ä»¥æ”¾æ‰äº†</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">signal</span>(mutex);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>Writer æœƒæœ‰ starvationï¼Œå› ç‚º reader å…±ç”¨ä¸€å€‹lockï¼Œæ‰€ä»¥å¯ä»¥ä¸€ç›´è¼ªæµä½”è‘—</p><p>â‡’ Second RW problem solve it.</p></li></ul><h3 id="dining-philosophers-problem">Dining-Philosophers Problem</h3><p><img src="/assets/%5BOS%5DChapter-6/Untitled%2014.png" /></p><ul><li>æ¯å€‹äººå·¦é‚Šè·Ÿå³é‚Šéƒ½æœ‰ä¸€æ ¹ç­·å­ï¼ˆäº”å€‹äººäº”éš»ç­·å­ï¼‰<ul><li>åƒé£¯éœ€è¦å…©éš»ç­·å­</li><li>ä¸€éš»ç­·å­åªèƒ½ä¸€å€‹äººæ‹¿</li><li>åƒå®Œå°±è¦æŠŠç­·å­æ”¾ä¸‹</li></ul></li><li>Deadlock problem<ul><li>æ¯å€‹äººæ‹¿å·¦é‚Šçš„ç­·å­ç›´åˆ°åƒå®Œé£¯ â†’ å¡æ­»</li></ul></li><li>Starvation problem<ul><li>ä¸èƒ½è®“äººä¸€ç›´æ‹¿ï¼Œä¸€ç›´åƒ</li></ul></li></ul><h1 id="monitors">Monitors</h1><aside><p>ğŸ’¡ å‹•æ©Ÿï¼šå› ç‚ºå‰é¢å¾ˆé›£ï¼Œè¦åœ¨å°çš„åœ°æ–¹ç”¨å°çš„æ±è¥¿ï¼Œä¸èƒ½å¤šï¼Œä¸èƒ½å°‘ã€‚</p></aside><ul><li><p>ç›®çš„æ˜¯è¦æ›´æŠ½è±¡åŒ–ï¼ˆä»–æ˜¯åœ¨ language levelï¼‰</p></li><li><p>è·Ÿ OO å¾ˆåƒ</p></li><li><p>åƒæ˜¯ç”±ä¸€å€‹ class å®šç¾©çš„æ±è¥¿ï¼šæœ‰è‡ªå·±çš„ methodsã€variablesã€privatevariablesã€‚</p></li><li><p>ï¼ˆPrivate variables åªèƒ½ç”±è‡ªå·±çš„ methods æ“ä½œï¼‰</p></li><li><p>å’Œ OO ä¸åŒçš„æ˜¯ä»–æœƒç¢ºä¿ä»–çš„ process åªæœƒæœ‰ä¸€å€‹åœ¨<strong>active</strong> (running) çš„ç‹€æ…‹</p></li><li><p>Schematic View ****</p><p><img src="/assets/%5BOS%5DChapter-6/Untitled%2015.png" /></p><ul><li>Shared data â†’ private variable</li><li>Operations â†’ methods</li><li>Initialization code â†’ constructor</li><li>Entry queue â†’ æƒ³è¦ç”¨ monitors çš„å‚¢ä¼™</li></ul></li></ul><h2 id="monitor-condition-variables">(Monitor) Condition Variables</h2><ul><li><p>ä»–æ˜¯ä¸€å€‹ç¨ç«‹çš„åŒæ­¥åŒ– toolï¼Œè·Ÿ monitor æ²’é—œä¿‚</p></li><li><p>Event driven</p></li><li><p>To allow a process to wait <strong>within</strong> the monitor, acondition variable must be declared, as</p><p><code>condition x, y;</code></p></li><li><p>Can be used with <code>wait()</code> and <code>signal()</code>ï¼ˆä½†æ˜¯è·Ÿä¸Šé¢çš„é‚£äº›æ¯«ç„¡é—œä¿‚ï¼Œè«‹ä¸è¦ææ··ï¼Œå®šç¾©å®Œå…¨ä¸åŒï¼‰</p><ul><li><p><code>x.wait()</code></p><p>æœ‰ä¸€å€‹ event queueï¼Œæ‰€ä»¥é€™åƒæ˜¯ enqueueã€‚ï¼ˆä¸Šé¢çš„é‚£å€‹æ˜¯countingï¼‰</p></li><li><p><code>x.signal()</code></p><p>åƒæ˜¯ dequeueï¼ŒæŠŠè£¡é¢çš„ processå«é†’å»å·¥ä½œã€‚å¦‚æœè£¡é¢æ²’æœ‰æ±è¥¿ï¼Œå°±å•¥éƒ½ä¸æœƒç™¼ç”Ÿã€‚ï¼ˆå¦‚æœæ˜¯semaphoreï¼Œå€¼æœƒç¹¼çºŒåŠ ä¸Šå»ï¼‰</p></li></ul></li></ul><p><img src="/assets/%5BOS%5DChapter-6/Untitled%2016.png" /></p><ul><li><p>Dining Philosophers Example</p><ul><li>Thinking â€” æ ¹æœ¬æ²’è¦åƒ</li><li>å‡è¨­å¤§å®¶éƒ½æ˜¯çœ‹å¾—åˆ°å½¼æ­¤çš„ç‹€æ…‹çš„ï¼ˆi.e. æœ‰ Global informationï¼‰</li></ul><p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">monitor dp &#123;</span><br><span class="line"><span class="keyword">enum</span> &#123;thinking, hungry, eating&#125; state[<span class="number">5</span>]; <span class="comment">// current state</span></span><br><span class="line">condition self[<span class="number">5</span>]; <span class="comment">// delay eating if canâ€™t obtain chopsticks</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pickup</span> <span class="params">(<span class="type">int</span> i)</span>    <span class="comment">// pickup chopsticks</span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">putdown</span> <span class="params">(<span class="type">int</span> i)</span>   <span class="comment">// putdown chopsticks</span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span> <span class="params">(<span class="type">int</span> i)</span>      <span class="comment">// try to eat</span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) </span><br><span class="line">state[i] = thinking;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="type">void</span> <span class="title">pickup</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">state[i] = hungry;</span><br><span class="line"><span class="built_in">test</span>(i);               <span class="comment">// try to eat (to prevent deadlock)</span></span><br><span class="line"><span class="keyword">if</span> (state[i] != eating)  <span class="comment">// æ²’æˆåŠŸåƒåˆ°</span></span><br><span class="line">self[i].<span class="built_in">wait</span>();        <span class="comment">// wait to eat</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">putdown</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">  state[i] = thinking;</span><br><span class="line"></span><br><span class="line"><span class="comment">// check if neighbors are waiting to eat</span></span><br><span class="line"><span class="comment">// å«ä»–å€‘èµ·ä¾†åƒé£¯</span></span><br><span class="line"><span class="built_in">test</span>((i+<span class="number">4</span>) % <span class="number">5</span>);</span><br><span class="line"><span class="built_in">test</span>((i+<span class="number">1</span>) % <span class="number">5</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> ((state[(i + <span class="number">4</span>) % <span class="number">5</span>] != eating) </span><br><span class="line">&amp;&amp; (state[(i + <span class="number">1</span>) % <span class="number">5</span>] != eating) <span class="comment">// å·¦é‚Šå’Œå³é‚Šæœ‰æ²’æœ‰åœ¨åƒ</span></span><br><span class="line">&amp;&amp; (state[i] == hungry)) &#123;        <span class="comment">// å’Œæˆ‘æƒ³ä¸æƒ³åƒ</span></span><br><span class="line"><span class="comment">// No neighbors are eating and Pi is hungry</span></span><br><span class="line">state[i] = eating;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŠŠä»–è‡ªå·±å«èµ·ï¼ˆå¦‚æœæ˜¯ pickup call çš„ï¼Œé€™æ˜¯æ²’æœ‰ç”¨çš„</span></span><br><span class="line"><span class="comment">// ä½†æ˜¯å¦‚æœæ˜¯ putdown call çš„ï¼Œé‚£å°±æœƒæ–é†’ç¡è‘—çš„ï¼‰</span></span><br><span class="line">self[i].<span class="built_in">signal</span>(); </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li><p>An illustration</p><p><img src="/assets/%5BOS%5DChapter-6/Untitled%2017.png" /></p><p><img src="/assets/%5BOS%5DChapter-6/Untitled%2018.png" /></p><p><img src="/assets/%5BOS%5DChapter-6/Untitled%2019.png" /></p><figure><img src="/assets/%5BOS%5DChapter-6/Untitled%2020.png"alt="P2 test å¤±æ•—ï¼Œæ‰€ä»¥å» waiting" /><figcaption aria-hidden="true">P2 test å¤±æ•—ï¼Œæ‰€ä»¥å» waiting</figcaption></figure><p><img src="/assets/%5BOS%5DChapter-6/Untitled%2021.png" /></p><figure><img src="/assets/%5BOS%5DChapter-6/Untitled%2022.png"alt="P2 è¢«å«é†’äº†" /><figcaption aria-hidden="true">P2 è¢«å«é†’äº†</figcaption></figure><p><img src="/assets/%5BOS%5DChapter-6/Untitled%2023.png" /></p></li></ul></li></ul><h1 id="thread-programming">Thread Programming</h1><p>ï¼ˆè€ƒè©¦æ¯”è¼ƒä¸æœƒè€ƒï¼‰</p><h2 id="pthread-lockmutex-routines">Pthread Lock/Mutex Routines</h2><p>To use mutex:</p><ul><li>Declared as of type <code>pthread_mutex_t</code></li><li>Initialized with <code>pthread_mutex_init()</code></li><li>Destroyed with <code>pthread_mutex_destroy()</code></li><li>Use <code>pthread_mutex_lock()</code> and<code>pthread_mutex_unlock()</code></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> â€œpthread.hâ€</span></span><br><span class="line">pthread_mutex mutex;</span><br><span class="line"><span class="built_in">pthread_mutex_init</span> (&amp;mutex, <span class="literal">NULL</span>);  <span class="comment">// NULL -&gt; optional configuration</span></span><br><span class="line"><span class="built_in">pthread_mutex_lock</span>(&amp;mutex);</span><br><span class="line">**<span class="comment">// Critical Section**</span></span><br><span class="line"><span class="built_in">pthread_mutex_unlock</span>(&amp;mutex);</span><br><span class="line"><span class="built_in">pthread_mutex_destroy</span>(&amp;mutex);</span><br></pre></td></tr></table></figure><h2 id="condition-variables-cv">Condition Variables (CV)</h2><p>è·Ÿä¸Šé¢çš„ä¸€æ¨£ã€‚</p><ul><li><p>In Pthread, CV type is a <code>pthread_cond_t</code></p><ul><li>Use <code>pthread_cond_init()</code> ****to initialize</li><li><code>pthread_cond_wait (&amp;theCV, &amp;somelock)</code></li><li><code>pthread_cond_signal (&amp;theCV)</code></li><li><code>pthread_cond_broadcast (&amp;theCV)</code> â†’ æŠŠ queueè£¡é¢å…¨éƒ¨çš„ thread éƒ½å«é†’ï¼ˆi.e. å°ä»–å€‘å…¨éƒ¨ä½œ <code>signal</code>ï¼‰</li></ul></li><li><p>Example</p><ul><li>ä¸€å€‹ thread åœ¨ x = 0 çš„æ™‚å€™åšäº‹</li><li>å¦ä¸€å€‹è² è²¬ x--</li></ul><p><img src="/assets/%5BOS%5DChapter-6/Untitled%2024.png" /></p><ul><li><p>ä¸€å®šè¦æŠŠ wait å’Œ signal åœ¨ mutex è¢« lock çš„æ™‚å€™æ‰èƒ½ç”¨ï¼ˆä¸ç„¶é€£code éƒ½ä¸æœƒè·‘ï¼‰</p><ol type="1"><li>å› ç‚º call wait å’Œ signal çš„æ™‚å€™ï¼Œå¤§å¤šæœƒå’Œå…¶ä»– conditional variableæœ‰ç›¸ä¾æ€§ï¼ˆIn this case: <code>x</code>ï¼‰ï¼Œæ‰€ä»¥ lockèµ·ä¾†æ‰æ˜¯åˆç†çš„ã€‚</li><li>è¦ç¢ºä¿ <code>cond</code> ä¸æœƒæœ‰ concurrent write çš„å•é¡Œã€‚</li></ol><p>â‡’ æ‰€ä»¥è‡³å°‘è¦åŒ…åˆ°ä»–æœ¬èº«å’Œä»–çš„è§¸ç™¼æ¢ä»¶ã€‚</p></li><li><p>What really happens...</p><ol type="1"><li><p><code>action</code>: Lock <code>mutex</code></p><p><img src="/assets/%5BOS%5DChapter-6/Untitled%2025.png" /></p></li><li><p><code>action</code> call <code>wait</code>, put thread into sleepand <strong>release the lock</strong>. â‡’ å› ç‚º <code>wait</code> æœƒç›´æ¥release <code>mutex</code> ï¼ˆæ‰€ä»¥ä¸æ˜¯ä¸‹é¢é‚£è¡Œåšçš„ï¼Œæ˜¯ <code>wait</code>å°±ç›´æ¥ release æ‰äº†ï¼ï¼‰</p><p><code>counter</code> lock <code>mutex</code></p><p><img src="/assets/%5BOS%5DChapter-6/Untitled%2026.png" /></p></li><li><p><code>counter</code> go into CS and call <code>signal</code>.</p><p><code>action</code> is waked up, but thread is locked.ï¼ˆ<code>unlock</code> æœƒå…ˆå‘¼å« <code>lock</code>ç¢ºå®šå¯ä»¥è·‘ï¼Œä½†é¡¯ç„¶ä¸è¡Œï¼Œå› ç‚º lock é‚„åœ¨ counter é‚£é‚Š ï¼‰</p><p><img src="/assets/%5BOS%5DChapter-6/Untitled%2027.png" /></p></li><li><p><code>counter</code> call unlock.</p><p><code>action</code> Re-acquire lock and resume execution</p><p><img src="/assets/%5BOS%5DChapter-6/Untitled%2028.png" /></p></li><li><p><code>action</code> release lock</p><p><img src="/assets/%5BOS%5DChapter-6/Untitled%2029.png" /></p></li></ol><ul><li>å¦ä¸€å€‹æˆ‘å€‘ä¹‹æ‰€ä»¥è¦ç”¨ lock åŒ…ä½çš„åŸå› ã€‚</li></ul></li></ul></li></ul><h2 id="threadpool-implementation">ThreadPool Implementation</h2><ul><li><p>Task structure</p><p><img src="/assets/%5BOS%5DChapter-6/Untitled%2030.png" /></p><ul><li>å­˜ function pointer è·Ÿ argument</li></ul></li><li><p>ThreadPool structure</p><p><img src="/assets/%5BOS%5DChapter-6/Untitled%2031.png" /></p><ul><li><code>thread_count</code> â€” ç´€éŒ„ä¸€å…±æœ‰å¤šå°‘ threads</li><li><code>*thread</code> â€” threadPool</li><li><code>head</code> â€” <code>*queue</code> çš„ head</li><li><code>tail</code> â€” <code>*queue</code> çš„ tail</li><li><code>shutdown</code> â€” threadPool æ˜¯ä¸æ˜¯è¦çµæŸæ‰äº†ï¼ˆæ±ºå®šè¦ä¸è¦break while loopï¼‰</li></ul></li><li><p>Allocate thread and task queue</p><p><img src="/assets/%5BOS%5DChapter-6/Untitled%2032.png" /></p></li><li><p>Implement</p><figure><img src="/assets/%5BOS%5DChapter-6/Untitled%2033.png"alt="æ³¨æ„æœ‰å€‹ mutex_lock ä¹Ÿæœƒå»æª¢æŸ¥ count æ˜¯ä¸æ˜¯ 0ï¼Œå¦‚æœæ˜¯ï¼Œé‚£ç›®å‰æ²’æœ‰å·¥ä½œï¼Œå…ˆç¡è¦ºï¼ˆnotify is our condition variableï¼‰" /><figcaption aria-hidden="true">æ³¨æ„æœ‰å€‹ <code>mutex_lock</code>ä¹Ÿæœƒå»æª¢æŸ¥ <code>count</code> æ˜¯ä¸æ˜¯0ï¼Œå¦‚æœæ˜¯ï¼Œé‚£ç›®å‰æ²’æœ‰å·¥ä½œï¼Œå…ˆç¡è¦ºï¼ˆnotify is our conditionvariableï¼‰</figcaption></figure><figure><img src="/assets/%5BOS%5DChapter-6/Untitled%2034.png"alt="æœ‰äº‹æƒ…åšäº†ï¼Œæˆ–æ˜¯è¢« wake up èµ·ä¾†äº†ï¼Œå°±å¯ä»¥åšäº‹äº†ã€‚ æœ€å¾Œæ˜¯ call function pointerã€‚ï¼ˆæ³¨æ„æ˜¯è¦æ”¾åœ¨ CS å¤–é¢ï¼Œé€™æ¨£æ‰æœ‰å¹³è¡Œåº¦ï¼‰" /><figcaption aria-hidden="true">æœ‰äº‹æƒ…åšäº†ï¼Œæˆ–æ˜¯è¢« wake upèµ·ä¾†äº†ï¼Œå°±å¯ä»¥åšäº‹äº†ã€‚ æœ€å¾Œæ˜¯ call function pointerã€‚ï¼ˆæ³¨æ„æ˜¯è¦æ”¾åœ¨ CSå¤–é¢ï¼Œé€™æ¨£æ‰æœ‰å¹³è¡Œåº¦ï¼‰</figcaption></figure></li></ul><h2 id="synchronized-tools-in-java">Synchronized Tools in JAVA</h2><ul><li><p>Synchronized Methods (Monitor)</p><p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynchronizedCounter</span> &#123; </span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123; c++; &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">decrement</span><span class="params">()</span> &#123; c--; &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="type">int</span> <span class="title function_">value</span><span class="params">()</span> &#123; <span class="keyword">return</span> c; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åŠ ä¸Š synchronized å°±å¯ä»¥ä¿è­‰åªæœ‰ä¸€å€‹æ‰æ“ä½œã€‚æ‰€ä»¥å¯ä»¥çœ‹åˆ°æœ‰å‹•åˆ°<code>c</code> çš„éƒ½æœ‰åŠ ã€‚å¦‚æœæ²’æœ‰å‹•åˆ° share dataçš„ï¼Œå¯ä»¥ä¸ç”¨åŠ ï¼Œå¢åŠ å¹³è¡Œåº¦ã€‚</p></li><li><p>Synchronized Statement (Mutex Lock)</p><p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">synchronized</span>(p1)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">10</span>; <span class="comment">// statement without locking requirement</span></span><br><span class="line">p1.display(s1);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></li></ul><h2 id="review-slides-4">Review Slides (4)</h2><ul><li>Bounded-buffer problem?</li><li>Reader-Writer problem?</li><li>Dining Philosopher problem?</li><li>What is monitor and why need monitor?</li></ul><h1 id="atomic-transactions">Atomic Transactions</h1><p>ï¼ˆè€ƒè©¦ä¸å¤ªæœƒæï¼‰</p><ul><li>System Model<ul><li>Transaction: ä¸€ç³»åˆ—çš„ operation</li><li>Atomic Transaction: éœ€è¦ä¸€æ¬¡å®Œæˆ transactionï¼Œall or nothing</li><li>DB å¾ˆå®¹æ˜“éœ€è¦</li></ul></li><li>File I/O Example<ul><li>Transaction æ˜¯ä¸€é€£ä¸²çš„ read and write</li><li>åƒæ˜¯ version control çš„å·¥å…·ï¼Œéœ€è¦æœ‰ commitï¼ˆæˆåŠŸï¼‰ã€abortï¼ˆå¤±æ•—ï¼‰ã€rolled backï¼ˆå¤±æ•—å¾Œè¦ undoï¼‰</li><li>æ‰€ä»¥é‡é»æ˜¯è¦æœ‰ log<ul><li>å› ç‚ºæœ‰ log æ‰èƒ½å›æ¨é‡å»º</li><li>ä¹Ÿå«åš checkpoint</li><li>å­˜åœ¨ secondary storage</li></ul></li><li>ä¹Ÿæœƒæœ‰ checkpoints<ul><li>é‚„åŸé»ï¼Œä¸Šä¸€å€‹ commit çš„é»</li><li>èªªä¸å®šæœƒç›´æ¥ä¸ undoï¼Œç„¶å¾Œ apply checkpoint</li></ul></li></ul></li></ul><h2 id="review-slides-5">Review Slides (5)</h2><ul><li>What is atomic transaction?</li><li>Purpose of commit, abort, rolled-back?</li><li>How to use log and checkpoints?</li></ul><h1 id="textbook-problem-set">Textbook Problem Set</h1><p><img src="/assets/%5BOS%5DChapter-6/Untitled%2035.png" /></p><p><img src="/assets/%5BOS%5DChapter-6/Untitled%2036.png" /></p><div class="note warning"><p>æ­¤ç­†è¨˜ç‚ºæ¸…è¯å¤§å­¸å‘¨å¿—é æ•™æˆä½œæ¥­ç³»çµ±ä¹‹èª²å ‚ç­†è¨˜ï¼Œæ‰€æœ‰å…§å®¹åŠåœ–ç‰‡çš†å–ææ–¼èª²å ‚å…§å®¹ã€‚<br />å¦‚å…§å®¹æœ‰èª¤ï¼Œæ­¡è¿ä¾†ä¿¡ <ahref="mailto:mail@arui.dev">mail@arui.dev</a>ã€‚</p></div>]]></content:encoded>
      
      
      <category domain="https://blog.arui.dev/categories/Operating-System-Notes/">Operating System Notes</category>
      
      
      <category domain="https://blog.arui.dev/tags/Operating-System/">Operating System</category>
      
      <category domain="https://blog.arui.dev/tags/Notes/">Notes</category>
      
      
      <comments>https://blog.arui.dev/[OS]Chapter-6/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[OS] Chapter 5 â€” Process Scheduling</title>
      <link>https://blog.arui.dev/[OS]Chapter-5/</link>
      <guid>https://blog.arui.dev/[OS]Chapter-5/</guid>
      <pubDate>Mon, 31 Jan 2022 10:05:24 GMT</pubDate>
      
      <description>&lt;div class=&quot;note default&quot;&gt;&lt;p&gt;&lt;a
href=&quot;https://arui-tw.notion.site/Chapter-5-Process-Scheduling-ade82d3c9cb94423b787100fbce02fd1&quot;&gt;Notion
å¥½è®€ç‰ˆ&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;h1 id=&quot;basic-concepts&quot;&gt;Basic Concepts&lt;/h1&gt;
&lt;p&gt;å› ç‚º multiprogramming æ‰€ä»¥æ‰è¦ schedulingã€‚&lt;/p&gt;
&lt;h2 id=&quot;cpu-io-burst-cycle&quot;&gt;CPU-I/O burst cycle&lt;/h2&gt;
&lt;p&gt;â†’ æ±è¥¿è¦å˜›åœ¨ CPU è¦å˜›åœ¨ I/O&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/assets/%5BOS%5DChapter-5/Untitled.png&quot; /&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;æ‰€ä»¥æ¯ä¸€å€‹ process å°±åˆ‡æˆåœ¨ CPU burst å’Œåœ¨ I/O burst&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;I/O-bound program â†’ å¤§éƒ¨åˆ†åœ¨åš I/O&lt;/p&gt;
&lt;p&gt;â‡’ ä¸ç­‰æ–¼ I/O burst çš„ cycle æ•¸æ¯” CPU
å¤šï¼ˆæ•¸é‡æ‡‰è©²è¦æ˜¯ä¸€æ¨£çš„ï¼Œå› ç‚ºä¸€å€‹åšå®Œæ¥å¦ä¸€å€‹ï¼‰ï¼Œæ‡‰è©²è¦æ˜¯ä¸€å€‹ burst
è¦å¾ˆä¹…ã€‚&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;CPU-bound program â†’ å¤§éƒ¨åˆ†åœ¨åš CPU&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;CPU å¤§å¤šæ˜¯çŸ­çš„ burst å¾ˆå¤š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/assets/%5BOS%5DChapter-5/Untitled%201.png&quot; /&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;cpu-scheduler&quot;&gt;CPU Scheduler&lt;/h2&gt;
&lt;p&gt;Ready state â†’ Running state&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/assets/%5BOS%5DChapter-5/Untitled%202.png&quot; /&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹é¢éƒ½å‡è¨­æ˜¯ single coreï¼Œåªæœ‰å–®ä¸€éš»ç¨‹å¼&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<div class="note default"><p><ahref="https://arui-tw.notion.site/Chapter-5-Process-Scheduling-ade82d3c9cb94423b787100fbce02fd1">Notionå¥½è®€ç‰ˆ</a></p></div><h1 id="basic-concepts">Basic Concepts</h1><p>å› ç‚º multiprogramming æ‰€ä»¥æ‰è¦ schedulingã€‚</p><h2 id="cpu-io-burst-cycle">CPU-I/O burst cycle</h2><p>â†’ æ±è¥¿è¦å˜›åœ¨ CPU è¦å˜›åœ¨ I/O</p><p><img src="/assets/%5BOS%5DChapter-5/Untitled.png" /></p><ul><li><p>æ‰€ä»¥æ¯ä¸€å€‹ process å°±åˆ‡æˆåœ¨ CPU burst å’Œåœ¨ I/O burst</p></li><li><p>I/O-bound program â†’ å¤§éƒ¨åˆ†åœ¨åš I/O</p><p>â‡’ ä¸ç­‰æ–¼ I/O burst çš„ cycle æ•¸æ¯” CPUå¤šï¼ˆæ•¸é‡æ‡‰è©²è¦æ˜¯ä¸€æ¨£çš„ï¼Œå› ç‚ºä¸€å€‹åšå®Œæ¥å¦ä¸€å€‹ï¼‰ï¼Œæ‡‰è©²è¦æ˜¯ä¸€å€‹ burstè¦å¾ˆä¹…ã€‚</p></li><li><p>CPU-bound program â†’ å¤§éƒ¨åˆ†åœ¨åš CPU</p></li><li><p>CPU å¤§å¤šæ˜¯çŸ­çš„ burst å¾ˆå¤š</p><p><img src="/assets/%5BOS%5DChapter-5/Untitled%201.png" /></p></li></ul><h2 id="cpu-scheduler">CPU Scheduler</h2><p>Ready state â†’ Running state</p><p><img src="/assets/%5BOS%5DChapter-5/Untitled%202.png" /></p><p>ä¸‹é¢éƒ½å‡è¨­æ˜¯ single coreï¼Œåªæœ‰å–®ä¸€éš»ç¨‹å¼</p><span id="more"></span><h3 id="preemptive-vs.-non-preemptive">Preemptive vs.Non-preemptive</h3><ul><li>Preemptive â†’ ä¸€å€‹ process å¯ä»¥åœ¨ CPU burst ä¸­é–“è¢«æ‰“æ–·</li><li>Non-preemptive â†’ ä¸€å€‹ process ä¸èƒ½åœ¨ CPU burstä¸­é–“è¢«æ‰“æ–·ï¼Œä¸€å®šè¦åšå®Œçš„</li><li>CPU scheduling è¦åšäº‹çš„æ™‚é–“é»ï¼š<ol type="1"><li><font color=#A865C9>A process switch from running to waiting â†’ CPUç©ºä¸‹ä¾†äº†ï¼Œå¯ä»¥åŠ æ±è¥¿å›‰</font></li><li>A process switch from running to readyï¼ˆå¯èƒ½æ˜¯ timeråˆ°äº†ï¼Œæ‰€ä»¥è¢«ä¸Ÿéå»äº†ï¼‰â†’ CPU ç©ºä¸‹ä¾†äº†ï¼Œå¯ä»¥åŠ æ±è¥¿å›‰</li><li>A process switch from waiting to ready â†’ çœ‹çœ‹æœ‰æ²’æœ‰æ›´é‡è¦ï¼Œéœ€è¦å°±æŠŠrunning çš„æ‹¿æ‰æ›ä»–</li><li><font color=#A865C9>A process terminates â†’ CPUç©ºä¸‹ä¾†äº†ï¼Œå¯ä»¥åŠ æ±è¥¿å›‰</font></li></ol><ul><li>ç´«è‰²æ˜¯ Non-preemptive çš„ scheduler åªèƒ½åšçš„äº‹</li></ul></li><li>å¤§éƒ¨åˆ†éƒ½æ˜¯ preemptiveã€‚ï¼ˆWindows, Mac OSï¼‰</li><li>Preemptive issue<ul><li>æœƒæ‰“æ–·æ±è¥¿ï¼Œæ‰€ä»¥å¯èƒ½æœƒ raise conditionï¼ˆå¦‚æœä¸æ‰“æ–·å°±ä¸æœƒç”¢ç”Ÿï¼‰</li><li>æœƒå½±éŸ¿åˆ° OS éœ€ä¸éœ€è¦è™•ç† synchronisation çš„å•é¡Œ</li><li>Unix solution: é€²åˆ° kernel space å°± disable 2 å’Œ 3ï¼ˆå°±æœƒè®Šæˆnon-preemptiveï¼‰</li></ul></li></ul><h2 id="dispatcher">Dispatcher</h2><ul><li>æŠŠ scheduler é¸å‡ºä¾†çš„æ±è¥¿ä¸Ÿåˆ° CPU è£¡é¢çš„è‹¦å·¥ã€‚ï¼ˆSwitchingcontext...ï¼‰</li><li>è¦å¾ˆæœ‰æ•ˆç‡</li></ul><h1 id="scheduling-algorithms">Scheduling Algorithms</h1><ul><li>Scheduling Criteria â†’ å®šç¾©æ•ˆèƒ½çš„æŒ‡æ¨™<ul><li>CPU utilization<ul><li>0% ~ 100% (per core)</li><li>é€šå¸¸å¤§æ¦‚æœƒåœ¨ 40% ~ 90% ä¹‹é–“</li></ul></li><li>Throughput<ul><li>æ¯å–®ä½æ™‚é–“å¯ä»¥å®Œæˆå¤šå°‘å·¥ä½œï¼ˆprocessesï¼‰</li><li>High throughput computer system â†’ ç›®æ¨™å°±æ˜¯è¦æœ€å¤§åŒ– through çš„computer system</li><li>å¾ˆå¸¸è¦‹ï¼Œæ¯” utilization é‡è¦ï¼ˆå° user ä¾†è¬›æ¯”è¼ƒæœ‰æ„Ÿè¦ºï¼‰</li></ul></li><li>Turnaround time<ul><li>å–®ä¸€ process çš„è§’åº¦ä¾†é‡æ¸¬</li><li>é€²åˆ° new åˆ° terminate çš„æ™‚é–“ï¼ˆsubmission ~ completionï¼‰</li><li>é€šå¸¸æœƒçœ‹å¹³å‡ã€æœ€å¤§å€¼ã€æœ€å°å€¼ã€distribution ç­‰ç­‰</li></ul></li><li>Waiting time<ul><li>åœ¨ ready queue çš„ç¸½æ™‚é–“ï¼ˆä¸åŒ…æ‹¬ waiting timeï¼‰</li><li>æ˜¯ç´”ç²¹å› ç‚º scheduling çš„åŸå› æ‰€ä»¥ä¸èƒ½åŸ·è¡Œ</li></ul></li><li>Response time<ul><li>new åˆ°ç¬¬ä¸€æ¬¡å›æ‡‰ï¼ˆç¬¬ä¸€æ¬¡é€²åˆ° runningï¼‰</li></ul></li></ul></li></ul><h2 id="first-come-first-served-fcfs-scheduling">First-Come,First-Served (FCFS) scheduling</h2><p>å…ˆä¾†å…ˆæ’</p><p>æœƒçµ¦ CPU burst timeï¼Œæ ¹æ“šä»–å€‘é€²ä¾†çš„é †åº</p><ul><li><p>Example</p><ul><li>P1(24), P2(3), P3(3)</li></ul><p><img src="/assets/%5BOS%5DChapter-5/Untitled%203.png" /></p><ul><li>Waiting time: P1 = 0, P2 = 24, P3 = 27</li><li>Average Waiting Time (AWT): (0 + 24 + 27) / 3 = 17</li></ul></li><li><p>Convoy effect (Head of line blocking):å¯ä»¥å¾ˆå¿«åŸ·è¡Œçš„è¢«è¦è·‘å¾ˆä¹…çš„æ“‹ä½äº†</p></li></ul><h2 id="shortest-job-first-sjf-scheduling">Shortest-Job-First (SJF)scheduling</h2><ul><li><p>Optimal solution â†’ minimum average waiting time</p></li><li><p>æœ€çŸ­ CPU burst time çš„å…ˆåš</p></li><li><p>Two schemes</p><ol type="1"><li>Non-preemptive</li><li>Preemptive</li></ol></li><li><p>Non-preemptive example</p><p><img src="/assets/%5BOS%5DChapter-5/Untitled%204.png" /></p><p><img src="/assets/%5BOS%5DChapter-5/Untitled%205.png" /></p><p><img src="/assets/%5BOS%5DChapter-5/Untitled%206.png" /></p><p><img src="/assets/%5BOS%5DChapter-5/Untitled%207.png" /></p><p><img src="/assets/%5BOS%5DChapter-5/Untitled%208.png" /></p></li><li><p>æœ‰æ™‚å€™ ready queue æœƒæ˜¯ç©ºçš„ï¼Œé‚£ CPU å°± idleã€‚</p></li><li><p>AWT ä¸è¦ç®—åˆ° CPU idle çš„æ™‚é–“ã€‚</p></li><li><p>Preemptive example</p><p><img src="/assets/%5BOS%5DChapter-5/Untitled%209.png" /></p><figure><img src="/assets/%5BOS%5DChapter-5/Untitled%2010.png"alt="7-2 &gt; 4 â†’ content switch!  ä¸€èˆ¬çš„æ–¹å¼å¯èƒ½æ˜¯æŠŠ P1 åŠ å› Ready queue è£¡é¢ï¼Œç„¶å¾Œå†æŒ‘æœ€çŸ­çš„å‡ºä¾†" /><figcaption aria-hidden="true">7-2 &gt; 4 â†’ content switch!<br>ä¸€èˆ¬çš„æ–¹å¼å¯èƒ½æ˜¯æŠŠ P1 åŠ å› Ready queueè£¡é¢ï¼Œç„¶å¾Œå†æŒ‘æœ€çŸ­çš„å‡ºä¾†</figcaption></figure><p><img src="/assets/%5BOS%5DChapter-5/Untitled%2011.png" /></p><p><img src="/assets/%5BOS%5DChapter-5/Untitled%2012.png" /></p><p><img src="/assets/%5BOS%5DChapter-5/Untitled%2013.png" /></p><p><img src="/assets/%5BOS%5DChapter-5/Untitled%2014.png" /></p><figure><img src="/assets/%5BOS%5DChapter-5/Untitled%2015.png"alt="æ¯”ä¸Šé¢çš„æ›´çŸ­" /><figcaption aria-hidden="true">æ¯”ä¸Šé¢çš„æ›´çŸ­</figcaption></figure></li><li><p>ä½†æ˜¯å› ç‚ºæ²’æœ‰ futureknowledgeï¼Œæ‰€ä»¥å¯¦ä½œä¸å‡ºä¾†ï¼ˆæ‰€ä»¥æœƒé æ¸¬ï¼Œä½†æ˜¯å¤±æº–å°± GGï¼‰</p><ul><li><p>Approximate SJF: time series,ç”¨æ­·å²å’Œä¸Šæ¬¡çš„çµæœå»èª¿æ•´æ¯”ä¾‹ä¾†ç®—</p><p><span class="math display">\[  \tau_{n+1}=\alpha t_n+(1-\alpha)\tau_n  \]</span></p><ul><li><p><span class="math inline">\(\tau\)</span> is the history and<span class="math inline">\(t\)</span> is the new one</p></li><li><p><span class="math inline">\(\alpha\)</span> usually set as <spanclass="math inline">\(1/2\)</span></p></li><li><p>Example</p><p><img src="/assets/%5BOS%5DChapter-5/Untitled%2016.png" /></p><p>We guess 10 for the first time.</p></li></ul></li></ul></li></ul><h2 id="priority-scheduling">Priority Scheduling</h2><ul><li>æ¯å€‹ process å°±æœ‰ä¸€å€‹ priorityçš„å€¼ï¼ˆè¦æ€éº¼æ±ºå®šï¼Œå•¥æ™‚æ±ºå®šï¼Œéƒ½å¯ä»¥ï¼‰ï¼Œç„¶å¾Œå°±ç…§é‚£å€‹æ±ºå®š</li><li>æœ€ general çš„ï¼Œä¸Šé¢çš„å…©å€‹ä¹Ÿå¯ä»¥èªªæ˜¯ priority scheduling</li><li>Problem:<ul><li>Starvation: å¯èƒ½æœ‰ process æœƒæ°¸é æ²’æœ‰æ’ç¨‹åˆ°<ul><li>Solution: aging â†’ ç­‰è¶Šä¹…ï¼Œpriority è¶Šé«˜</li></ul></li></ul></li></ul><h2 id="round-robin-rr-scheduling">Round-Robin (RR) Scheduling</h2><ul><li><p>æ¯ä¸€å€‹ process éƒ½åªèƒ½åŸ·è¡Œä¸€å®šçš„æ™‚é–“ï¼ˆa.k.a time quantum, usually10 ~ 100 msï¼‰ï¼Œæ™‚é–“åˆ°å°±è¢«è¸¢å‡ºä¾†é‡æ–°æ’éšŠ</p></li><li><p>å®¹æ˜“å¯¦ä½œï¼Œå…¬å¹³</p></li><li><p>Performance</p><ul><li>TQ too large â†’ FIFO (FCFS)<ul><li>å¦‚æœä¸åœ¨ä¹ fairnessï¼Œé‚£é€™æ¨£ä¹Ÿ OK</li></ul></li><li>TQ too small â†’ (context switch) overhead increase<ul><li>å¦‚æœ CPU æ²’ä»€éº¼äººåœ¨ç”¨ï¼Œé‚£é€™æ¨£ä¹Ÿ OK</li></ul></li><li>æ‰€ä»¥å°±çœ‹ç³»çµ±éœ€æ±‚</li></ul></li><li><p>Example</p><p><img src="/assets/%5BOS%5DChapter-5/Untitled%2017.png" /></p></li><li><p>Response time é€šå¸¸æœƒæ˜¯æœ€å°çš„ï¼Œä½†æ˜¯ turn around timeé€šå¸¸æœƒå¾ˆå¤§</p></li></ul><h2 id="multilevel-queue-scheduling">Multilevel Queue Scheduling</h2><ul><li><p>ä¸Šé¢éƒ½æ˜¯ single queue</p></li><li><p>ç¾åœ¨é€™å€‹æœ‰å¾ˆå¤š ready queueï¼Œä¸€å€‹ process åªæœƒé€²åˆ°å…¶ä¸­ä¸€å€‹queue</p><p><img src="/assets/%5BOS%5DChapter-5/Untitled%2018.png" /></p></li><li><p>æ¯ä¸€å€‹å–®ä¸€ queueéƒ½å¯ä»¥ç”¨ä¸Šé¢é‚£äº›è§£æ³•ï¼Œæˆ‘å€‘ç¾åœ¨è¦è§£æ±ºçš„æ˜¯æ€éº¼å¾é€™éº¼å¤š queue ä¸­æŒ‘å“ªä¸€å€‹queue ä¾† deqeue</p><ul><li>Fixed priority scheduling: æ ¹æ“š queue çš„ priority é–‹å§‹æŒ‘<ul><li>ä¸€æ¨£æœƒæœ‰ starvation â†’ æœ€ä¸Šé¢ä¸€å®šè¦æ¸…å®Œæ‰èƒ½ä½œä¸‹é¢çš„ï¼Œæœ€ä¸‹é¢çš„ queueå¯èƒ½æœƒæ’ä¸åˆ°</li></ul></li><li>Time slice: æ¯ä¸€å€‹ queue æœƒæœ‰å„è‡ªè¢«é¸ä¸­çš„æ©Ÿç‡ï¼Œé¸ä¸­å°±å¾é‚£é‚Šdequeue</li></ul></li><li><p>æˆ‘å€‘è¦æ±ºå®šå“ªä¸€å€‹ process è¦åŠ åˆ°å“ªå€‹ queueï¼Œä½†æ˜¯è¦åœ¨ <strong>runä¹‹å‰</strong>å°±åšæ±ºå®šï¼Œä¸”åŠ é€²å»å°±æœƒä¸€ç›´å¾…åœ¨è£¡é¢ï¼Œæ‰€ä»¥å¯èƒ½æœƒæ±è¥¿ä½œä¸€ä½œå°±è®Šæˆä¸æ‡‰è©²åœ¨é‚£å€‹queue çš„ï¼Œé€™æ¨£ä¸å¥½ã€‚æ‰€ä»¥æœ‰ä¸‹é¢çš„ï¼š</p></li></ul><h2 id="multilevel-feedback-queue-scheduling">Multilevel Feedback QueueScheduling</h2><ul><li><p>Queues ä¸æœƒåˆ†æ˜¯è¦ä½œå“ªç¨® processï¼Œæ‰€ä»¥ process å¯ä»¥åœ¨ queuesä¸­ç§»å‹•ã€‚ï¼ˆæ‰€ä»¥å« feedbackï¼‰</p></li><li><p>æ‰€ä»¥ Higher level ä¸€å®šéƒ½æœƒå…ˆè¢«åŸ·è¡Œï¼ˆå¯ä»¥ä½œ aging to preventstarvationï¼‰</p></li><li><p>æ‰€ä»¥æˆ‘å€‘è¦åšçš„äº‹æƒ…å°±è®Šæˆè¦æ±ºå®šèª°æœƒç§»åˆ°å“ªå€‹queueï¼ˆè·Ÿä¸Šé¢è¦åšçš„äº‹å®Œå…¨ä¸åŒï¼‰</p></li><li><p>å¹¾ä¹éƒ½æ˜¯æ ¹æ“š I/O çš„æ™‚é–“ä¾†æ’ï¼Œi.e. <strong>I/O-boundçš„ç¨‹å¼æœƒæ”¾åˆ°ä¸Šé¢çš„ queueã€‚</strong>ï¼ˆå› ç‚ºé€šå¸¸ I/O-bound çš„ç¨‹å¼ CPUé€šå¸¸æœƒè·‘æ¯”è¼ƒå¿«ï¼‰</p></li><li><p>Example</p><ul><li>ç§»å‹•æ¢ä»¶ï¼šå¦‚æœè¶…é TQï¼Œå°±å¾€å¾Œè¸¢</li></ul><p><img src="/assets/%5BOS%5DChapter-5/Untitled%2019.png" /></p><p><img src="/assets/%5BOS%5DChapter-5/Untitled%2020.png" /></p></li><li><p>æ‰€ä»¥æˆ‘å€‘éœ€è¦æ±ºå®š</p><ul><li>æœ‰å¹¾å€‹ queues</li><li>æ¯å€‹ queue ç”¨å“ªç¨® single queue çš„æ¼”ç®—æ³•</li><li>ä»€éº¼æ™‚å€™ process è¦ç§»å‹•</li></ul></li></ul><h2 id="evaluation-methods">Evaluation Methods</h2><ul><li>Deterministic modeling â€” Given å·²çŸ¥ä¸”å›ºå®šçš„inputï¼Œå»æ¯”è¼ƒå„å€‹æ–¹å¼ï¼ˆè¶…æ²’ç”¨ï¼Œé€šå¸¸ç•¶ä¾‹å­ç”¨ï¼‰</li><li>Queueing model â€” ç”¨æ•¸å­¸ï¼ˆQueuetheoryï¼‰å»ç®—ï¼ˆä¸æ˜¯å¾ˆæº–ï¼Œåå‘ç†è«–ï¼‰</li><li>Simulation â€” æ¨¡æ“¬ç„¶å¾Œå¾—åˆ°çµæœï¼ˆé€™åªæœ‰éƒ¨åˆ†åŠŸèƒ½ï¼‰</li><li>Implementation â€” å°±å¯¦ä½œå‡ºä¾†ï¼ˆé€™å·²ç¶“å®Œæ•´äº†ï¼‰</li></ul><h2 id="review-slide-i">Review Slide (I)</h2><ul><li>Preemptive scheduling vs Non-preemptive scheduling?</li><li>Issues of preemptive scheduling</li><li>Turnaround time? Waiting time? Response time? Throughput?</li><li>Scheduling algorithms<ul><li>FCFS</li><li>Preemptive SJF, Nonpreemptive SJF</li><li>Priority scheduling</li><li>RR</li><li>Multilevel queue</li><li>Multilevel feedback queue</li></ul></li></ul><h1 id="special-scheduling-issues">Special Scheduling Issues</h1><h2 id="multi-processor-scheduling">Multi-Processor Scheduling</h2><ul><li>ç¡¬é«”æœƒè·Ÿ scheduler è¬›èªªä»–éœ€è¦å¤šå°‘ï¼Œå°±æ‹¿çµ¦ä»–</li><li>Asymmetric multiprocessing<ul><li>æœƒæœ‰ä¸€å€‹ centralise çš„å‚¢ä¼™åœ¨è™•ç†èª°è¦å»å“ª</li><li>å°±æ²’æœ‰ synchronise çš„å•é¡Œ</li><li>ä½†æ˜¯æœƒæµªè²»ä¸€å€‹ core åœ¨è™•ç†</li></ul></li><li>Symmetric multiprocessing (SMP)<ul><li>ç›´æ¥é–‹æ¶ï¼Œæ‰€ä»¥éœ€è¦ lock ä¾†è™•ç† synchronise çš„å•é¡Œ</li></ul></li></ul><h3 id="processor-affinity">Processor affinity</h3><p>æŠŠ process ç¶åœ¨ä¸€å€‹ CPU ä¸Šï¼ˆä¸åŒ CPU burst å¯èƒ½æœƒåœ¨ä¸åŒ coreä¸Šï¼‰ï¼ˆæ˜¯ç‚ºäº†è¦è™•ç†è³‡æ–™åœ¨æ› core çš„æ™‚å€™è³‡æ–™è¦é‡æ–° cacheï¼‰</p><ul><li>Type:<ul><li>soft affinity<ul><li>å¦‚æœæœ‰ç©ºçš„ï¼Œå°±é‚„æ˜¯æœƒå»ç”¨</li></ul></li><li>Hard affinity<ul><li>å°±ç®—æœ‰ç©ºçš„ï¼Œ ä¹Ÿä¸æœƒç”¨</li></ul></li></ul></li><li>å¦‚æœç³»çµ±çš„ loading æ²’æœ‰å¾ˆé«˜ï¼Œé€™æ˜¯ä¸€å®šæœ‰å¥½è™•æ²’å£è™•çš„ï¼Œä½†æ˜¯å¦‚æœå¾ˆå¤šprocess åœ¨æ¶ coreï¼Œé‚£é€™å°±æ²’å•¥ç”¨äº†ã€‚</li></ul><h3 id="numa-and-cpu-scheduling">NUMA and CPU Scheduling</h3><ul><li>NUMA (non-uniform memory access)<ul><li>æœ‰äº› CPU é›¢æŸäº› memory æ¯”è¼ƒè¿‘ï¼Œæ‰€ä»¥é‚„è¦æŠŠ process æ”¾åˆ°é›¢ CPUæ¯”è¼ƒè¿‘çš„ memory</li></ul></li></ul><h3 id="load-balancing">Load-balancing</h3><ul><li><p>Push Migration â€” æŠŠå·¥ä½œæ¨å‡ºå»ï¼Œå¦‚æœ loadingè¼•ï¼Œå°±ç”¨é€™å€‹å»ä¸Ÿå·¥ä½œ</p></li><li><p>Pull Migration â€” æŠŠå·¥ä½œæ‹‰é€²ä¾†ï¼Œå¦‚æœ loadingé‡ï¼Œå°±ç”¨é€™å€‹å»ä¸Ÿå·¥ä½œ</p><p>Load balancing often counteracts the benefits of processor affinity(355)</p></li></ul><h2 id="multi-core-processor-scheduling">Multi-Core ProcessorScheduling</h2><ul><li><p>Multi-core Processor â€” memory stall: éœ€è¦ç­‰ access memoryçš„æ™‚é–“</p></li><li><p>Multi-threaded multi-core systems</p><ul><li>æŠŠä¸Šé¢ç­‰ memory access çš„æ™‚é–“æ‹¿ä¾†åšäº‹</li></ul><p><img src="/assets/%5BOS%5DChapter-5/Untitled%2021.png" /></p><ul><li>Two ways:<ol type="1"><li>fine-grained: æŠŠæ‰€æœ‰ stageçš„æ±è¥¿éƒ½è¨˜ä¸‹ä¾†ï¼Œæ‰€ä»¥æ±è¥¿ä¸æœƒæ‰ã€‚ä½†æ˜¯å°±éœ€è¦å¾ˆå¤šç¡¬é«”è³‡æºå»è¨˜ã€‚ï¼ˆå¿«ï¼Œæˆæœ¬é«˜ï¼‰</li><li>coarse-grained: æœƒ flush ä¸ç”¨çš„æ±è¥¿</li></ol></li></ul></li><li><p>Scheduling for Multi-threaded multi-core systems</p><ul><li>Hardware è·Ÿ software èªªè¦å¹¾å€‹ processï¼Œç„¶å¾Œ software å°±çµ¦ä»–</li><li>è¦æ€éº¼å»è™•ç†è¦ä¾†çš„ processï¼ˆåŸ·è¡Œåœ¨å“ªå€‹ coreï¼‰å°±çµ¦ hardware æ±ºå®š</li></ul></li></ul><h2 id="real-time-scheduling">Real-Time Scheduling</h2><p>Real-time does not mean speed, but keeping deadlines</p><ul><li>Soft real-time â€” å¸Œæœ›å¯ä»¥ä¸è¦ miss deadlineï¼Œä½†æ˜¯ missä¹Ÿä¸æœƒç‚¸é–‹</li><li>Hard real-time â€” çµ•å°ä¸èƒ½ miss deadline</li></ul><h3 id="real-time-scheduling-algorithms">Real-Time SchedulingAlgorithms</h3><p>æ¯”å‰é¢å¤šäº† period çš„åƒæ•¸ â†’æ¯éå¤šä¹…å°±æœƒé‡æ–°å‡ºç¾ï¼Œè¦åœ¨ä¸‹ä¸€æ¬¡å‡ºç¾å‰åšå®Œé€™æ¬¡çš„ã€‚ï¼ˆE.g., (0, 4, 10) â†’0ï¼Œ10ï¼Œ20 éƒ½æœƒå‡ºç¾ä¸€æ¬¡ï¼‰</p><ul><li>FCFS â€” Non-RTS</li><li>Rate-Monotonic (RM) Scheduling<ul><li><p>Static (Fixed) â†’ è·‘å¾—æ™‚å€™ä¸æœƒæ”¹è®Š</p></li><li><p>Shortest period first</p></li><li><p>Example</p><p><img src="/assets/%5BOS%5DChapter-5/Untitled%2022.png" /></p></li></ul></li><li>Earliest-Deadline-First (EDF) algorithm<ul><li><p>Dynamic â†’ è·‘å¾—æ™‚å€™ï¼Œæ¯ä¸€å€‹çš„ priority æœƒè®Šå‹•ï¼ˆå› ç‚ºé›¢ deadlineçš„æ™‚é–“æœƒè®Šè¿‘ï¼‰</p></li><li><p>Early deadline first</p></li><li><p>Miss deadline æœƒè¢« bound ä½</p></li><li><p>Example</p><p><img src="/assets/%5BOS%5DChapter-5/Untitled%2023.png" /></p></li></ul></li></ul><h2 id="review-slide-ii">Review Slide (II)</h2><ul><li>What is Processor affinity?</li><li>Real-time scheduler<ul><li>Rate-Monotonic</li><li>Earliest deadline first</li></ul></li></ul><h1 id="scheduling-case-study">Scheduling Case Study</h1><h2 id="solaris">Solaris</h2><ul><li>Priority-based multilevel feedback queue scheduling</li><li>å…­å€‹ class â€” æ›´åƒæ˜¯å…­å€‹queueï¼Œåæ­£æœ€ä¸Šé¢çš„ä¸€å®šæœƒå…ˆåšã€‚è£¡é¢å°çš„æœƒå†è‡ªå·±æ’åº</li></ul><p><img src="/assets/%5BOS%5DChapter-5/Untitled%2024.png" /></p><ul><li>Example<ul><li>the <strong>higher</strong> the priority, the<strong>smaller</strong> the time sliceï¼ˆå› ç‚ºæˆ‘å€‘å¸Œæœ› priority é«˜çš„ï¼ŒCPUburst time æ˜¯çŸ­çš„ï¼Œæ‰€ä»¥å¾ˆå¿«æ¶åˆ°å°±è¦å¾ˆå¿«æ”¾æ‰ï¼‰<ul><li>Time quantum expired: åªè¦ä½¿ç”¨è¶…éä½ çš„ timesliceï¼Œå°±æ ¹æ“šä¸‹è¡¨èª¿æ•´ä½ çš„ priorityã€‚ï¼ˆå› ç‚ºæ„Ÿè¦ºä½ æ˜¯æ›´ CPU burst çš„ï¼‰</li><li>Return from sleep: å¾ sleep (i.e. I/O wait) å›ä¾†å°±æå‡priorityã€‚ï¼ˆå› ç‚ºå¯ä»¥ç¸®çŸ­ç­‰å¾…æ™‚é–“ï¼‰</li></ul><img src="/assets/%5BOS%5DChapter-5/Untitled%2025.png" /></li></ul></li></ul><h2 id="windows">Windows</h2><p>è·Ÿå‰›å‰›çš„å·®ä¸å¤š</p><p><img src="/assets/%5BOS%5DChapter-5/Untitled%2026.png" /></p><h2 id="linux">Linux</h2><ul><li><p>å€¼è¶Šå°ï¼Œpriority è¶Šé«˜</p></li><li><p>åˆ†æˆå…©å€‹ class è€Œå·²</p></li><li><p>Priority é«˜çš„ï¼Œåˆ†åˆ°çš„ time quantum è¶Šå¤§</p><p>â‡’ å› ç‚ºé€™é‚Šçš„ time quantum æ˜¯ budget çš„æ¦‚å¿µï¼Œåªè¦ç”¨å®Œå°±æœƒè¢«ä¸Ÿåˆ°waiting queue</p></li><li><p>æ‰€ä»¥ä»–æ˜¯ç”¨æ¯”è¼ƒ fairness çš„ä½œæ³•</p></li></ul><p><img src="/assets/%5BOS%5DChapter-5/Untitled%2027.png" /></p><ul><li>Algorithm<ul><li>ä¸€é–‹å§‹å¤§å®¶éƒ½åœ¨ active arrayï¼Œç„¶å¾Œæ™‚é–“åˆ°å°±è¢«ä¸Ÿåˆ° expiredarrayã€‚ï¼ˆé€™æ¨£å°±ç®—æ˜¯ low priority çš„ä¹Ÿå¯ä»¥è¢«åšåˆ°ï¼‰</li><li>æœ€å¾Œ active array è¢«æ¸…ç©ºäº†å°±æŠŠå…©å€‹ array çš„æŒ‡æ¨™å°èª¿ã€‚</li><li>æ‰€ä»¥ä»–æ˜¯ä¸€è¼ªä¸€è¼ªçš„åšã€‚</li></ul><img src="/assets/%5BOS%5DChapter-5/Untitled%2028.png" /></li></ul><h1 id="textbook-questions">Textbook Questions</h1><p><img src="/assets/%5BOS%5DChapter-5/Untitled%2029.png" /></p><h1 id="qa">QA</h1><ul><li>What is CPU-burst?<ul><li>ç¨‹å¼æ­£åœ¨åš CPU çš„ instructionï¼Œé™¤æ­¤ä¹‹å¤–çš„æ™‚é–“éƒ½æ˜¯ I/O-burst</li></ul></li><li>Preemptive vs. Non-preemptive?<ul><li>Preemptiveï¼šåœ¨ CPU burst é–“ scheduler å¯ä»¥ interrupt åš schedulingçš„å‹•ä½œ</li><li>Non-preemptiveï¼šåœ¨ CPU burst é–“ scheduler ä¸èƒ½ interrupt åšscheduling çš„å‹•ä½œï¼ˆä½†æ˜¯ hardware é‚„æ˜¯å¯ä»¥ interrupt çš„ï¼‰</li></ul></li></ul><div class="note warning"><p>æ­¤ç­†è¨˜ç‚ºæ¸…è¯å¤§å­¸å‘¨å¿—é æ•™æˆä½œæ¥­ç³»çµ±ä¹‹èª²å ‚ç­†è¨˜ï¼Œæ‰€æœ‰å…§å®¹åŠåœ–ç‰‡çš†å–ææ–¼èª²å ‚å…§å®¹ã€‚<br />å¦‚å…§å®¹æœ‰èª¤ï¼Œæ­¡è¿ä¾†ä¿¡ <ahref="mailto:mail@arui.dev">mail@arui.dev</a>ã€‚</p></div>]]></content:encoded>
      
      
      <category domain="https://blog.arui.dev/categories/Operating-System-Notes/">Operating System Notes</category>
      
      
      <category domain="https://blog.arui.dev/tags/Operating-System/">Operating System</category>
      
      <category domain="https://blog.arui.dev/tags/Notes/">Notes</category>
      
      
      <comments>https://blog.arui.dev/[OS]Chapter-5/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>WebSocket</title>
      <link>https://blog.arui.dev/WebSocket/</link>
      <guid>https://blog.arui.dev/WebSocket/</guid>
      <pubDate>Wed, 12 May 2021 09:50:24 GMT</pubDate>
      
      <description>&lt;div class=&quot;note default&quot;&gt;&lt;p&gt;&lt;a
href=&quot;https://arui-tw.notion.site/WebSocket-4aae9807cbc94e69b3e91fe69c58262b&quot;&gt;Notion
å¥½è®€ç‰ˆ&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;ç¶²è·¯æºé€šå¯ä»¥åˆ†æˆå…©ç¨®ä¸»è¦çš„ API&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Web Service APIs (e.g. SOAP, JSON-RPC, XML-RPC, REST)&lt;/li&gt;
&lt;li&gt;Web Socket APIs&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;http&quot;&gt;HTTP&lt;/h1&gt;
&lt;p&gt;&lt;a
href=&quot;https://factoryhr.medium.com/http-2-the-difference-between-http-1-1-benefits-and-how-to-use-it-38094fa0e95b&quot;&gt;HTTP/2:
the difference between HTTP/1.1, benefits and how to use it&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;rest-representational-state-transfer&quot;&gt;REST (REpresentational
State Transfer)&lt;/h2&gt;
&lt;p&gt;â†’ å¹« HTTP å¥—è¦å‰‡&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GET â†’ å–å¾—è³‡æ–™&lt;/li&gt;
&lt;li&gt;PUT â†’ ä¿®æ”¹è³‡æ–™&lt;/li&gt;
&lt;li&gt;POST â†’ æ–°å¢è³‡æ–™&lt;/li&gt;
&lt;li&gt;DELETE â†’ åˆªé™¤è³‡æ–™&lt;/li&gt;
&lt;/ul&gt;</description>
      
      
      
      <content:encoded><![CDATA[<div class="note default"><p><ahref="https://arui-tw.notion.site/WebSocket-4aae9807cbc94e69b3e91fe69c58262b">Notionå¥½è®€ç‰ˆ</a></p></div><p>ç¶²è·¯æºé€šå¯ä»¥åˆ†æˆå…©ç¨®ä¸»è¦çš„ API</p><ul><li>Web Service APIs (e.g. SOAP, JSON-RPC, XML-RPC, REST)</li><li>Web Socket APIs</li></ul><h1 id="http">HTTP</h1><p><ahref="https://factoryhr.medium.com/http-2-the-difference-between-http-1-1-benefits-and-how-to-use-it-38094fa0e95b">HTTP/2:the difference between HTTP/1.1, benefits and how to use it</a></p><h2 id="rest-representational-state-transfer">REST (REpresentationalState Transfer)</h2><p>â†’ å¹« HTTP å¥—è¦å‰‡</p><ul><li>GET â†’ å–å¾—è³‡æ–™</li><li>PUT â†’ ä¿®æ”¹è³‡æ–™</li><li>POST â†’ æ–°å¢è³‡æ–™</li><li>DELETE â†’ åˆªé™¤è³‡æ–™</li></ul><span id="more"></span><h2 id="http-pollingè¼ªè©¢">HTTP polling(è¼ªè©¢)</h2><p>å¯ä»¥ç”¨å…”å­ï¼ˆClientï¼‰å’Œåº—è€é—†ï¼ˆServerï¼‰ä¾†æƒ³åƒã€‚</p><h3 id="http-short-polling">HTTP Short Polling</h3><p>éœ€è¦ä¸€ç›´å•ã€‚åƒæ˜¯å…”å­ä¸€ç›´ç«™åœ¨åº—æ—é‚Šä¸åœåœ°å•ã€Œæœ‰ç´…è˜¿è””å—ï¼Ÿã€ï¼Œæ¯å•ä¸€æ¬¡è€é—†å°±è¦å›ä»–ä¸€æ¬¡ã€Œæ²’æœ‰ã€‚ã€æˆ–æ˜¯ã€Œæœ‰ã€‚ã€è€é—†å›å®Œè©±å¾Œï¼Œå…”å­éä¸€é™£å­ä¹‹å¾Œå°±æœƒå†å•ä¸€æ¬¡ã€Œæœ‰ç´…è˜¿è””å—ï¼Ÿã€æ‰€ä»¥æ•´å€‹æµç¨‹å°±æœƒåƒï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">00:00:00 å…”å­ -&gt; æœ‰ç´…è˜¿è””å—ï¼Ÿ</span><br><span class="line">00:00:01 è€é—† -&gt; æ²’æœ‰ã€‚</span><br><span class="line">00:00:03 å…”å­ -&gt; æœ‰ç´…è˜¿è””å—ï¼Ÿ</span><br><span class="line">00:00:04 è€é—† -&gt; æ²’æœ‰ã€‚</span><br><span class="line">00:00:06 å…”å­ -&gt; æœ‰ç´…è˜¿è””å—ï¼Ÿ</span><br><span class="line">00:00:07 è€é—† -&gt; æœ‰ï¼Œæ‹¿å»ã€‚</span><br><span class="line">00:00:09 å…”å­ -&gt; æœ‰ç´…è˜¿è””å—ï¼Ÿ</span><br></pre></td></tr></table></figure><p>é€™ç¨®æ–¹æ³•é›–ç„¶ä¸æœƒå ç”¨ Client å’Œ Serveréå¤šçš„è³‡æºï¼Œä½†æ˜¯å› ç‚ºä»–æ¯éä¸€é™£å­æ‰æœƒå†é‡æ–°å•ä¸€æ¬¡ï¼Œæ‰€ä»¥ä¹Ÿä¸èƒ½æ‹¿åˆ°å³æ™‚çš„è³‡æ–™ã€‚é‚„æœ‰å°±æ˜¯åœ¨ä¾†å›å‚³è¼¸çš„éç¨‹ä¸­é‚„æ˜¯æœƒé »ç¹çš„æµªè²»ç¶²è·¯è³‡æºï¼Œé‚„æœ‰å¯èƒ½ä»€éº¼éƒ½æ²’æ‹¿åˆ°ã€‚</p><h3 id="http-long-polling">HTTP Long Polling</h3><p>é€™å€‹æ–¹æ³•å°±æ˜¯è€é—†ç”Ÿæ°£äº†ï¼Œä¸æƒ³è¦ç†å…”å­äº†ï¼Œæ‰€ä»¥ä»–æ±ºå®šç­‰åˆ°è²¨åˆ°äº†å†è·Ÿå…”å­èªªæœ‰ç´…è˜¿è””äº†ã€‚ä½†æ˜¯å¦‚éæˆ–å¤ªä¹…æ²’æœ‰åˆ°ï¼Œä¹…åˆ°ä»–éƒ½æ°£æ¶ˆäº†ï¼Œä»–é‚„æ˜¯æœƒè·Ÿå…”å­èªªã€Œæ²’æœ‰ã€ã€‚æ‰€ä»¥å°è©±æœƒè®Šæˆä¸‹é¢é€™æ¨£ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">00:00:00 å…”å­ -&gt; æœ‰ç´…è˜¿è””å—ï¼Ÿ</span><br><span class="line">00:00:10 è€é—† -&gt; æ²’æœ‰ã€‚</span><br><span class="line">00:00:10 å…”å­ -&gt; æœ‰ç´…è˜¿è””å—ï¼Ÿ</span><br><span class="line">00:00:13 è€é—† -&gt; æœ‰ï¼Œæ‹¿å»ã€‚</span><br><span class="line">00:00:13 å…”å­ -&gt; æœ‰ç´…è˜¿è””å—ï¼Ÿ</span><br></pre></td></tr></table></figure><p>é€™å€‹çš„ç¼ºé»å°±æ˜¯è€é—†å’Œå…”å­åŒæ™‚éƒ½è¢«è€½æ“±äº†ï¼Œè€é—†åœ¨ç­‰è‘—è¦å›å¾©å…”å­ï¼Œè€Œå…”å­ä¹Ÿç­‰è‘—è€é—†çš„å›è¦†ã€‚ä¹Ÿå°±æ˜¯èªªï¼Œå‰ç«¯å’Œå¾Œç«¯çš„é€šè¨ŠåŒæ™‚éƒ½è¢«å¡ä½äº†ã€‚é‚„æœ‰å¦‚æœè³‡æ–™æ›´æ–°çš„å¾ˆé »ç¹ï¼Œé€™å€‹æ–¹æ³•å°±æœƒç›¸å°çš„å¾ˆæ²’æœ‰æ•ˆç‡ï¼Œå› ç‚ºæ¯æ¬¡è€é—†éƒ½æœƒé¦¬ä¸Šå›ç­”æœ‰è²¨äº†ï¼Œè€Œä¸èƒ½ç´¯ç©å¾ˆå¤šå†ä¸€æ¬¡çµ¦å…”å­ã€‚ä½†ä»–çš„å„ªé»å°±åœ¨æ–¼é€™ç¨®æ–¹æ³•æ˜¯æ²’æœ‰å»¶é²çš„ï¼Œå› ç‚ºè€é—†ä¸€æ‹¿åˆ°è²¨å°±æœƒé¦¬ä¸Šè·Ÿå…”å­èªªæœ‰ç´…è˜¿è””ã€‚</p><h2 id="http-streaming">HTTP Streaming</h2><p>é€™æ¬¡æ›å…”å­è¦ºå¾—éº»ç…©äº†ï¼Œæ‰€ä»¥ä»–è·Ÿè€é—†èªªï¼Œæˆ‘å°±åœ¨é€™é‚Šç­‰è‘—ï¼Œåªè¦è²¨ä¸€æœ‰æƒ…æ³å°±è¦é¦¬ä¸Šè·Ÿæˆ‘èªªå–”ï¼Œç­‰æˆ‘æ‹¿å¤ äº†ï¼Œæˆ‘æœƒå†è·Ÿä½ èªªã€‚æ‰€ä»¥å°æœƒè®Šæˆé€™æ¨£ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">00:00:00 å…”å­ -&gt; æœ‰ç´…è˜¿è””å—ï¼Ÿ</span><br><span class="line">00:00:01 è€é—† -&gt; ç­‰ä¸€ä¸‹å–”ã€‚</span><br><span class="line">00:00:02 è€é—† -&gt; è²¨å¿«åˆ°äº†ã€‚</span><br><span class="line">00:00:03 è€é—† -&gt; æœ‰ï¼Œæ‹¿å»ã€‚</span><br><span class="line">00:00:03 è€é—† -&gt; æ­£åœ¨ç­‰ä¸‹ä¸€æ¬¡é€è²¨ã€‚</span><br><span class="line">00:00:04 è€é—† -&gt; è²¨å¿«åˆ°äº†ã€‚</span><br><span class="line">00:00:05 è€é—† -&gt; æœ‰ï¼Œæ‹¿å»ã€‚</span><br><span class="line">00:00:05 è€é—† -&gt; æ­£åœ¨ç­‰ä¸‹ä¸€æ¬¡é€è²¨ã€‚</span><br><span class="line">00:00:06 å…”å­ -&gt; å¤ äº†ï¼Œè¬å•¦ã€‚</span><br></pre></td></tr></table></figure><p>é€™å€‹æ–¹æ³•æœ€å¤§çš„å•é¡Œæ˜¯ç”±æ–¼ä»–æ˜¯å»ºç«‹åœ¨ HTTPå”å®šä¸Šçš„ä¸€ç¨®å‚³è¼¸æ©Ÿåˆ¶ï¼Œæ‰€ä»¥æœ‰å¯èƒ½æœƒå› ç‚ºä»£ç†ä¼ºæœå™¨ï¼ˆproxyï¼‰æˆ–é˜²ç«ç‰†ï¼ˆfirewallï¼‰å°‡å…¶ä¸­çš„è³‡æ–™å­˜æ”¾åœ¨ç·©è¡å€ä¸­ï¼Œé€ æˆè³‡æ–™å›æ‡‰ä¸Šçš„å»¶é²ã€‚</p><h3 id="sse-server-sent-events-eventsource">SSE (Server Sent Events /EventSource)</h3><p>é€™å€‹æ–¹æ³•å’Œä¸Šä¸€å€‹é¡ä¼¼ï¼Œåªæ˜¯å…”å­è¦ºå¾—è€é—†å¤ªå¤šå»¢è©±äº†ï¼Œæ‰€ä»¥ä»–è·Ÿè€é—†èªªï¼Œä¸è¦ä»€éº¼éƒ½è·Ÿæˆ‘èªªï¼Œåªè¦æœ‰è²¨å†è·Ÿæˆ‘èªªå°±å¥½äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">00:00:00 å…”å­ -&gt; æœ‰ç´…è˜¿è””å—ï¼Ÿ</span><br><span class="line">00:00:03 è€é—† -&gt; æœ‰ï¼Œæ‹¿å»ã€‚</span><br><span class="line">00:00:05 è€é—† -&gt; æœ‰ï¼Œæ‹¿å»ã€‚</span><br><span class="line">00:00:06 å…”å­ -&gt; å¤ äº†ï¼Œè¬å•¦ã€‚</span><br></pre></td></tr></table></figure><p>é€™å…©å€‹éƒ½å…±æœ‰çš„å•é¡Œ MDN ä¸Šæœ‰æåˆ°</p><blockquote><p>ç•¶é€£ç·šä¸æ˜¯é€é HTTP/2 æ™‚ï¼ŒSSEæœƒå—åˆ°æœ€å¤§é€£ç·šæ•¸é™åˆ¶æ‰€è‹¦ï¼Œå°¤å…¶ç•¶é–‹å•Ÿå¤šå€‹åˆ†é ã€‚æ¯å€‹ç€è¦½å™¨æœ‰è‡ªå·±çš„é™åˆ¶æ•¸è€Œä¸”è¢«é™åˆ¶åœ¨å¾ˆä½çš„æ•¸é‡ï¼ˆ6ï¼‰ã€‚</p></blockquote><p>ä½†æ˜¯é€é HTTP/2 å°±æ²’å·®äº†ã€‚ä½†æ˜¯é‚„æ˜¯æœ‰ä¸€äº›<ahref="https://caniuse.com/eventsource">ç€è¦½å™¨</a>ä¸æ”¯æ´ SSEã€‚</p><h2 id="websockets">WebSockets</h2><p>éäº†é€™éº¼ä¹…ï¼Œå…”å­å’Œè€é—†éƒ½è®Šæˆæœ‹å‹äº†ã€‚æ‰€ä»¥ä»–å€‘ç„¡è©±ä¸è«‡ï¼Œèª°éƒ½å¯ä»¥è‡ªç”±çš„æºé€šã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">00:00:00 å…”å­ -&gt; æœ‰ç´…è˜¿è””å—ï¼Ÿ</span><br><span class="line">00:00:01 è€é—† -&gt; ç­‰ä¸€ä¸‹å–”ã€‚</span><br><span class="line">00:00:01 å…”å­ -&gt; å¥½å•Šã€‚</span><br><span class="line">00:00:03 è€é—† -&gt; æœ‰è²¨äº†ï¼Œæ‹¿å»ã€‚</span><br><span class="line">00:00:03 è€é—† -&gt; æ­£åœ¨ç­‰ä¸‹ä¸€æ¬¡é€è²¨ã€‚</span><br><span class="line">00:00:04 å…”å­ -&gt; é€™æ˜¯ç”šéº¼å£å‘³é˜¿ã€‚</span><br><span class="line">00:00:04 è€é—† -&gt; æˆ‘ä¸çŸ¥é“æ¬¸ï¼Œè˜¿è””å£å‘³å§ã€‚</span><br><span class="line">00:00:05 è€é—† -&gt; è²¨å¿«åˆ°äº†ã€‚</span><br><span class="line">00:00:05 å…”å­ -&gt; å¤ªæ£’äº†ï¼Œè¶…å¥½åƒçš„æ¬¸ã€‚</span><br><span class="line">00:00:06 å…”å­ -&gt; ä½†æ˜¯æˆ‘åƒå¤ äº†ï¼Œè¬å•¦ã€‚</span><br></pre></td></tr></table></figure><p>ä½†å¯¦éš›ä¸Šï¼Œè€é—†è·Ÿå…”å­é‚„æ˜¯è¦å…ˆåŸ¹é¤Šæ„Ÿæƒ…æ‰èƒ½é€™æ¨£è¼•é¬†çš„æºé€šçš„ï¼Œæ‰€ä»¥ä»–å€‘ä¸€é–‹å§‹é‚„æ˜¯æœƒé€éåŸæœ¬HTTP çš„æ–¹å¼ä¾†é€£ç·šã€‚</p><p><img src="/assets/WebSocket/Untitled.png" /></p><p>é€™å°±åˆ†åˆ¥æ˜¯ Client å’Œ Server æœƒå‚³çµ¦å°æ–¹çš„è¨Šæ¯ã€‚Client æœƒå‚³é€è¦æ±‚Upgrade åˆ° websocket çš„è«‹æ±‚å’Œ websocket çš„ Key ç­‰è³‡æ–™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET /chat HTTP/1.1</span><br><span class="line">Host: example.com:8000</span><br><span class="line">Upgrade: websocket</span><br><span class="line">Connection: Upgrade</span><br><span class="line">Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==</span><br><span class="line">Sec-WebSocket-Version: 13</span><br></pre></td></tr></table></figure><p>å¦‚æœ Server ç«¯æ²’æœ‰å•é¡Œï¼Œä»–ä¹Ÿæœƒå›å‚³å¯ä»¥ Upgradeçš„è¨Šæ¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 101 Switching Protocols</span><br><span class="line">Upgrade: websocket</span><br><span class="line">Connection: Upgrade</span><br><span class="line">Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=</span><br></pre></td></tr></table></figure><p>ç„¶å¾Œå› ç‚º WebSocket æ˜¯åœ¨å¦ä¸€å€‹é€šè¨Šæ–¹å¼ä¸‹æºé€šçš„ï¼Œæ‰€ä»¥ä»–ä¸¦ä¸æœƒå ç”¨åŸæœ¬ç”¨HTTP æºé€šçš„ç®¡é“ã€‚</p><p><a href="https://www.youtube.com/watch?v=1BfCnjr_Vjg">WebSockets in100 Seconds &amp; Beyond with Socket.io</a></p>]]></content:encoded>
      
      
      <category domain="https://blog.arui.dev/categories/Tech-Share/">Tech Share</category>
      
      
      <category domain="https://blog.arui.dev/tags/Notes/">Notes</category>
      
      
      <comments>https://blog.arui.dev/WebSocket/#disqus_thread</comments>
      
    </item>
    
  </channel>
</rss>
